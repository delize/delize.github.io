<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Workspace One & Okta - User(s) and Group(s) working with DEP Enrollment</title>
<meta name="description" content="" />
<meta name="keywords" content="" />
<meta name="author" content="andrewdoering" />
<meta name="ROBOTS" content="">
        <!--  FavIcon  -->
<link rel="shortcut icon" href="http://placehold.it/60x60">

<!-- Google Fonts -->
<link async rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:300,400,600%7CPoppins:400,500,600,700" />

<!--  Bootstrap CSS  -->
<!-- <link rel="stylesheet" href=/assets/css/bootstrap.css > -->
<link rel="stylesheet" href=/assets/css/bootstrap.min.css >
<!--  Line Icon CSS  -->
<link rel="stylesheet" href=/assets/css/LineIcons.css>
<!--  Font Awesome CSS  -->
<link async rel="stylesheet" href=/assets/css/all.min.css />
<!-- <link rel="stylesheet" href=/assets/css/font-awesome.min.css> -->
<!--  Animate CSS  -->
<link rel="stylesheet" href=/assets/css/animate.css> 
<!--  Magnific Popup CSS  -->
<link rel="stylesheet" href=/assets/css/magnific-popup.css>
<!--  Owl-carousel CSS  -->
<link rel="stylesheet" href=/assets/css/owl.carousel.min.css>
<!--  Custom Style CSS  -->
<link rel="stylesheet" href=/assets/css/style.css>
    </head>

    <body data-spy="scroll" data-target="#scrollspy" data-offset="61" class="uone-dark pt-hero">

               <!--  Pre Loader  -->
        <div id="overlayer"></div>
        <span class="loader"></span>

        <!--    Header Start    -->
        <header id="header" class="header page-header bg-white fixed-top">
            <nav id="scrollspy" class="navbar navbar-expand-lg header-nav">
                <div class="container">
                    <a class="navbar-brand font-weight-bold text-dark" href="index-dark.html">Andrew <span>Doering</span></a>
                    <!--  Navbar Toggler Button Start -->
                    <button class="navbar-toggler collapsed " type="button" data-toggle="collapse" data-target="#toggle-menu" aria-controls="toggle-menu" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="lni-menu size-md"></span>
                    </button>
                    <!--  Navbar Toggler Button End -->
                    <div class="collapse navbar-collapse" id="toggle-menu">
                        <ul class="navbar-nav nav-pills ml-auto">
                            <li class="nav-item">
                                <a class="nav-link text-dark" href="http://localhost:4000/blog">Back</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <!--    Header End    -->

        <!--    Hero Start    -->
        <section class="hero page-hero py-6" id="hero">
            <div class="text-center hero-content mx-auto">
                <h1 class="text-white mb-4 margin="4 px">Workspace One & Okta - User(s) and Group(s) working with DEP Enrollment</h1>
                <p class="mx-auto text-white">
                    <a href="http://localhost:4000" class="text-white">Home</a>
                    /
                    <a href="http://localhost:4000/blog" class="text-white">Blog</a>
                    /
                    <span class="text-white">Workspace One & Okta - User(s) and Group(s) working with DEP Enrollment</span>
                </p>
            </div>
        </section>
        <!--    Hero End    -->

        <!--   Blog-single   Start -->
        <section class="py-6">
            <div class="container">
                <div class="row">
                    <div class="col-lg-10 offset-lg-1 blog">
                        <div class="rounded px-lg-5">
                            <div class="text-md-left">
                                <h4 class="mb-4">Workspace One & Okta - User(s) and Group(s) working with DEP Enrollment</h4>
                                <img src="http://placehold.it/900x600" alt="" class="img-fluid w-100 rounded">
                                <span class="d-inline-block py-4"> 1 April 2019
                                        / By <span class="purple-color text-right"> andrewdoering. </span>
                                        </span>
                                <p class="text-muted"><h2 id="introduction">Introduction</h2>

<p>If you have not yet read <a href="https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta/">the previous writeup about Airwatch and SAML,</a>, I would highly recommend reading this before finishing the setup, this page will pick up on where we left off on the Room for Improvements section. Namely, getting user imports, and Okta groups to have successful lookups as well as member imports.</p>

<p>I also have to apologize, as this blog post was written on plane wifi, and as we all know… plane wifi is awful. I coincidentally, had to VNC to a differenct machine to even get into my blog, as the connection would time out.  So I had to write most of this from memory and without photos as a step by step guide on how to do this configuration.</p>

<p><strong>Note:</strong> that everything listed here is not for the Workspace One Identity Manager, but solely for LDAP Settings</p>

<p><strong>Note 2:</strong> As of writing this, this has only been tested in a Feature Staging environment, as I did not want to make a change over the weekend, nor did I want to make such a drastic change into our directory services over the holiday break without the time to properly test. So this has been tested in our feature stage but not in production. However within the feature stage, I was able to DEP enroll devices. Automatically add the users into groups, and import group objects and user objects without issue, and allow SAML.</p>

<p><strong>Note 3:</strong> “After writing this, I looked up Airwatch’s documentation – it is vastly improved. It looks like the documentation can finally be used as a mechanism to implement features and integrations.” This quote is taken from my first blog post. Airwatch’s documentation still needs improvement. Their directions for this were completely wrong, and I spent over a month (or what seemed like it) going back and forth with support. In the end, it was more of dumb luck getting this to work, as I eventually got on a call with Okta &amp; Airwatch Support, and neither of them unfortunately knew what specific attributes needed to be used either.</p>

<p><strong>Note 4</strong>: This is working as of January 1st 2019, I can’t guarantee that it will continue to work after this date. (Though I don’t see why it wouldn’t).</p>

<h3 id="how-this-document-is-structured">How this document is structured</h3>

<p>I will go over the prerequisites first, each title should will be either the task being performed, or in Airwatch’s case, the settings page which is being viewed (and also the task being performed). The document will black out specific or private information to the company that I am not allowed to share - if you noticed from the original blog post, not a lot was edited out for you.</p>

<p>I use Airwatch and Workspace One synonymously. Sorry about that.</p>

<p>As Monty Python skits would say “Get on with it”… let us do so.</p>

<h2 id="why-is-okta-ldap-and-ws-one-uem-intergation-important">Why is Okta LDAP and WS One UEM Intergation important?</h2>

<p>Having a lack of groups causes us some issues when assigning smart groups, applications, policies, etc. Because of this, we were pretty much limited to an all or nothing approach or specific lookups when trying to determine things like all devices over macOS 10.15, or a specific subset of macOS devices.</p>

<p>I also know that several people have been struggling to get this working properly, and Airwatch/VMware has been less than helpful for the most part to those users as their tickets are still open. The same exists on the Okta side, as it was discussed there during our Okta meetings with them.</p>

<p>Slow but sturdy steps in our race to achieve greatness with Workspace One!</p>

<h2 id="software-requirements">Software Requirements</h2>

<ul>
  <li>Airwatch Cloud Connector (optional)</li>
  <li>Okta Ldap Interface</li>
  <li>Okta</li>
  <li>Airwatch / Workspace One</li>
</ul>

<h2 id="okta---adding-user-attributes">Okta - Adding User Attributes</h2>

<p>Please note, that I copied this verbatim from the previous blog post.</p>

<p>Because we want to integrate this with Azure later on, and Active Directory, we need to map some of our existing attributes from Active Directory and push them into Okta.</p>

<p>First, go here:  <a href="https://YOURDOMAIN-admin.okta.com/admin/universaldirectory">https://YOURDOMAIN-admin.okta.com/admin/universaldirectory</a> and select the Profile button located below</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/11/image-4-1024x201.png" alt="" /></p>

<p>Click the add attribute button</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/11/image-5.png" alt="" /></p>

<p>Use the the following settings for the Attributes</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/11/image-2-1024x734.png" alt="" /></p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/11/image-3-1024x734.png" alt="" /></p>

<p>Now, lets go to Active Directory’s mapping, select your domain to setup the mapping push. You want to push from the Active Directory Domain to Okta.</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/11/image-6-1024x330.png" alt="" /></p>

<h2 id="workspace-one---directory-services--server-configuration">Workspace One - Directory Services &gt; Server Configuration</h2>

<p>Please refer to <a href="https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta/#3-workspace-one---directory-services-integration">this link</a> if you would like to go into more depth about how to setup this section.</p>

<p>Our Directory Services type setup is the same as last time, I will post it again here for your convince.<br />
To reiterate, you need to have a user that is either ReadOnly or SuperAdmin. The preferred method would be ReadOnly, as if your account credentials are scraped somehow from Airwatch, there will be minimal access potentially given up. Sure they will have read only access to everything but they won’t be able to do anything except read the config (still bad, but less of a risk). While you can’t control the risk of your password being dumped from Airwatch (that risk is on Airwatch) you can definitely device the risk of control given out (your access level of your BIND User). I will not go</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/11/2019-11-28_12-39-35-1024x549.jpg" alt="" /></p>

<h2 id="workspace-one---directory-services--user-mapping">Workspace One - Directory Services &gt; User Mapping</h2>

<p>Now here is where we get to the fun part. This is where both Okta’s and VMware’s documentation are incredibly wrong.</p>

<p>For the User Mapping you will want to fill out the following attributes, with their corresponding mappings, setting everything else to the Airwatch Default.</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/image-3-1024x993.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Object Identifer: uniqueIdentifier
User Name: uid
Member Of: memberOf #leave default
Full Name: cn
Display Name: cn
First Name: givenName #leave default
Middle Name: middleName #leave default
Last Name: sn #leave default
Email Address: uid
Email Username: sAMAccountName
Mobile Phone: mobile #leave default
Phone Number: telephoneNumber #leave default
Distinguished Name: dn
User Principal Name: uid
Status: UserAccountControl #leave default
Lockeout Time: lockoutTime #leave default
Object Category: objectCategory #leave default
Last Modified: whenChanged #leave default
Binding Attribute: (blank) #leave default, or remove mapping
Employee ID: employeeID
Cost Center: (blank) #leave default, or remove mapping
Manager Distinguished Name: managerName #leave default
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">#</code> and to the right are listed as comments, the mappping should be the value immediately after the <code class="language-plaintext highlighter-rouge">:</code>. This should get you a working configuration, assuming you followed the Okta Mapping from the previous blog post, otherwise replace <code class="language-plaintext highlighter-rouge">sAMAccountName</code> with some other attribute from Okta that you have created. I will get into why we are using this specific attribute later on.</p>

<p>Now, save the following settings and then scroll up to the top of the page. Now the important piece here is that <code class="language-plaintext highlighter-rouge">User Search Filter</code> will change automatically to something that we don’t want. It is a little counterintuitive but, when it does this automatic change, it also removes the ability for your group lookup to work properly. I found that deleting the first entry of this and setting it to <code class="language-plaintext highlighter-rouge">($(uid={EnrollmentUser}))</code> works much better than what is stated here. Your page should end up looking like this:</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/image-6-1024x726.png" alt="" /></p>

<p>You will need to save the mapping again, and then switch to the groups tab.</p>

<h2 id="workspace-one---directory-services--group-mappings">Workspace One - Directory Services &gt; Group Mappings</h2>

<p>I was so very close in the original blog post for our group mappings, I only messed up one attribute value. Please see the correct settings below:</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/image-7-1024x801.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```
ObjectIdenfiter: uniqueIdentifier
Name: cn
Member: uniqueMember
Common Name: cn #leave default
Member Of: memberOf #leave default
Group Object Class: objectClass
Organizational Unit: ou #leave default
Organizational Unit Object Class: objectClass
```
</code></pre></div></div>

<p>You may need to set the value of <code class="language-plaintext highlighter-rouge">Maximum Allowable Changes</code> to something higher than 10, maybe something like 100 or 500. Depends on some of the initial imports you will be doing.  Save the group settings, you should be done with this page.</p>

<h2 id="okta---limitations-to-be-aware-of">Okta - Limitations to be aware of</h2>

<p>Again, as we are using the LDAP Interface, this interface will ONLY respond with Okta mastered groups. Active Directory Groups that have been pushed to Okta will NOT respond to the LDAP interface lookup. Unfortunately, I don’t believe Okta has any plans on changing this in the future.</p>

<h2 id="workspace-one---test-your-setup">Workspace One - Test your setup</h2>

<p>Once you have saved the entire configuration (both members and groups) click the test connection. You should be prompted with Workspace One’s new LDAP/Directory Services testing tool. I wish they had this when we originally set stuff up, as it makes troubleshooting the mappings a lot easier.</p>

<p>If you test a member, you should see something similar to the following:</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/image-8.png" alt="" /></p>

<p>If you test a group, you should see something similar to the following:</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/groups.png" alt="" /></p>

<p>From here, if everything looks similar to the photo above, you should be good to go.</p>

<h2 id="workspace-one---add-group">Workspace One - Add Group</h2>

<p>Again, remembering that the limitation here is that Okta can only deliver groups created within Okta and not from external sources, create a group (or use an existing group) with a select few test users you want use. There is  also a limitation that if the user does not exist, they will not be created upon the sync of the group.</p>

<p>I will create a group in Okta called <code class="language-plaintext highlighter-rouge">iam_airwatch_test_group</code></p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/image-10.png" alt="" /></p>

<p>So we see that there are two users within the group here. If I then switch back to airwatch and search for the group we get the following:</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/image-11.png" alt="" /></p>

<p>So from here, lets say I add the group, my atesting account already exists in the user directory, so we have a single user in the group as of now, and then I go add our second testing user to Airwatch’s directory service, the user is automatically added into the group and the group syncs up and reports two users in Airwatch as group members:</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/image-12-1024x68.png" alt="" /></p>

<p>There you have it, group membership working properly!</p>

<h2 id="workspace-one---dep-profile">Workspace One - DEP Profile</h2>

<p>Now, I personally don’t want our user’s usernames being user@thousandeyes.com, and I noticed that Workspace One is quite buggy with version 1910 and the DEP Enrollment profile for macOS 10.14+ devices (specifically, the autofill settings when not using custom enrollment). If you make any changes to the above settings, like we just did, I have HAD to change the settings on this page as a result for them to take effect on all new DEP Devices.  For the most part, all I would do is just toggle the settings back and forth for the Autofill options, or your hidden administrator for them to repopulate, however if that does not work, I will show you how we have it configured.</p>

<p>How we have this configured at ThousandEyes:</p>

<p><img src="https://andrewdoering.org/blog/wp-content/uploads/2019/12/image-9.png" alt="" /></p>

<p>So because we want the user’s account name to be the email prefix, we are relying on the <code class="language-plaintext highlighter-rouge">sAMAccountName</code> that we are passing from Okta to Workspace One’s <code class="language-plaintext highlighter-rouge">{EmailUserName}</code> attribute. You could also pass this as a custom attribute if you would like, but, I did not have much success in initially getting custom attributes to appear. This would be the more long term approach though, as if we are using Okta, that WOULD be a custom attribute.</p>

<p>From there, the employee would authenticate against DEP with their full email address, and then their username would automatically provision with the prefix of their email, pre populate their password, and populate their full name.</p>

<h2 id="okta---saml-application">Okta - SAML Application</h2>

<p>Please see the previous documentation I wrote <a href="https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta/#8-okta---saml-app-for-airwatch">here</a>. This page should still work great based on our existing setup.</p>

<h2 id="our-room-for-improvement">Our room for improvement</h2>

<p>We are still working on getting Azure AD set up, so this guide is mainly geared towards a macOS only environment. Though, with the user settings the way they are I am hopeful that this will work.</p>

<p>If it does not, we just have to set up our Organizational Groups to split Windows and macOS devices in o two different buckets, and have a different set of settings between them.  I am looking forward to the challenge when we get there.</p>

<p>Without having tested group changes thoroughly before writing this, I am worried that the group memberships won’t update based on the <code class="language-plaintext highlighter-rouge">Last Modified</code> attribute not having a value, however, that will remain to be seen as we keep moving forward with this project.</p>

<p>To also compare this blog post to what VMware originally wrote (at the time of writing this, I have attached the <a href="https://kb.vmware.com/s/article/2961230?lang=en_US">current KB article</a> in PDF format below:</p>

<p><a href="https://andrewdoering.org/blog/wp-content/uploads/2019/12/Configuring-Okta-LDAP-for-use-with-VMware-Workspace-ONE-UEM-2961230.pdf">Configuring-Okta-LDAP-for-use-with-VMware-Workspace-ONE-UEM-2961230</a><a href="https://andrewdoering.org/blog/wp-content/uploads/2019/12/Configuring-Okta-LDAP-for-use-with-VMware-Workspace-ONE-UEM-2961230.pdf">Download</a></p>

<h2 id="comments-questions">Comments, Questions?</h2>

<p>I will likely be a lot more responsive on the MacAdmins slack, you can find me in the #airwatch channel with the username @heimdall. It’s a great resource for people and I highly recommend that you join if you are looking for help with anything Mac related.</p>

<p>Otherwise, feel free to comment below.</p>

</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!--   Blog-Single End  -->

        <!--   Footer Start  -->
<footer class="bg-dark">
    <div class="container">
        <div class="row py-5">
            <div class="col-lg-4">
                <h4 class="text-white mt-3 mt-lg-0">About <span class="base-color"> Me</span></h4>
                <p class="text-white pt-3 mb-0">Andrew Doering resides in San Francisco, and currently maintains a position at
                    ThousandEyes as a Senior IT Engineer. </p>
            </div>
            <div class="col-lg-4">
                <h4 class="text-white mt-3 mt-lg-0">Contact <span class="base-color">Us</span></h4>
                <ul class="list-unstyled text-white pt-2 mb-0">
                    <li class="py-1"><i class="fas fa-map-marker-alt pr-2"></i> San Francisco, CA 94109 USA</li>
                    <li class="py-1"><i class="fas fa-phone-square-alt pr-2"></i><a href="tel:+1 919-904-4396"> +1 919 904 4396</a></li>
                    <li class="py-1"><i class="fas fa-envelope pr-2"></i><a href="mailto:contact@andrewdoering">
                            contact@andrewdoering.org</a></li>
                </ul>
            </div>
            <div class="col-lg-4">
                <h4 class="text-white mt-3 mt-lg-0">My <span class="base-color">Socials</span></h4>
                <ul class="list-unstyled text-white socials pt-2 mb-0">
                    <li class="py-1"><a href="https://www.facebook.com/and.doe"><i class="fab fa-facebook-f pr-2" aria-hidden="true"></i>
                            Facebook</a></li>
                    <li class="py-1"><a href="https://www.linkedin.com/in/andrewdoering"><i class="fab fa-linkedin pr-2"
                                aria-hidden="true"></i> LinkedIn</a></li>
                    <li class="py-1"><a href="https://www.github.com/delize"><i class="fab fa-github pr-1" aria-hidden="true"></i>
                            Github</a></li>
                    <li class="py-1"><a href="https://www.instagram.com/dolos01"><i class="fab fa-instagram pr-2" aria-hidden="true"></i>
                            Instagram</a></li>
                    <li class="py-1"><a href="skype:andrew-doering"><i class="fab fa-skype pr-2" aria-hidden="true"></i> andrew-doering</a>
                    </li>
                    <li class="py-1"><a href="https://www.macadmins.org/"><i class="fab fa-slack pr-2" aria-hidden="true"></i> @heimdall</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 border-top pb-5">
                <p class="mt-3 mb-0 text-white d-lg-inline-block text-center">Copyright © 2020</p>
                <a href="javascript:void(0);" class="mt-4 mt-lg-3 mb-0 text-white back-to-top d-block d-lg-inline-block float-lg-right text-center">Back To Top</a>
            </div>
        </div>
    </div>
</footer>
<!--   Footer End  -->
        <!--  JavaScripts  -->
<script src=/assets/js/jquery-3.4.1.min.js></script>
<!--  Bootstrap Js  -->
<!-- <script src="assets/js/bootstrap.js"></script> -->
<script src=/assets/js/bootstrap.min.js></script>
<!--  Easing Js  -->
<script src=/assets/js/jquery.easing.min.js></script>
<!--  Isotope Js  -->
<script src=/assets/js/slyslider.js></script>
<!--  Pop UP JS Js  -->
<script src=/assets/js/jquery.magnific-popup.min.js></script>
<!--  Owl carousel Js  -->
<script src=/assets/js/owl.carousel.min.js></script>
<!--  Wow Js  -->
<script src=/assets/js/wow.min.js></script>
<!--  Typed Js  -->
<script src=/assets/js/typed.js></script>
<!--  Custom JS  -->
<script src=/assets/js/uone.js></script>


    </body>
</html>