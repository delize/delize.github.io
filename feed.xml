<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.1.1">Jekyll</generator><link href="https://andrewdoering.org/feed.xml" rel="self" type="application/atom+xml" /><link href="https://andrewdoering.org/" rel="alternate" type="text/html" /><updated>2021-01-09T21:51:13+00:00</updated><id>https://andrewdoering.org/feed.xml</id><title type="html">Andrew Doering CV &amp;amp; Blog</title><entry><title type="html">Tracking Github Accounts and automatically assigning the application</title><link href="https://andrewdoering.org/blog/2020/11/20/assigning-applications-on-attributes/" rel="alternate" type="text/html" title="Tracking Github Accounts and automatically assigning the application" /><published>2020-11-20T08:00:00+00:00</published><updated>2020-11-20T08:00:00+00:00</updated><id>https://andrewdoering.org/blog/2020/11/20/assigning-applications-on-attributes</id><content type="html" xml:base="https://andrewdoering.org/blog/2020/11/20/assigning-applications-on-attributes/">&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;We historically had made a change from Github Enterprise to Github Cloud. One of the downsides of this is that this would require external Github accounts that were not really within “control”, or included management of accounts. We needed to setup tracking of this information. We also needed a way to automate groups, which up &lt;a href=&quot;https://docs.github.com/en/free-pro-team@latest/github/setting-up-and-managing-organizations-and-teams/synchronizing-a-team-with-an-identity-provider-group&quot;&gt;until recently&lt;/a&gt; was not possible. However, the route we did go was able to be done in a self-service aspect (with a few limitations).&lt;/p&gt;

&lt;h2 id=&quot;create-an-okta-mastered-attribute&quot;&gt;Create an Okta mastered attribute&lt;/h2&gt;

&lt;p&gt;So very similar to the blog post on pushing &lt;a href=&quot;https://andrewdoering.org/blog/2020/11/15/pushing-ssh-keys-from-okta-to-ad/&quot;&gt;SSH keys from Okta to AD&lt;/a&gt;, we need to create an attribute to host Github Account information.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Go to &lt;a href=&quot;https://yourdomain.okta.com/admin/universaldirectory&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://yourdomain.okta.com/admin/universaldirectory&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Profile&lt;/code&gt; under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User (default)&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-step1.png&quot; alt=&quot;Okta Universal Directory&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add Attribute&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-step2.png&quot; alt=&quot;Okta Profile&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Once the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add Attribute&lt;/code&gt; window has appeared, fill out the prompts with the following options:
    &lt;ul&gt;
      &lt;li&gt;Display Name: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSH Public Key&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Variable Name: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com_github_accountname&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com_github_username&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Description: Add what you would like here, an example is below in the photograph&lt;/li&gt;
      &lt;li&gt;Once done, select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Save&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Once the attribute is created, scroll down to the bottom, and find the newly created Okta attribute and click the pencil icon to edit the attribute.
  &lt;img src=&quot;/assets/blog/2020/11/assign-github-on-attribute/github-attribute-1.png&quot; alt=&quot;Okta step 4&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;You will want to change the attributes for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User Permission&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Master Priority&lt;/code&gt; to match to the picture below.
  &lt;img src=&quot;/assets/blog/2020/11/assign-github-on-attribute/github-attribute-2.png&quot; alt=&quot;Okta step 5&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;While optional, you may also want to change the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Attribute Length&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;39&lt;/code&gt;. Github has a maximum value of 39 characters, which can be seen &lt;a href=&quot;https://github.com/shinnn/github-username-regex&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://gist.github.com/tonybruess/9405134&quot;&gt;here&lt;/a&gt;, and &lt;a href=&quot;https://github.com/join&quot;&gt;here&lt;/a&gt; (only when typing something more than 39 characters). This way there is validation of the account name length in place and someone doesn’t put the incorrect account in potentially.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;create-okta-group--rule&quot;&gt;Create Okta group &amp;amp; rule&lt;/h2&gt;

&lt;h3 id=&quot;group&quot;&gt;Group&lt;/h3&gt;

&lt;p&gt;Create a group that will be assigned to the Okta application. My recommendation would be to call it &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iam_github&lt;/code&gt; or something to that extent, just to keep things very simple. You can go ahead and manually add a few people there for now, however, you ultimately do not want to manually assign users to this group, so that the group rule can take effect.&lt;/p&gt;

&lt;h3 id=&quot;group-rule&quot;&gt;Group Rule&lt;/h3&gt;

&lt;p&gt;For a basic implementation of assigning the Okta application to the user. This is assuming that you do not have team groups configured/setup, and only have a single group assigned to the Github applications. If you want to also do validation (as in, you require a prefix, or suffix attached to the account), you can modify the expression language below to validate that an account matches those requirements before assigning the application.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Okta Expression Language: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(user.com_github_username != null or user.com_github_username == &quot;&quot; )&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Okta Group: Your Github application group&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Once created, mark it as active.&lt;/p&gt;

&lt;h2 id=&quot;assign-the-group-to-the-application&quot;&gt;Assign the group to the application&lt;/h2&gt;

&lt;p&gt;Once the group &amp;amp; rule is finished being created, assign the group to the application.&lt;/p&gt;

&lt;h1 id=&quot;so-what-happens-now&quot;&gt;So what happens now?&lt;/h1&gt;

&lt;p&gt;If an employee has not filled out the attribute in their Okta profile, they will not be assigned the application. When an employee does fill out the application, if you have added the syntax check (such as a suffix of prefix), it will assign the application assuming it meets any checks.&lt;/p&gt;

&lt;p&gt;Once added to Github, without doing the previously mentioned assigning users to &lt;a href=&quot;https://docs.github.com/en/free-pro-team@latest/github/setting-up-and-managing-organizations-and-teams/synchronizing-a-team-with-an-identity-provider-group&quot;&gt;teams&lt;/a&gt;. Everything going forward would be self-service/self-requested when joining teams within the org. And from there, managers of each team can get approval notifications and add team members to the team once the SSO connection has been established.&lt;/p&gt;

&lt;p&gt;You can further expand on this by creating multiple groups and checks within the rule, for instance, creating a group rule that checks against department attribute + okta username, to assign a different group and assign them the appropriate team with the URL above. However, you are still limited to five groups per team. So there needs to be careful consideration on how you apply those groups.&lt;/p&gt;

&lt;p&gt;The other option is to do this using Okta workflows, this would do things directly against the API, and may not be limited to the five team limitation as described in the Github documentation.&lt;/p&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Identity Access Management" /><category term="Github" /><category term="Provisioning" /><category term="Attributes" /><category term="Okta" /><summary type="html">How to assign Github based on attribute context, while tracking information for audits and through external system logs.</summary></entry><entry><title type="html">Pushing SSH keys from Okta to AD</title><link href="https://andrewdoering.org/blog/2020/11/15/pushing-ssh-keys-from-okta-to-ad/" rel="alternate" type="text/html" title="Pushing SSH keys from Okta to AD" /><published>2020-11-15T08:00:00+00:00</published><updated>2020-11-15T08:00:00+00:00</updated><id>https://andrewdoering.org/blog/2020/11/15/pushing-ssh-keys-from-okta-to-ad</id><content type="html" xml:base="https://andrewdoering.org/blog/2020/11/15/pushing-ssh-keys-from-okta-to-ad/">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configuring-sssd-on-linux-to-work-with-active-directory&quot;&gt;Configuring SSSD on Linux to work with Active Directory&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#modifying-the-active-directory-schema&quot;&gt;Modifying the Active Directory Schema&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#enable-schema-updates&quot;&gt;Enable Schema Updates&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#adding-the-attribute-in-ad-schema&quot;&gt;Adding the attribute in AD schema&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#adding-a-new-class-for-the-attribute&quot;&gt;Adding a new class for the attribute&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#associate-the-attribute-and-class-to-the-user-property&quot;&gt;Associate the attribute and class to the user property&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#creating-an-attribute-in-oktas-user-directory-schema&quot;&gt;Creating an attribute in Okta’s User Directory Schema&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#adding-an-ssh-key-to-okta-profile&quot;&gt;Adding an ssh key to Okta profile&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#add-the-new-ad-attribute-to-the-directories-profile-in-okta&quot;&gt;Add the new AD attribute to the Directories Profile in Okta&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#pushing-attributes-from-okta-to-application&quot;&gt;Pushing Attributes from Okta to Application&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;I really would love to implement Okta Advanced Sever Access (ASA) to our server infrastructure in our environment. ASA has three downsides:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Expensive ($50,000 minimum) depending on the amount of servers being deployed to&lt;/li&gt;
  &lt;li&gt;Requires extensive management approval&lt;/li&gt;
  &lt;li&gt;Requires extensive security review from our team&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Okta’s LDAP interface also &lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/Directory/LDAP-interface-limitations.htm&quot;&gt;does not support Linux/PAM officially&lt;/a&gt;, which appears to be (more or less) an artificial limit to push/advertise the ASA product.&lt;/p&gt;

&lt;p&gt;So we need to find workarounds for this. This blog post covers details on how to do to 2 things:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Expand the Active Directory schema to store and use SSH keys over LDAP.&lt;/li&gt;
  &lt;li&gt;Allow for SSH Keys to be stored in Okta and pushed to Active Directory by the End User.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;configuring-sssd-on-linux-to-work-with-active-directory&quot;&gt;Configuring SSSD on Linux to work with Active Directory&lt;/h2&gt;

&lt;p&gt;We want to configure SSSD on Linux to hook up into Active Directory (a very basic configuration file, edit it to your needs):&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    
    [sssd]
    domains = LDAP
    services = nss, pam
    config_file_version = 2

    [nss]
    filter_groups = root
    filter_users = root

    [pam]

    [domain/LDAP]
    id_provider = ldap
    ldap_uri = ldap://ldap.example.com
    ldap_search_base = dc=example,dc=com

    auth_provider = krb5
    krb5_server = kerberos.example.com
    krb5_realm = EXAMPLE.COM

    cache_credentials = true
    min_id = 10000
    max_id = 20000
    enumerate = False
    
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would suggest reading through &lt;a href=&quot;https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/windows_integration_guide/sssd-integration-intro#sssd-ad-proc&quot;&gt;Red Hat’s documentation&lt;/a&gt; for validating the configuration. I won’t go into SSSD more in-depth here.&lt;/p&gt;

&lt;h2 id=&quot;modifying-the-active-directory-schema&quot;&gt;Modifying the Active Directory Schema&lt;/h2&gt;

&lt;p&gt;We will need to modify the Active Directory schema to create an attribute called sshPublicKey.&lt;/p&gt;

&lt;h3 id=&quot;enable-schema-updates&quot;&gt;Enable Schema Updates&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;Open up an administrative command prompt session&lt;/li&gt;
  &lt;li&gt;Open up an administrative registry editor session by running &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;regedit&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Browse to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters&lt;/code&gt;
&lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/en-schema-update1.png&quot; alt=&quot;Registry Path&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Add a new DWORD key that is called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Schema Update Allowed&lt;/code&gt; with a value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;
&lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/en-schema-update2.png&quot; alt=&quot;Schema Update Allowed&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;In the administrative session of the command prompt, run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;regsvr32 schmmgmt.dll&lt;/code&gt; to enable Schema Management MMC Plug-in and accept the prompt.
&lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/en-schema-update3.png&quot; alt=&quot;Register module&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;adding-the-attribute-in-ad-schema&quot;&gt;Adding the attribute in AD schema&lt;/h3&gt;

&lt;p&gt;I would highly recommend putting the project number/name in the description below, as well as what I have written.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Once the mmc window has been opened, add the schema module to the running mmc window. 
&lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/add-attr-schema.png&quot; alt=&quot;Open MMC window&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Expand the listing on the left hand side.&lt;/li&gt;
  &lt;li&gt;Right Click on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Attributes&lt;/code&gt;, and then select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Create New Attribute&lt;/code&gt;.
&lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/add-attr-schema2.png&quot; alt=&quot;Add new attribute&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Accept the warning that pops up and continue on.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Common Name&lt;/code&gt;, enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshPublicKeys&lt;/code&gt; in the field.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LDAP Display Name&lt;/code&gt;, enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshPublicKeys&lt;/code&gt; in the field.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Description&lt;/code&gt;, enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;For Public SSH Key storage for sssd&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Unique X500 Object ID&lt;/code&gt; enter the following OID, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1.3.6.1.4.1.24552.1.1.1.13&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Syntax&lt;/code&gt;, select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IA5-String&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Check the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Multi-Valued&lt;/code&gt; box.&lt;/li&gt;
  &lt;li&gt;Leave both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Minimum&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Maximum&lt;/code&gt; blank.
&lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/add-attr-schema3.png&quot; alt=&quot;Register module&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ok&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;adding-a-new-class-for-the-attribute&quot;&gt;Adding a new class for the attribute&lt;/h3&gt;

&lt;p&gt;Once we have added the attribute into Active Directory, we need to add a class for the attribute to be associated with it. I would highly recommend putting the project number/name in the description as well.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Right-click on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Classes&lt;/code&gt;, then click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Create class&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;If presented, click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Continue&lt;/code&gt; on the warning.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Common Name&lt;/code&gt;, enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ldapPublicKey&lt;/code&gt; in the text field.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LDAP Display Name&lt;/code&gt;, enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ldapPublicKey&lt;/code&gt; in the text field.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Unique X500 Object ID&lt;/code&gt;, enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1.3.6.1.4.1.24552.500.1.1.2.0&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Description&lt;/code&gt;, enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;For use with sshPublicKeys attribute&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Parent Class&lt;/code&gt; enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;top&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Class Type&lt;/code&gt;, select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Auxiliary&lt;/code&gt;.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/add-class-2.png&quot; alt=&quot;Register module&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Next&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Optional&lt;/code&gt;, select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add&lt;/code&gt;, and scroll to find &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshPublicKeys&lt;/code&gt;, click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ok&lt;/code&gt;.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/add-class-3.png&quot; alt=&quot;Register module&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Finish&lt;/code&gt; and leave the Schema MMC window open.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;associate-the-attribute-and-class-to-the-user-property&quot;&gt;Associate the attribute and class to the user property&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;With the schema window still open on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Classes&lt;/code&gt;, find the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; class 
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/associate-class-1.png&quot; alt=&quot;Schema window&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Right-click select on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;properties&lt;/code&gt;.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/associate-class-2.png&quot; alt=&quot;Properties value&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Select the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Relationship&lt;/code&gt; tab, and click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add Class...&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/associate-class-3.png&quot; alt=&quot;Relationship Tab&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ldapPublicKey&lt;/code&gt; and click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ok&lt;/code&gt;.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/associate-class-4.png&quot; alt=&quot;Selecting ldapPublicKey class&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Select the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Attributes&lt;/code&gt; tab and click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add&lt;/code&gt; under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Optional&lt;/code&gt;.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/associate-attr-1.png&quot; alt=&quot;Associate attribute tab&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshPublicKey&lt;/code&gt; and click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ok&lt;/code&gt;.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/associate-attr-2.png&quot; alt=&quot;Associate attribute tab&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Apply&lt;/code&gt; and then click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ok&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Proceed to close the MMC window.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;creating-an-attribute-in-oktas-user-directory-schema&quot;&gt;Creating an attribute in Okta’s User Directory Schema&lt;/h2&gt;

&lt;p&gt;We will begin to create the attribute under Okta’s Universal Directory.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Go to &lt;a href=&quot;https://yourdomain.okta.com/admin/universaldirectory&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://yourdomain.okta.com/admin/universaldirectory&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Profile&lt;/code&gt; under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User (default)&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-step1.png&quot; alt=&quot;Okta Universal Directory&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add Attribute&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-step2.png&quot; alt=&quot;Okta Profile&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Once the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add Attribute&lt;/code&gt; window has appeared, fill out the prompts with the following options:
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-step3.png&quot; alt=&quot;Okta step 3&quot; /&gt;&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;Display Name: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSH Public Key&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Variable Name: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshPublicKey&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Description: Add what you would like here, an example is below in the photograph&lt;/li&gt;
      &lt;li&gt;Once done, select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Save&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Once the attribute is created, scroll down to the bottom, and find the newly created Okta attribute and click the pencil icon to edit the attribute.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-step4.png&quot; alt=&quot;Okta step 4&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;You will want to change the attributes to match to the picture below.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-step5.png&quot; alt=&quot;Okta step 5&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The reason for this is to allow user’s to modify the contents of the attribute value, and to not have a profile master potentially override or own the attribute contents.&lt;/p&gt;

&lt;h2 id=&quot;adding-an-ssh-key-to-okta-profile&quot;&gt;Adding an ssh key to Okta profile&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;Go to &lt;a href=&quot;https://yourdomain.okta.com/enduser/settings&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://yourdomain.okta.com/enduser/settings&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Edit Profile&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-profile-add-key1.png&quot; alt=&quot;Edit Profile&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;If prompted enter your pasword, if not proceed to the next step.&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Edit&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-profile-add-key2.png&quot; alt=&quot;Edit&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Within the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[]&lt;/code&gt;, add your SSH Key wrapped in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&lt;/code&gt;. An example of this would be shown below.
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;  [&quot;ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAoi9tCoNOkZgrOpEm2aoVY3uWNUq3MvNSHrgC9r2ELyVpODAz7eCFswszhtYB2o1FPqarJxJq3QQjflhEAZ16o7oaMD8kWzTdGMBjy9vynCr9dMQTuWoEBlAFNsjK1xdaJyWM2sEFV7p6c85yxeeDei1wBPc1AA4X9H2uS4ZTjaNm/Zobe7j7q8lc/e2Sb0tvY0auLv1sRRScxgZFQ5X/uMK0VtcubXxWxh6JceOb4BZRmHDCXOmX3z3wevtuDw6udafyZ6sjowSFH+PD+p7V97m9S81mQAuXfXzgmd/LrRlxHuzx0DpHKbi623lDvWWNb9QJwlLKbfMEP/DGPiEdsw== example-key&quot;]
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;&lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-profile-add-key3.png&quot; alt=&quot;Profile with ssh key&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Save&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;From here, if you need to add new keys, simply put them in a comma delimited format. So multiple keys would look like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[&quot;key 1&quot;, &quot;key 2&quot;, &quot;key 3&quot;]&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;add-the-new-ad-attribute-to-the-directories-profile-in-okta&quot;&gt;Add the new AD attribute to the Directories Profile in Okta&lt;/h2&gt;

&lt;p&gt;One crucial step in allowing us to push the content down is to add the attribute from Active Directory so that Okta is aware of it.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Go to &lt;a href=&quot;https://yourdomain.okta.com/admin/universaldirectory&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://yourdomain.okta.com/admin/universaldirectory&lt;/code&gt;&lt;/a&gt; and select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Directories&lt;/code&gt;, then select your domain.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-to-ad-step1.png&quot; alt=&quot;Okta Universal Directory - Profile Editor&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Profile&lt;/code&gt;, once the page finishes loading, select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Add Attribute&lt;/code&gt;, and then search for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshPublicKey&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/add-ssh-attr-to-okta.png&quot; alt=&quot;Okta Universal Directory - Profile Editor&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Save&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;pushing-attributes-from-okta-to-application&quot;&gt;Pushing Attributes from Okta to Application&lt;/h2&gt;

&lt;p&gt;Before doing this, announce to your users will use a change. This could be a breaking change if SSH Keys are not saved into the user’s Okta profile. We will use Active Directory as the example application here, but this could be used in other ways.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Go to &lt;a href=&quot;https://yourdomain.okta.com/admin/universaldirectory&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://yourdomain.okta.com/admin/universaldirectory&lt;/code&gt;&lt;/a&gt; and select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Directories&lt;/code&gt;, then select your domain.
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-to-ad-step1.png&quot; alt=&quot;Okta Universal Directory - Profile Editor&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Mappings&lt;/code&gt;, and then select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Configure User Mappings&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-to-ad-step2.png&quot; alt=&quot;Okta Universal Directory - Configure Mappings&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Select the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Okta User to domain.com&lt;/code&gt;
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-to-ad-step3.png&quot; alt=&quot;Okta to User&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Scroll down to your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshPublicKey&lt;/code&gt; attribute on the right column and search for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshPublicKey&lt;/code&gt; on the left column. 
  &lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/okta-to-ad-step4.png&quot; alt=&quot;sshPublicKey Push&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Validate with a user that has saved SSH Keys to their Okta profile, before clicking save. Once validated, select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Save mapping&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;From here, your user’s SSH keys should be in a multi value format pushed down to Active Directory. Note, there are two values here, as I added the SSH key twice to the Okta profile to show the multi-valued aspect.
&lt;img src=&quot;/assets/blog/2020/11/push-ssh-keys/ssh-keys-added-to-ad.png&quot; alt=&quot;Finished Result&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From here, you could use tools like Ansible, SSSD, and others, to pull the content/value out of Active Directory for use with other services and systems. This could also be done directly to the LDAP Interface on Okta, however, that is not officially supported.&lt;/p&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Identity Access Management" /><category term="ssh" /><category term="ssh keys" /><category term="Okta" /><category term="Active Directory" /><summary type="html">When using SSSd with Linux, pushing SSH Keys from Okta to Active Directory, allowing for flexibility to push ssh keys to other services/systems. This also allows for SSH keys to be stored in Active Directory..</summary></entry><entry><title type="html">How we deployed MDM (Workspace One) to hundreds of devices</title><link href="https://andrewdoering.org/blog/2020/10/21/deploying-mdm-to-hundreds-of-devices/" rel="alternate" type="text/html" title="How we deployed MDM (Workspace One) to hundreds of devices" /><published>2020-10-21T08:00:00+00:00</published><updated>2020-10-21T08:00:00+00:00</updated><id>https://andrewdoering.org/blog/2020/10/21/deploying-mdm-to-hundreds-of-devices</id><content type="html" xml:base="https://andrewdoering.org/blog/2020/10/21/deploying-mdm-to-hundreds-of-devices/">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#initial-deployment-process&quot;&gt;Initial Deployment Process&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#what-we-used-on-macos&quot;&gt;What we used on macOS&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#what-we-used-on-windows&quot;&gt;What we used on Windows&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#mdm-deployment-phase&quot;&gt;MDM Deployment Phase&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#prerequisites&quot;&gt;Prerequisites&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#what-we-used-on-macos-1&quot;&gt;What we used on macOS&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#what-we-used-on-windows-1&quot;&gt;What we used on Windows&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#registering-devices-from-our-vendor-with-apple-business-manager&quot;&gt;Registering devices from our Vendor with Apple Business Manager&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#apple-ecommerce-websites&quot;&gt;Apple ECommerce Websites&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#cdw&quot;&gt;CDW&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#shi&quot;&gt;SHI&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#workspace-one-configuration--workflow&quot;&gt;Workspace One Configuration &amp;amp; Workflow&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#scope-of-devices-for-enrollmentmanagement&quot;&gt;Scope of devices for enrollment/management&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#existing-devices&quot;&gt;Existing devices&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#macos&quot;&gt;macOS&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#windows&quot;&gt;Windows&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#zero-touch-provisioning-system&quot;&gt;Zero Touch Provisioning System&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#macos-1&quot;&gt;macOS&lt;/a&gt;
                &lt;ul&gt;
                  &lt;li&gt;&lt;a href=&quot;#installapplications&quot;&gt;installapplications&lt;/a&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#how-we-deployed-munki&quot;&gt;How we deployed Munki&lt;/a&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#how-new-employees-gain-admin-access&quot;&gt;How new employees gain admin access&lt;/a&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#user-experience&quot;&gt;User Experience&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#windows-1&quot;&gt;Windows&lt;/a&gt;
                &lt;ul&gt;
                  &lt;li&gt;&lt;a href=&quot;#autopilot--oobe&quot;&gt;Autopilot / OOBE&lt;/a&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#deployment-process--2-years-later&quot;&gt;Deployment Process ( ~2 Years Later)&lt;/a&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#chef-and-chocolatey&quot;&gt;Chef and Chocolatey&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#summary&quot;&gt;Summary&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#moving-forward&quot;&gt;Moving forward&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#outside-of-currentcompany&quot;&gt;Outside of $currentcompany&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#within-currentcompany&quot;&gt;Within $currentcompany&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#supporting-documents&quot;&gt;Supporting Documents&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;At &lt;a href=&quot;https://andrewdoering.org/#resume&quot;&gt;$previouscompany&lt;/a&gt; we had gone through a long struggle of managing devices properly. When I was hired in 2016, we had nothing in place for our entire company and everything was done manually. Our initial provisioning system focused on macOS as that was the most widely used OS within the company. It worked (slowly and barely) for two years (from 2016 - ~2018), and admittedly, we were still a small company at this point, roughly 250 max, however, the mistake had already been made as our biggest two years of growth were during this time period. However to continue to scale the companies operations, we needed to get an efficient and flexible system that incorporated both macOS and Windows.&lt;/p&gt;

&lt;p&gt;After an uphill battle, countless research documents, proposals, and explanations, we finally reached a point where it was agreed on that we would obtain an MDM solution. This will detail exactly what we went through in terms of deployments before MDM, during/after MDM, and going forward (with Windows 10 and Big Sur).&lt;/p&gt;

&lt;p&gt;This blog post has been written post-acquisition and about a year after our deployment of this process, this is not a summary of what have in active use, but the fundamentals we have used in the past. I attempted to make this with as less ranting and going on a tangent as possible. We will no longer be using this deployment method due to the acquisition.&lt;/p&gt;

&lt;h2 id=&quot;initial-deployment-process&quot;&gt;Initial Deployment Process&lt;/h2&gt;

&lt;p&gt;This is for the time period between 2016 and the end of 2017.&lt;/p&gt;

&lt;h3 id=&quot;what-we-used-on-macos&quot;&gt;What we used on macOS&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.deploystudio.com/&quot;&gt;DeployStudio&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/MagerValp/AutoDMG&quot;&gt;AutoDMG&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.munki.org/&quot;&gt;Munki&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/salopensource&quot;&gt;Sal&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grahamgilbert/crypt&quot;&gt;Crypt Client&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grahamgilbert/Crypt-Server&quot;&gt;Crypt Server&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/delize/local-LAPS-python&quot;&gt;Local LAPSmac&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To go into detail on this, we would create a prepared image from AutoDMG with the latest updates. We would go the “Golden Image” route. Once the golden image was prepared (which was a thin image, not a monolithic image), we would then drop it on our DeployStudio system and began the deployment process.&lt;/p&gt;

&lt;p&gt;We had several different workflows for each department and team, pre-installing the necessary software for them ahead of their onboarding (or at least what IT was told about). These would be installed after the image was installed on each machine.&lt;/p&gt;

&lt;p&gt;There were a few issues here that came out of this, the largest one was the ability to support macOS images that would become branched due to hardware revisions. The other was once the T2 chips were released, we couldn’t really use DeployStudio anymore, and finally manual builds were just overall time consuming and not worth it in the long run. No one should be manually building laptops at this point of device lifecycles (looking at you $currentcompany).&lt;/p&gt;

&lt;h3 id=&quot;what-we-used-on-windows&quot;&gt;What we used on Windows&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;OEM Windows 10 Image&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/johnnyramos/bitlocker2crypt&quot;&gt;Crypt Client&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Group Policy Scripts&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For our Windows deployment, there was minimal work needed, as we scripted up most of our onboarding processes, we definitely had some improvements to be made here, however Windows was always considered a lower priority compared to macOS - even tough about ~25% of our workforce was Windows based clients, and we have several build machines, and servers that were Windows based.&lt;/p&gt;

&lt;p&gt;We were also told that trying to get statistical and reporting on our Windows environment, to assist with evidence and provide data that we needed to improve our Windows environment, was not currently relevant when we went through this project (much to my disagreement, we abided by this and didn’t capture details). Even historical data to provide future projections were ignored. My reaction to these conversations is summed up by the following meme:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/10/mdm/giphy.gif&quot; alt=&quot;Ryan Reynolds&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;mdm-deployment-phase&quot;&gt;MDM Deployment Phase&lt;/h2&gt;

&lt;p&gt;This project was initiated at the beginning of 2018 and completed by mid-2018, the fundamental pieces of this workflow was used during and up to the acquisition.&lt;/p&gt;

&lt;h3 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h3&gt;

&lt;h4 id=&quot;what-we-used-on-macos-1&quot;&gt;What we used on macOS&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.munki.org/&quot;&gt;Munki&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/salopensource&quot;&gt;Sal&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grahamgilbert/crypt&quot;&gt;Crypt Client&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grahamgilbert/Crypt-Server&quot;&gt;Crypt Server&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/SAP/macOS-enterprise-privileges&quot;&gt;Privileges&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/macadmins/umad&quot;&gt;umad&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/macadmins/nudge&quot;&gt;nudge&lt;/a&gt; (and a more &lt;a href=&quot;https://github.com/LcTrKiD/nudge&quot;&gt;feature rich fork exists&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/macadmins/installapplications&quot;&gt;installapplications&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://gitlab.com/Mactroll/DEPNotify&quot;&gt;DEPNotify&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/chilcote/outset&quot;&gt;outset&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/support/certificates/&quot;&gt;Developer ID Installer Certificate&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://business.apple.com/&quot;&gt;Apple Business Manager&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Since we previously using Munki throughout our fleet, this made the MDM enrollment a lot easier.&lt;/p&gt;

&lt;h4 id=&quot;what-we-used-on-windows-1&quot;&gt;What we used on Windows&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.microsoft.com/en-us/microsoft-365/windows/windows-autopilot&quot;&gt;Windows Autopilot&lt;/a&gt; / &lt;a href=&quot;https://docs.vmware.com/en/VMware-Workspace-ONE-UEM/1903/Windows_Desktop_Device_Management/GUID-AWT-ENROLL-OOBE.html&quot;&gt;OOBE&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.chef.io/&quot;&gt;Chef&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://chocolatey.org/products/chocolatey-for-business&quot;&gt;Chocolatey&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/johnnyramos/bitlocker2crypt&quot;&gt;Crypt Client&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;registering-devices-from-our-vendor-with-apple-business-manager&quot;&gt;Registering devices from our Vendor with Apple Business Manager&lt;/h4&gt;

&lt;p&gt;We generally purchased all devices through CDW, SHI, or directly through an Apple Business Account based on location. For Apple, each reseller company has a DEP Reseller ID, and adding that DEP Reseller ID to your Business Account allows them to automatically register devices back into your MDM workflow.&lt;/p&gt;

&lt;h5 id=&quot;apple-ecommerce-websites&quot;&gt;Apple ECommerce Websites&lt;/h5&gt;

&lt;p&gt;We had apple business accounts in all of the regions that provide a business platform, for our business location registrations. &lt;a href=&quot;https://ecommerce.apple.com/content/b2b/static/en/us/flags.html&quot;&gt;This&lt;/a&gt; was very helpful, however there were limitations. The main limitation was a lack of automation around pulling assets into an asset management system.&lt;/p&gt;

&lt;h5 id=&quot;cdw&quot;&gt;CDW&lt;/h5&gt;

&lt;p&gt;We utilized a script that I wrote &lt;a href=&quot;https://github.com/delize/snipeit_cdw_automation&quot;&gt;here&lt;/a&gt; to upload data into SnipeIT. From there, we allowed CDW access to our environment for Apple Business Manager to upload device data. After initially looking at &lt;a href=&quot;https://www.microsoft.com/en-us/microsoft-365/windows/windows-autopilot&quot;&gt;Autopilot&lt;/a&gt;, &lt;a href=&quot;https://www.reddit.com/r/sysadmin/comments/8hpqoe/anybody_using_windows_10_autopilot/&quot;&gt;due to cost&lt;/a&gt; however, the same reasons in this reddit thread, we opted to go a different route. This is no fault to CDW, but the cost of Autopilot is absurd when similar services in other vendors are free and Microsoft offers it for free on Surface devices. If we were to deploy 1000 machines, at the cost of $10.00 per machine, $10,000.00 in addition to the laptop amount purchased.&lt;/p&gt;

&lt;h5 id=&quot;shi&quot;&gt;SHI&lt;/h5&gt;

&lt;p&gt;Generally we don’t purchase many EUC devices through SHI, but we added the DEP Reseller IDs to our ABM account anyways. We did not setup an integration for AzureAD/Windows Devices.&lt;/p&gt;

&lt;h3 id=&quot;workspace-one-configuration--workflow&quot;&gt;Workspace One Configuration &amp;amp; Workflow&lt;/h3&gt;

&lt;p&gt;I have already written up on our &lt;a href=&quot;https://andrewdoering.org/blog/2019/12/23/workspace-one-okta-users-and-groups-working-with-dep-enrollment/&quot;&gt;SAML and Directory Services deployment of Workspace One&lt;/a&gt;, however I have not described our existing setup.&lt;/p&gt;

&lt;h4 id=&quot;scope-of-devices-for-enrollmentmanagement&quot;&gt;Scope of devices for enrollment/management&lt;/h4&gt;

&lt;p&gt;The requirements we wanted to roll out:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Enroll existing devices&lt;/li&gt;
  &lt;li&gt;Enroll all new devices via Zero Touch Provisioning Scheme&lt;/li&gt;
  &lt;li&gt;Allow users to enroll their mobile phone(s), tablets, and personal devices&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The requirements we ended up with were:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Enroll existing devices&lt;/li&gt;
  &lt;li&gt;Enroll all new devices via Zero Touch Provisioning Scheme&lt;/li&gt;
  &lt;li&gt;Do nothing for mobile phones (BYOD)&lt;/li&gt;
  &lt;li&gt;Do nothing for Employee Owned / Personal Computing Devices (EOPD / BYOD)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Internally we did want to create programs for the bottom two items, we were not able to get anything green lit internally. Within IT, we saw the bottom two as potential risks, and the long term effort was to enable device trust and context based access via Okta to minimize data loss and that risk. We do not distribute phones from a company owned mobile plan. However there were issues at play from above that did not allow us to execute 3 or 4.&lt;/p&gt;

&lt;p&gt;With the scope settled, we took two different paths for existing vs new devices.&lt;/p&gt;

&lt;h4 id=&quot;existing-devices&quot;&gt;Existing devices&lt;/h4&gt;

&lt;h5 id=&quot;macos&quot;&gt;macOS&lt;/h5&gt;

&lt;p&gt;We created an organizational group specifically within Workspace One for previous devices within the company. Here we utilized &lt;a href=&quot;https://github.com/macadmins/umad&quot;&gt;umad&lt;/a&gt; a tool written by &lt;a href=&quot;https://blog.eriknicolasgomez.com/&quot;&gt;Erik Gomez&lt;/a&gt; and had two routes that would be taken:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;umad + DEP&lt;/li&gt;
  &lt;li&gt;umad + manual&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The bulk of our devices were DEP capable directly after deploying umad, and the majority of our team enrolled smoothly.&lt;/p&gt;

&lt;p&gt;From there, our first line support team (who were also our IT engineering team, yay for teams of 2!) would follow up on devices after about a week or two of deployment time. This was enough time for employees to enroll themselves, and in addition for the timer to kick in with umad to the point where it would become annoying enough for employees that did not enroll (to require an incident to be opened to either stop the pop ups or enroll into MDM).&lt;/p&gt;

&lt;h5 id=&quot;windows&quot;&gt;Windows&lt;/h5&gt;

&lt;p&gt;Windows has a self registration portal for enrolling devices into an MDM, located under the “Access work or school” in system settings, on the right side pane labeled &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Enroll only in Device Management&lt;/code&gt;. Utilizing this, users could self-enroll their devices as long as they had administrator access and secondary/additional software was not needed like it was for macOS.&lt;/p&gt;

&lt;h4 id=&quot;zero-touch-provisioning-system&quot;&gt;Zero Touch Provisioning System&lt;/h4&gt;

&lt;p&gt;Again, we created an organizational group specifically for new devices. This was meant to be a way that we could easily monitor devices being registered on a weekly basis for new employees. We had several other methods of doing this (eg: Sal), but this way, our IT team, InfoSec teams, and other teams could pull data out of Workspace One for all new devices rather than have the entire list of all previous devices.&lt;/p&gt;

&lt;h5 id=&quot;macos-1&quot;&gt;macOS&lt;/h5&gt;

&lt;h6 id=&quot;installapplications&quot;&gt;installapplications&lt;/h6&gt;

&lt;p&gt;We started development of this workflow with installapplications with version 1.0 and ended up finalizing the original deployment using 1.2.1. There is a &lt;a href=&quot;https://github.com/erikng/installapplicationsdemo&quot;&gt;great example repository here&lt;/a&gt;. We used this as our base example, but removed a substantial amount of scripts that were not relevant to us.&lt;/p&gt;

&lt;h6 id=&quot;how-we-deployed-munki&quot;&gt;How we deployed Munki&lt;/h6&gt;

&lt;p&gt;We compiled a smaller/custom version of Munki that allows us to do a single run of Munki against our web server hosting our manifests. With this single run, we implement a bootstrap manifest that runs once, and then our custom auto enroll kicks in and allows us to use the serial number subsequent Munki runs.&lt;/p&gt;

&lt;p&gt;Rolling our own:&lt;/p&gt;

&lt;p&gt;There is some documentation and several blog posts on how to compile Munki, rather than going in depth on how we did this and due to the length since we did this, I would prefer to &lt;a href=&quot;https://blog.eriknicolasgomez.com/2017/03/08/Custom-DEP-Part-2-Creating-a-custom-package-and-deploying-Munki/&quot;&gt;link&lt;/a&gt; &lt;a href=&quot;https://tombridge.com/2017/04/27/getting-started-with-installapplication-depnotify-and-simplemdm/&quot;&gt;different&lt;/a&gt; &lt;a href=&quot;https://therestoftheowl.com/blog/2018/11/09/installapplications-for-dummies-part-1/&quot;&gt;posts&lt;/a&gt; here.&lt;/p&gt;

&lt;p&gt;Manifests:&lt;/p&gt;

&lt;p&gt;We use a similar Munki deployment that follows the same principles as &lt;a href=&quot;https://github.com/edingc/munki-enroll&quot;&gt;Munki Enroll&lt;/a&gt; and &lt;a href=&quot;https://github.com/aysiu/munki-serial-enroll&quot;&gt;Munki Serial Enroll&lt;/a&gt;. However, our tool was internally developed and has not been released - namely our service does not rely on PHP. Our structure of our repos is described below:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/10/mdm/structure.png&quot; alt=&quot;Structure Diagram&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This way, we had the flexibility to deploy to a device, to a team/department, to a region, and globally across the domain.&lt;/p&gt;

&lt;h6 id=&quot;how-new-employees-gain-admin-access&quot;&gt;How new employees gain admin access&lt;/h6&gt;

&lt;p&gt;Before our acquisition, we did not grant admin access across the board to the company (due to InfoSec requirements), we only allowed a few departments (namely: engineering, InfoSec, customer success, and pre-sales solution engineers). Due to the flexibility of our Munki enrollments, it was quite easy to accomplish in this way.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://derflounder.wordpress.com/&quot;&gt;Rich Trouton&lt;/a&gt; at SAP has published &lt;a href=&quot;https://github.com/SAP/macOS-enterprise-privileges/&quot;&gt;Privileges.app&lt;/a&gt;. We use this in certain Munki manifests to automatically install and grant access, while also setting up a post install script to automatically run and enable admin access after Munki installed the application. We could do this natively &lt;a href=&quot;https://github.com/munki/munki/wiki/Managing-Admin-Rights-With-Munki&quot;&gt;with Munki&lt;/a&gt;, however we wanted to provide the opportunity for our engineers to dynamically switch admin context on the fly, and SAP’s tool allows us to do this.&lt;/p&gt;

&lt;h6 id=&quot;user-experience&quot;&gt;User Experience&lt;/h6&gt;

&lt;p&gt;We heavily utilized &lt;a href=&quot;https://gitlab.com/Mactroll/DEPNotify&quot;&gt;DEPNotify&lt;/a&gt; to inform our employees of the current status of their new device. A very generic image of our initial deployment (which can be seen by many other blogs) can be found below, however, we customized this a bit with stories on how ThousandEyes operates, our culture, and our history.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/10/mdm/macOS%20New%20Hire%20Guide_Page_6_Image_0002.png&quot; alt=&quot;DEPNotify experience&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After this, we would then reset the dock in place to set our generally most used services. This would consist of actual applications, or links/shortcuts to web applications (mainly G Suite services).&lt;/p&gt;

&lt;p&gt;We wanted to minimize the deployment time, configuration of a device shouldn’t take more than 15 to 20 minutes, any longer (in our mind, 30 minutes or more) and not only does it ruin the experience, it also is detrimental to the new employee as more could go wrong with the deployment. To make sure our intended deployment was less than 20 minutes we simulated a few environments. A 1 Megabit connection (worst case scenario), 1 Megabyte, 5 Megabytes, and Full Speed (in my testing - that is a 1 Gigabyte downstream on a home ISP). In testing the worst case scenario ended up being 23 minutes where the best case scenario ended up being between 10 - 15 minutes in a virtualized ESXi machine. We considered this successful.&lt;/p&gt;

&lt;p&gt;If something does go wrong with the deployment, we also created a package that would fire off a stand alone setup package that would install all the necessary tools that would have been installed during the first experience.&lt;/p&gt;

&lt;p&gt;Once their initial installation was finished, we would run JAMF Connect Sync on reboot logins to prompt the user to sync their password down from Okta to their local device.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/10/mdm/macOS%20New%20Hire%20Guide_Page_8_Image_0001.png&quot; alt=&quot;JAMF Connect Sync&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;windows-1&quot;&gt;Windows&lt;/h5&gt;

&lt;p&gt;The forgotten step-child, as I mentioned, trying to get anything done within our environment on Windows was difficult as management deemed it unnecessary. All the while our fleet deployment of windows was ~25% of our total systems. Fortunately, the improvements we made with macOS (and MDM in general) also were baked into (to a minimal degree) for Windows as well. Meaning, that remote employees and workforces could be rolled out without someone sitting next to the computer for 30 to 60 minutes configuring a PC. Unfortunately, we couldn’t use it in the provisioning process due to upper management.&lt;/p&gt;

&lt;p&gt;However, once covid happened, we had sudden approval to initiate Windows improvements.&lt;/p&gt;

&lt;h6 id=&quot;autopilot--oobe&quot;&gt;Autopilot / OOBE&lt;/h6&gt;

&lt;p&gt;Workspace One has a nice guide on how to setup both AutoPilot and OOBE that can be &lt;a href=&quot;https://techzone.vmware.com/enrolling-windows-10-devices-using-azure-ad-vmware-workspace-one-uem-operational-tutorial#1108817&quot;&gt;found here&lt;/a&gt;. This was the base we used to get our configuration off the ground and running. We did run into a hitch that I will describe a little later on.&lt;/p&gt;

&lt;h6 id=&quot;deployment-process--2-years-later&quot;&gt;Deployment Process ( ~2 Years Later)&lt;/h6&gt;

&lt;p&gt;For the Windows side, we configured &lt;a href=&quot;https://docs.vmware.com/en/VMware-Workspace-ONE-UEM/services/System_Settings_On_Prem/GUID-AWT-DEVICESUSERS-WINDOWS-WADS.html&quot;&gt;auto-discovery&lt;/a&gt; feature that Workspace One supports. This (minimally) shortens manual process by 2 to 3 steps. For automatic steps, it generally can help automate the entire process where end users do not have to fill in server configurations.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/10/mdm/Screen%20Shot%202020-10-17%20at%207.49.48%20PM.png&quot; alt=&quot;Workspace One Auto Discovery&quot; /&gt;&lt;/p&gt;

&lt;p&gt;While rolling this out for zero-touch, we did run into a single issue which unfortunately was a show stopper for zero-touch only. That is, when you have Active Directory previously hooked up to Okta, it causes issues when mapping &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;uniqueidentifiers&lt;/code&gt; vs &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ObjectGUID&lt;/code&gt;. We ultimately had to open up a support case to attempt to resolve this, and then were redirected to ProServices to fix the problem. By the time we got approval for ProServices, the announcement of an acquisition was announced the next day. The annoying part about this issue, is that it ONLY presented itself when utilizing AzureAD’s Workspace One VMware app during OOBE experience. If manual sign up using AzureAD Domain Join and manual enrollment into Workspace One MDM, it was not present.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/10/mdm/Screen%20Shot%202020-10-17%20at%208.27.16%20PM.png&quot; alt=&quot;External ID Error&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, because we already have 400+ accounts in O365, and an immutableID is well, immutable, we were not sure how to go through with this without causing massive issues. Unfortunately, this was never brought up to us until far after, and while writing this, I realized that there was some misconfigurations when going through our Professional Services with Workspace One that did not take into account this configuration in Okta and AzureAD.&lt;/p&gt;

&lt;p&gt;While Okta being federated does imitate ADSync, our federated configuration does not actually show up as an External Identity in AzureAD’s configuration.&lt;/p&gt;

&lt;p&gt;It does seem that Microsoft has finally allowed the ability to &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/active-directory/external-identities/user-flow-add-custom-attributes&quot;&gt;create custom attributes in AzureAD&lt;/a&gt;. This could have helped us with a workaround. However, if anyone &lt;strong&gt;does&lt;/strong&gt; know of a way to fix this issue, I would honestly love to hear it. There is &lt;a href=&quot;https://support.okta.com/help/servlet/fileField?id=0BE2A00000004Sj&quot;&gt;a lot&lt;/a&gt; of &lt;a href=&quot;https://www.okta.com/sites/default/files/Okta-3rd-Party-UEM-Interop_Workspace-ONE.pdf&quot;&gt;documentation&lt;/a&gt; &lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/Apps/Office365-Deployment/provision-users.htm&quot;&gt;I have&lt;/a&gt; read in the past, however even if we can’t/don’t use it going forward, just for completion and a way to close a loop here.&lt;/p&gt;

&lt;p&gt;We unfortunately went the manual route. Requiring users to sign in manually to Azure AD, and then manually sign into the MDM.&lt;/p&gt;

&lt;h6 id=&quot;chef-and-chocolatey&quot;&gt;Chef and Chocolatey&lt;/h6&gt;

&lt;p&gt;Once this was done, we setup the remaining equivalent scripts, and deployed our required applications for a short term roll out.&lt;/p&gt;

&lt;p&gt;Long term, the plan was to deploy &lt;a href=&quot;https://docs.chef.io/windows/&quot;&gt;Chef on Windows&lt;/a&gt;. With that, we would deploy &lt;a href=&quot;tey.org/products/chocolatey-for-business&quot;&gt;chocolatey&lt;/a&gt; and allow for a self service deployment of software similar to SCCM, but with far less expense.&lt;/p&gt;

&lt;p&gt;While we had a high level plan on the end states, we did not have a low level plan, and one of my peers wanted to take that over to get a better understanding of the NuGet framework. The idea here was that we would have Chef managing devices similar to Munki but utilizing the cookbooks of other companies like Facebook, Uber, and others. Once we got a baseline we would then start developing our own to utilize it more to our needs.&lt;/p&gt;

&lt;h3 id=&quot;summary&quot;&gt;Summary&lt;/h3&gt;

&lt;p&gt;As a reminder, these photos were taken during our initial deployments (and our documentation) and are not a current status of what we do, a lot of continual improvements have been performed throughout our initial deployment, and revamps have been made to customize this to exactly the way we want our users to experience deployments.&lt;/p&gt;

&lt;p&gt;Minimal to no input, while still having a great deal of flexibility in the deployment process. People should not have to question where to find details like Asset Tags, Serial Numbers, etc. However they should have the ability to fully customize their device.&lt;/p&gt;

&lt;p&gt;With all this setup and configured, it worked well and allowed a lot more time for our IT team that focused on engineering to take up new challenges, and allow our support team to have more time to focus on other services and functions that they need to worry about.&lt;/p&gt;

&lt;h2 id=&quot;moving-forward&quot;&gt;Moving forward&lt;/h2&gt;

&lt;h3 id=&quot;outside-of-currentcompany&quot;&gt;Outside of $currentcompany&lt;/h3&gt;

&lt;p&gt;Now that we are being acquired, all of our device management plan has been scrapped. However, with that said, I do want to make some comments on the direction of Big Sur and how the zero-touch provisioning system is changing.&lt;/p&gt;

&lt;p&gt;First and foremost, Python is getting removed in Big Sur. Meaning that you have to have roll your own in the deployment process. With &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;installapplications&lt;/code&gt;, this is no longer a problem as there is a version released with compatible python, however, this leads to other potential issues. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mdmclient&lt;/code&gt; on macOS is rather finicky and not entirely reliable. Since we now have to bundle python and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;installapplications&lt;/code&gt;, it raises the size from ~25 kilobytes to ~25 megabytes.&lt;/p&gt;

&lt;p&gt;A huge component of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;installapplications&lt;/code&gt; use cases come from the ability to display and load user land context for the user once they hit the desktop environment. However, there have been &lt;a href=&quot;https://macadmins.slack.com/archives/C54N3AT2B/p1601644844008600&quot;&gt;reports&lt;/a&gt; of this &lt;a href=&quot;https://macadmins.slack.com/archives/C54N3AT2B/p1601408174001500&quot;&gt;failing&lt;/a&gt; or not working as expected with macOS 11.0 Beta / Big Sur. Granted that due to Big Sur being in beta, there may be some unexpected behavior, but it seems the best route going forward is to no longer use DEP Notify directly launched from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;installapplications&lt;/code&gt;. Rather, use outset on first boot and set a flag to signify if DEPNotify had been run, and if not run it.&lt;/p&gt;

&lt;p&gt;Due to our deprecation of services, I am interested to see what comes out of Big Sur and Windows 10, and have been closely following both the &lt;a href=&quot;https://discord.me/winadmins&quot;&gt;Windows discord&lt;/a&gt; as well as the &lt;a href=&quot;https://www.macadmins.org/&quot;&gt;MacAdmins Slack&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;within-currentcompany&quot;&gt;Within $currentcompany&lt;/h3&gt;

&lt;p&gt;It will be interesting to see how a large legacy centric company attempts to convert to a cloud centric company with “traditional management” frameworks. The lack of use of Chef or Puppet on EUC devices, while not a limiting factor, does limit a lot of imagination and expansion room.&lt;/p&gt;

&lt;h2 id=&quot;supporting-documents&quot;&gt;Supporting Documents&lt;/h2&gt;

&lt;p&gt;While I don’t feel comfortable publishing our documentations around our processes, happy to distribute them privately if anyone may potentially need them or want to look at them. Feel free to comment below, and/or send me an &lt;a href=&quot;mailto:contact@andrewdoering.org&quot;&gt;email&lt;/a&gt;.&lt;/p&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Mobile Device Management" /><category term="macOS" /><category term="Windows" /><category term="installapplications" /><category term="nudge" /><category term="macOS" /><category term="workspace_one" /><category term="zero touch provisioning" /><category term="windows" /><category term="Okta" /><category term="DEP" /><category term="MDM" /><category term="device enrollment program" /><category term="mobile device management" /><category term="zero-touch provisioning" /><summary type="html">This blog post summarizes the thoughts and processes behind our deployment of workspace one to several hundred devices on both Windows and macOS.</summary></entry><entry><title type="html">Monitoring ZFS and Docker with TIG</title><link href="https://andrewdoering.org/blog/2020/10/11/monitoring-zfs-and-docker-with-tig/" rel="alternate" type="text/html" title="Monitoring ZFS and Docker with TIG" /><published>2020-10-11T08:00:00+00:00</published><updated>2020-10-11T08:00:00+00:00</updated><id>https://andrewdoering.org/blog/2020/10/11/monitoring-zfs-and-docker-with-tig</id><content type="html" xml:base="https://andrewdoering.org/blog/2020/10/11/monitoring-zfs-and-docker-with-tig/">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#getting-started&quot;&gt;Getting Started&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#getting-influxdb-and-grafana-running-in-docker&quot;&gt;Getting InfluxDB and Grafana running in Docker&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#configuring-telegraf&quot;&gt;Configuring Telegraf&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#configuring-influxdb&quot;&gt;Configuring InfluxDB&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#configuring-graphs-in-grafana&quot;&gt;Configuring Graphs in Grafana&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#future-things-i-want-to-do&quot;&gt;Future things I want to do&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;I just want to start off by saying, this is the first TIG stack deployment I have ever done, and was a lot easier then I expected (at least for this use case). I also have another use case of wanting to monitor logs to determine how often issues are appearing, and that use case could be a bit more challenging, however I have not done a lot of research into it.&lt;/p&gt;

&lt;p&gt;I have a homemade NAS system at home, that incorporates ESXi, Ubuntu, ZFS, and Docker for applications/services I want to run. One of the biggest issues I have is monitoring long term performance on the device. Because I am not running VSphere and am solely running ESXi, it makes it difficult to grab metrics from the hypervisor, so I am left to grab metrics from the guest.&lt;/p&gt;

&lt;p&gt;I wanted a way to have historical data from the system in case something went &lt;em&gt;horribly&lt;/em&gt; (not really, but maybe) wrong for troubleshooting purposes, being sent to another server.&lt;/p&gt;

&lt;p&gt;A bit of background on the system in place here, and yes - I am a data hoarder and a fan of data storage systems.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;TIG System Specs:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;CPU: Intel NUC 8i3BEH1&lt;/li&gt;
  &lt;li&gt;Memory: 16GB RAM&lt;/li&gt;
  &lt;li&gt;Storage: 1x 128 GB NVME&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;ESXi Hypervisor Specs:&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OS: ESXi 7.0&lt;/li&gt;
  &lt;li&gt;CPU: AMD Ryzen 7 1700 Eight-Core Processor&lt;/li&gt;
  &lt;li&gt;Memory: 64 GB ECC Memory&lt;/li&gt;
  &lt;li&gt;Storage:
    &lt;ul&gt;
      &lt;li&gt;NVME: 1x Samsung 970 Pro 1TB, 1x WD SN750 1TB&lt;/li&gt;
      &lt;li&gt;SSD: 2x Intel DC S3510 120 GB&lt;/li&gt;
      &lt;li&gt;SATA: 6x WD Red 6TB Drives&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;GPU: Nvidia GT 710&lt;/li&gt;
  &lt;li&gt;Motherboard: ASRock X470 Master SLI/AC&lt;/li&gt;
  &lt;li&gt;HBA: LSI 2008 PCI-E Card&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;NAS Guest Specs:&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OS: Ubuntu 20.04 LTS&lt;/li&gt;
  &lt;li&gt;Memory: 48 GB&lt;/li&gt;
  &lt;li&gt;Root Drive: 40 GB&lt;/li&gt;
  &lt;li&gt;Passthrough:
    &lt;ul&gt;
      &lt;li&gt;HBA: LSI SAS2008 PCI-Express Fusion-MPT SAS-2 Falcon rev. 03 (&lt;a href=&quot;https://forums.serverbuilds.net/t/guide-updating-your-lsi-sas-controller-with-a-uefi-motherboard/131&quot;&gt;Flashed to IT mode&lt;/a&gt;)&lt;/li&gt;
      &lt;li&gt;ZFS Pool: 32 TB (WD RED 6TB Drives - SATA_WDC_WD60EFRX-68L_WD)&lt;/li&gt;
      &lt;li&gt;Cache: 1TB&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You might think 48 GB of memory is overkill for a system that mainly deals with storage and a few applications. Unfortunately, not at the current moment - but I do agree, it is overkill. I also use rclone as an online storage system with Google Drive as a backend. Meaning this is my normal:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    nas:~$ free -mh
                total        used        free      shared  buff/cache   available
    Mem:           47Gi        31Gi       1.1Gi       9.0Mi        14Gi        15Gi
    Swap:         3.8Gi       3.0Gi       909Mi
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is definitely some room for improvement, don’t get me wrong, but at the moment. However, without any historical data to go off of and just looking at the above command fro time to time, it isn’t sufficient to fine tune it further and make optimizations.&lt;/p&gt;

&lt;p&gt;So with all that said and done, the things I wanted to monitor came out to be:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Memory Usage&lt;/li&gt;
  &lt;li&gt;CPU Usage&lt;/li&gt;
  &lt;li&gt;File System Usage&lt;/li&gt;
  &lt;li&gt;Docker&lt;/li&gt;
  &lt;li&gt;ZFS Pool&lt;/li&gt;
  &lt;li&gt;Network Traffic&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;getting-started&quot;&gt;Getting Started&lt;/h2&gt;

&lt;h2 id=&quot;getting-influxdb-and-grafana-running-in-docker&quot;&gt;Getting InfluxDB and Grafana running in Docker&lt;/h2&gt;

&lt;p&gt;Thankfully, Grafana and InfluxDB already provide decent out of the box docker images, so no modification is needed for a small scale deployment and what I am trying to accomplish.&lt;/p&gt;

&lt;p&gt;I started out doing this for my docker-compose file&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    version: '3.3'
    services:
        grafana:
            ports:
                - '3000:3000'
            container_name: grafana
            environment:
                - 'GF_INSTALL_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource'
            volumes:
                - '/media/docker/grafana/plugins:/var/lib/grafana/plugins'
                - '/media/docker/grafana/logs:/var/log/grafana'
                - '/media/docker/grafana/config:/etc/grafana/'
                - '/media/docker/grafana/data:/var/lib/grafana'
            restart: always
            image: grafana/grafana
            networks:
                - lame
        influxdb:
            container_name: influxdb
            ports:
                - '8086:8086'
                - '2003:2003'
            environment:
                - INFLUXDB_HTTP_AUTH_ENABLED=true
                - INFLUXDB_ADMIN_USER=$myuser
                - INFLUXDB_ADMIN_PASSWORD=$mysecret
            volumes:
                - '/media/docker/influxdb:/var/lib/influxdb'
            restart: always
            image: influxdb
            networks:
                - lame
    networks:
        lame:
            name: lame
            driver: bridge

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am aware Docker volume stores are supposedly the more supported/official way to go, due to their flexibility and ease of use, and honestly I do agree with that for larger scale systems. For my use case, it’s just more convenient to me to use bind mounts at the current moment.&lt;/p&gt;

&lt;p&gt;You might notice I don’t have a web front end (something like Nginx, Traefik) in use here. I am hosting this for internal use only and it is not publicly available. Any public facing service goes through a different endpoint entirely (an nginx entrypoint). If I was setting up TIG publicly,  I would consider using Traefik and enable docker swarm for ease of use. This is something I might do in the future, as I would love to implement Google’s oAuth service into Grafana, and at that point, I would feel more comfortable putting the service publicly on the internet for me to auth into.&lt;/p&gt;

&lt;p&gt;Anyways, getting back on track.&lt;/p&gt;

&lt;h3 id=&quot;configuring-telegraf&quot;&gt;Configuring Telegraf&lt;/h3&gt;

&lt;p&gt;Setting up telegraf is super easy, install the application, uncomment out the lines you want to monitor, and potentially add other information to.&lt;/p&gt;

&lt;p&gt;On your system that you want to monitor (in my case, the NAS), edit &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/telegraf/telegraf.conf&lt;/code&gt; with your favorite editor. An example of my configuration file is below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    cat /etc/telegraf/telegraf.conf | grep -v &quot;#&quot;
    [global_tags]
    user = &quot;$USER&quot;
    device = &quot;nas&quot;

    [agent]
    interval = &quot;5s&quot;
    round_interval = true
    metric_batch_size = 1000
    metric_buffer_limit = 10000
    collection_jitter = &quot;0s&quot;
    flush_interval = &quot;10s&quot;
    flush_jitter = &quot;0s&quot;
    precision = &quot;ms&quot;
    hostname = &quot;nas&quot;
    omit_hostname = false

    [[outputs.influxdb]]
    urls = [&quot;http://$TIGSERVER:8086&quot;]
    database = &quot;nas&quot;
    username = &quot;$muyser&quot;
    password = &quot;$mysecret&quot;

    [[outputs.health]]
    service_address = &quot;http://:20202&quot;
    read_timeout = &quot;5s&quot;
    write_timeout = &quot;5s&quot;
    basic_username = &quot;teegraf&quot;
    basic_password = &quot;P4ssw0rd!&quot;

    [[processors.date]]
        field_key = &quot;month&quot;
        date_format = &quot;Jan&quot;
        date_offset = &quot;0s&quot;
        timezone = &quot;America/Los_Angeles&quot;

    [[processors.enum]]
        [[processors.enum.mapping]]
        [processors.enum.mapping.value_mappings]

    [[processors.port_name]]
    tag = &quot;port&quot;
    dest = &quot;service&quot;


    [[processors.reverse_dns]]
    lookup_timeout = &quot;3s&quot;
    max_parallel_lookups = 10
    [[processors.reverse_dns.lookup]]


    [[inputs.cpu]]
    percpu = true
    totalcpu = true
    collect_cpu_time = false
    report_active = false

    [[inputs.disk]]
    ignore_fs = [&quot;tmpfs&quot;, &quot;devtmpfs&quot;, &quot;devfs&quot;, &quot;iso9660&quot;, &quot;overlay&quot;, &quot;aufs&quot;, &quot;squashfs&quot;]

    [[inputs.diskio]]
    device_tags = [&quot;ID_FS_TYPE&quot;, &quot;ID_FS_USAGE&quot;]
    name_templates = [&quot;$ID_FS_LABEL&quot;,&quot;$DM_VG_NAME/$DM_LV_NAME&quot;]

    [[inputs.kernel]]

    [[inputs.mem]]

    [[inputs.processes]]

    [[inputs.swap]]

    [[inputs.system]]

    [[inputs.cgroup]]
        paths = [
        &quot;/cgroup/memory&quot;,
        &quot;/cgroup/memory/child1&quot;,
        &quot;/cgroup/memory/child2/*&quot;,
        ]
        files = [&quot;memory.*usage*&quot;, &quot;memory.limit_in_bytes&quot;]

    [[inputs.dns_query]]
        servers = [&quot;192.168.2.2&quot;, &quot;1.1.1.1&quot;, &quot;8.8.8.8&quot;]
        domains = [&quot;google.com&quot;]

    [[inputs.docker]]
    endpoint = &quot;unix:///var/run/docker.sock&quot;
    gather_services = false
    container_names = []
    source_tag = false
    container_name_include = []
    container_state_include = []
    perdevice = true
    total = false

    [[inputs.ethtool]]
    interface_include = [&quot;eth0&quot;, &quot;ens160&quot;]
    interface_exclude = [&quot;eth1&quot;]

    [[inputs.internal]]
    collect_memstats = true

    [[inputs.kernel_vmstat]]

    [[inputs.linux_sysctl_fs]]

    [[inputs.net]]
        interfaces = [&quot;eth0&quot;, &quot;ens160&quot;]

    [[inputs.netstat]]

    [[inputs.ping]]
    urls = [&quot;google.com&quot;, &quot;192.168.2.1&quot;, &quot;192.168.2.2&quot;, &quot;andrewdoering.org&quot; ]

    [[inputs.smart]]
    use_sudo = true
    attributes = true
    timeout = &quot;30s&quot;

    [[inputs.sysstat]]
        sadf_path = &quot;/usr/bin/sadf&quot;
        activities = [&quot;DISK&quot;, &quot;INT&quot;, &quot;ALL&quot;, &quot;XALL&quot;, &quot;XDISK&quot;]
    [inputs.sysstat.options]
        -C = &quot;cpu&quot;
        -B = &quot;paging&quot;
        -b = &quot;io&quot;
        -q = &quot;queue&quot;
        &quot;-r ALL&quot; = &quot;mem_util&quot;
        &quot;-u ALL&quot; = &quot;cpu_util&quot;
        -v = &quot;inode&quot;
        -W = &quot;swap&quot;
        -w = &quot;task&quot;
        [[inputs.sysstat.device_tags.sda]]
        vg = &quot;rootvg&quot;

    [[inputs.systemd_units]]
    timeout = &quot;1s&quot;
    unittype = &quot;service&quot;

    [[inputs.temp]]

    [[inputs.zfs]]
    kstatPath = &quot;/proc/spl/kstat/zfs&quot;
    kstatMetrics = [&quot;abdstats&quot;, &quot;arcstats&quot;, &quot;dnodestats&quot;, &quot;dbufcachestats&quot;,
        &quot;dmu_tx&quot;, &quot;fm&quot;, &quot;vdev_mirror_stats&quot;, &quot;zfetchstats&quot;, &quot;zil&quot;]
    poolMetrics = true

    [[inputs.docker_log]]
        endpoint = &quot;unix:///var/run/docker.sock&quot;

    [[inputs.processes]]

    [[inputs.interrupts]]

    [[inputs.ipvs]]

    [[inputs.procstat]]
    pattern = &quot;httpd|java|python|telegraf|tomcat8|htop|apache2|www-data|rclone|docker&quot;
    user = &quot;daemon|root|telegraf|www-data|tomcat8|andrew&quot;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I won’t lie, I might have gone a bit overboard on the configuration of monitoring details, especially for what my original intent was to log. However, this achieves what I want. With this, I get a pretty decent reporting tool. Some improvements above could be using variables in the configuration file, to allow for the file to be replicated or used without having to modify or specialize it to specific systems. This is something I am planning on doing as I write up my ansible repo.&lt;/p&gt;

&lt;h3 id=&quot;configuring-influxdb&quot;&gt;Configuring InfluxDB&lt;/h3&gt;

&lt;p&gt;Considering this TIG is only monitoring a single host, I setup InfluxDB to have a longer retention time of the data, specifically two years worth of time. If it was monitoring several systems, I would probably lower this to 6 months for 5 devices, mainly just to be on the conservative side.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    auth
    create retention policy &quot;2_year&quot; on &quot;nas&quot; DURATION 104 replication 1
    alter retention policy &quot;autogen&quot; on &quot;nas&quot; duration 104w SHARD DURATION 104w DEFAULT
    show retention policies on nas
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once you have changed retention, and have telegraf running, double check that you have data feeding in correctly by checking one of the values, an example of that can be done by performing the following command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    &amp;gt; show tag values on nas from docker_container_status with key = container_name
    name: docker_container_status
    key            value
    ---            -----
    container_name apollo
    container_name athena
    container_name bazarr
    container_name bazarr-swedish
    container_name calibre
    container_name calibre-web
    container_name dionysus
    container_name jackett
    container_name lazylibrarian
    container_name lidarr
    container_name netdata
    container_name radarr
    container_name radarr-swedish
    container_name readarr
    container_name rutorrent
    container_name sonarr
    container_name sonarr-swedish
    container_name znc
    &amp;gt; 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From here, you should be able to start setting up graphs in Grafana.&lt;/p&gt;

&lt;h3 id=&quot;configuring-graphs-in-grafana&quot;&gt;Configuring Graphs in Grafana&lt;/h3&gt;

&lt;p&gt;Grafana hosts a lot of good template graphfs &lt;a href=&quot;https://grafana.com/grafana/dashboards&quot;&gt;here&lt;/a&gt;, and admittedly, a lot of them for my use case don’t work (beacuse I was not using Docker Swarm, or the default template just didn’t align with my database). So it required a bit of rework in some cases to fix the Variables configurations.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/10/docker-dashboard.png&quot; alt=&quot;Docker Dashboard&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When it comes to System Performance, I came across another pre-made graph, that had the features I wanted, but, didn’t work instantly when loading via the dashboard id. After a bit of tweaking to data sources, and Variables, I eventually got it working well and now have a rotating dashboard.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/10/system-dashboard.png&quot; alt=&quot;System Dashboard&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;future-things-i-want-to-do&quot;&gt;Future things I want to do&lt;/h2&gt;

&lt;p&gt;I really want to look into using &lt;a href=&quot;https://sriramajeyam.com/grafana-infinity-datasource/&quot;&gt;Grafana Infinity&lt;/a&gt; to pull public data, and have some ideas on using some of the other &lt;a href=&quot;https://grafana.com/grafana/plugins?type=datasource&quot;&gt;public plugins&lt;/a&gt;. As I mentioned, I really want to pull in logs from different systems as datasources, namely rclone, nginx/traefik, pihole, and unifi to name a few.&lt;/p&gt;

&lt;p&gt;I had done some research into scraping smart fans, and using temperature sensors as input data, but, living in a 400sqft apartment there is not a lot of variation, and unfortunately, I don’t have a lot of electrical outlets in my apartment. My entire bedroom has two.&lt;/p&gt;

&lt;p&gt;However, this was a pretty good learning experience, and a good start going forward. Plenty of room to expand as I get more space and more time to utilize it.&lt;/p&gt;

&lt;p&gt;I also reached out to some of my co-workers to see if they could tell me what the newest and best thing is, and have been hearing a lot about &lt;a href=&quot;http://netdata.cloud/&quot;&gt;netdata.cloud&lt;/a&gt;, so that is also something I may look at moving to in the long term.&lt;/p&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Monitoring" /><category term="docker" /><category term="tig" /><category term="zfs" /><category term="monitoring" /><category term="telegraf" /><category term="influxdb" /><category term="grafana" /><summary type="html">Long term monitoring with Telegraf, InfluxDB, and Grafana for Docker, ZFS, and System Performance. This will go into graph reporting and metrics.</summary></entry><entry><title type="html">Authorizing MongoDB Atlas users against Okta’s LDAP Groups</title><link href="https://andrewdoering.org/blog/2020/09/22/authorizing-mongodb-atlas-users-against-oktas-ldap-groups/" rel="alternate" type="text/html" title="Authorizing MongoDB Atlas users against Okta’s LDAP Groups" /><published>2020-09-22T13:00:00+00:00</published><updated>2020-11-20T04:00:00+00:00</updated><id>https://andrewdoering.org/blog/2020/09/22/authorizing-mongodb-atlas-users-against-oktas-ldap-groups</id><content type="html" xml:base="https://andrewdoering.org/blog/2020/09/22/authorizing-mongodb-atlas-users-against-oktas-ldap-groups/">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#issue&quot;&gt;Issue&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#solution&quot;&gt;Solution&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#update-20201117&quot;&gt;Update 2020/11/17&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#update-20201119&quot;&gt;Update 2020/11/19&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;As could be understood by my recent blog postings, we have been migrating to an Okta LDAP entry point as our primary LDAP service. Working towards a Cloud Centric first expectation. As could be imagined, there have been some issues popping up while moving infrastructure and making necessary changes. This describes one of these issues. One of these issues was the way that MongoDB Atlas handled LDAP look ups during the authorization process.&lt;/p&gt;

&lt;h1 id=&quot;issue&quot;&gt;Issue&lt;/h1&gt;

&lt;p&gt;When running MongoDB Versions equal to or lower than, 3.6.19, 4.0.20, 4.2.9 and using the Mongo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Query Template&lt;/code&gt; for Authorization on LDAP Interface :&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ou=groups,dc=&amp;lt;okta-instance-id&amp;gt;,dc=okta,dc=com??sub?(&amp;amp;(objectClass=groupofUniqueNames)(uniqueMember={USER}))&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;We would receive failed messages in the shell for MongoDB Atlas. While on the Okta side, we saw several rate limit messages.&lt;/p&gt;

&lt;p&gt;MongoDB did group lookups in an inefficient way due to excluding the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DN&lt;/code&gt; value and/or specifying a specific &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CN&lt;/code&gt; value from the lookup and attempting to broadly search for a single user within the group that the lookup is being performed on. Binding on every attempt to make a connection to Okta’s LDAP Interface. Effectively hammering Okta’s LDAP server - which has API limitations &lt;a href=&quot;https://developer.okta.com/docs/reference/rate-limits/&quot;&gt;outlined here&lt;/a&gt;. There was an &lt;a href=&quot;https://jira.mongodb.org/browse/SERVER-43233&quot;&gt;issue&lt;/a&gt; present on MongoDB’s public facing issue tracker (however, not realizing this before hand - we would never have known to look through 47968+ potential issues.)&lt;/p&gt;

&lt;p&gt;We reached out to Okta to request an increase to the API limit in the mean time while continuing to test around the issue which they performed on the following:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/api/v1/users/{id}/groups | READ / WRITE | EXACT_MATCH | 1000 / minute&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;However, even with the API increase, we still ended up running into events in the Okta System Log resulting in group lookups not being completed due to rate limiting, and on the MongoDB/Authorization side - failed authorization results.&lt;/p&gt;

&lt;p&gt;We ultimately raised a ticket internally with MongoDB Support, to ask if back porting the fix introduced into 4.4.* would be possible, however there was not an ETA at the present time.&lt;/p&gt;

&lt;h1 id=&quot;solution&quot;&gt;Solution&lt;/h1&gt;

&lt;p&gt;After several weeks of waiting for the issue to be back ported. It finally has! Beginning with MongoDB Atlas Versions 3.6.20, 4.0.21, and 4.2.10 you can use Okta’s LDAP Interface Okta mastered Groups for Authorization.&lt;/p&gt;

&lt;p&gt;The comments written directly by the PoC in charge of the incident filed:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    Please note that in order to utilize the Okta-optimized codepath, you MUST request the DN attribute in the authorization query explicitly.

    Here's the example configuration (swap the `yourdomain` below to your okta tenant domain, as well as be aware of the `your_service_account` ):


    LDAP server: yourdomain.ldap.okta.com
    Server Port: 636
    Bind Username: uid=your_service_account@domain.tld,dc=yourdomain,dc=okta,dc=com
    User To DN Mapping: [ { &quot;match&quot;: &quot;(.+)&quot;, &quot;substitution&quot;: &quot;uid={0},ou=users,dc=yourdomain,dc=okta,dc=com&quot; } ]
    Query Template: ou=groups,dc=yourdomain,dc=okta,dc=com?dn?one?(&amp;amp;(objectClass=groupofUniqueNames)(uniqueMember={USER}))
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once configured, you should be able to use Okta’s LDAP Interface in MongoDB Atlas and have successful Authorization results!&lt;/p&gt;

&lt;h1 id=&quot;update-20201117&quot;&gt;Update 2020/11/17&lt;/h1&gt;

&lt;p&gt;After writing and utilizing this more. We ran into issues with Mongo Compass, connecting to Mongo Atlas with Okta as the backend through the LDAPi. These issues are not present with mongo cli tools.&lt;/p&gt;

&lt;p&gt;After doing a decent amount of research and requesting Splunk logs from Okta, we came to the conclusion that Mongo logs out after each request/connection/session initiated. They do not keep a constant session open while the Compass software is connected to the clusters.&lt;/p&gt;

&lt;p&gt;In addition to this, instead of doing a single request to the cluster, multiple requests are made (usually 1 to 2) to each shard. The end result is that this spams the end user with (4 - 8) MFA requests.&lt;/p&gt;

&lt;p&gt;Our Company Default Okta authentication policy are already setup in a relaxed way:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;7 days for a known factor session&lt;/li&gt;
  &lt;li&gt;2 hour session lifetime&lt;/li&gt;
  &lt;li&gt;Prompt Mode in “per session” choice&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When going through Mongo support, they requested us to change Prompt Mode from “Per Session” to “Per Device”. This wouldn’t be very effective, as “Per Device” relies mostly on &lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/Security/improved-new-device-behavior-detection.htm&quot;&gt;session cookies or device context&lt;/a&gt;. Leaving the issue still present with no fix as of writing the update.&lt;/p&gt;

&lt;p&gt;So far we are waiting for this to proceed on Mongo, and have opened up a case with Okta to potentially resolve this going forward. For references if anyone else experiences similar issues:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Mongo Case is: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;00693506&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Okta case is: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;00992849&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you would like to or prefer to reach out to the vendors for potential solutions if I don’t post them here. Or leave a comment below.&lt;/p&gt;

&lt;h1 id=&quot;update-20201119&quot;&gt;Update 2020/11/19&lt;/h1&gt;

&lt;p&gt;MongoDB provided an update to us to use the following connection URI:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mongodb+srv://ldapuser:str0ngpassword@mymongo.xxx.xxx/test?authMechanism=PLAIN&amp;amp;maxPoolSize=1&amp;amp;readPreference=secondary&amp;amp;authSource=%24external&amp;amp;appname=MongoDB%20Compass&amp;amp;ssl=false&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This does seem to work, notice the addition of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;maxPoolSize=1&lt;/code&gt;, but, there are two concerns that I have with this:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;ssl=false&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;What limitations/implications does the addition of the value above have on the overall performance on mongo compass?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Initial reactions would be that Compass may not display/return all results within the cluster, as they may not have replicated over to the connected shard instance. I tested initially with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;ssl=true&lt;/code&gt; without any major issue, so it seems like that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;ssl=false&lt;/code&gt; aspect may just be an error/mistype.&lt;/p&gt;

&lt;p&gt;While I would consider this a workaround for the time being, there are definitely improvements that need to be made into the outbound LDAP requests being made on the Mongo side, or alternatively, Okta needs to implement more flexibility around the LDAP Interface itself.&lt;/p&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Identity Access Management" /><category term="Okta" /><category term="LDAP Interface" /><category term="MongoDB Atlas" /><category term="Cloud" /><category term="Authorization" /><category term="Authentication" /><summary type="html">Previously MongoDB systems earlier than 4.4 versions, did not properly support doing lookups in Okta's LDAP interface properly, but recently that has changed. Come find out how!</summary></entry><entry><title type="html">Infrastructure Engineer Deployment - Example</title><link href="https://andrewdoering.org/blog/2020/09/02/infrastructure-engineer-deployment-example/" rel="alternate" type="text/html" title="Infrastructure Engineer Deployment - Example" /><published>2020-09-02T01:20:49+00:00</published><updated>2020-09-02T01:20:49+00:00</updated><id>https://andrewdoering.org/blog/2020/09/02/infrastructure-engineer-deployment-example</id><content type="html" xml:base="https://andrewdoering.org/blog/2020/09/02/infrastructure-engineer-deployment-example/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;I created the following document as part of a challenge for an interview for an Infrastructure Engineer position located in another country, and while I ultimately didn’t get the position due to extenuating circumstances (namely due to the current Pandemic and Visa/Work Permits), I spent a lot of time on this document, and would like to publish it for others - maybe it could give them some ideas going forward. This is intended as high level work, not as a detailed document or 100% accurate in terms of deployment.&lt;/p&gt;

&lt;p&gt;This is nearly verbatim to the document that was sent in for the homework assignment, with some minor wording and documentation edits.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#assignment--request&quot;&gt;Assignment / Request&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#assumptions&quot;&gt;Assumptions&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#deployment&quot;&gt;Deployment&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#options-for-services&quot;&gt;Options for Services&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#hardware&quot;&gt;Hardware&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#services-infrastructure-deployment&quot;&gt;Services infrastructure deployment&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#network-logistics&quot;&gt;Network Logistics&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#subnetting&quot;&gt;Subnetting&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#corp&quot;&gt;Corp&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#cloud&quot;&gt;Cloud&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#corporate-network&quot;&gt;Corporate Network&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#initial-deployment&quot;&gt;Initial Deployment&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#future-improvements&quot;&gt;Future Improvements&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#firewall&quot;&gt;Firewall&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#qos&quot;&gt;QoS&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#guest-network&quot;&gt;Guest Network&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#cloud-network&quot;&gt;Cloud Network&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#vpn&quot;&gt;VPN&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#cloud-infrastructure&quot;&gt;Cloud Infrastructure&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#asset-management-cloud-and-ipam-cloud&quot;&gt;Asset Management (Cloud) and IPAM (Cloud)&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#asset-management&quot;&gt;Asset Management&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ipam&quot;&gt;IPAM&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#deployment-steps&quot;&gt;Deployment Steps&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#asset-management-1&quot;&gt;Asset Management&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#cicd-system&quot;&gt;CI/CD System&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#identity-management-infrastructure&quot;&gt;Identity Management Infrastructure&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#task-management&quot;&gt;Task Management&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#jira-cloud-vs-jira-server&quot;&gt;Jira Cloud vs Jira Server&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#future-plans&quot;&gt;Future Plans&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#summarization&quot;&gt;Summarization&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#appendix&quot;&gt;Appendix:&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#supporting-files&quot;&gt;Supporting Files&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#list-of-infrastructure-services-to-deploy&quot;&gt;List of Infrastructure Services to Deploy&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#example-docker-compose-for-snipeit-hosted-in-gcp&quot;&gt;Example docker-compose for SnipeIT hosted in GCP&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#gcloud-compute-scripts-for-an-active-directory-deployment&quot;&gt;GCloud Compute Scripts for an Active Directory Deployment&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#networking-and-software-equipment&quot;&gt;Networking and Software Equipment&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;assignment--request&quot;&gt;Assignment / Request&lt;/h1&gt;
&lt;p&gt;Our team would like for you to create a plan for deploying a network infrastructure plan for a new company.
At the moment, the company does not have any existing infrastructure so it’s up to you to create one!&lt;/p&gt;

&lt;p&gt;The requirements and technical limitations are as follows:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;There are three offices, one office will be the headquarters and the other two will be satellite offices. The headquarters will have both R&amp;amp;D and support staff (ie. finances) the remote offices will consist of just R&amp;amp;D.&lt;/li&gt;
  &lt;li&gt;The work from home employees will need to connect via a VPN.&lt;/li&gt;
  &lt;li&gt;The headquarters will have some infrastructure as well as one of the satellite offices. The other satellite office will not.&lt;/li&gt;
  &lt;li&gt;To reduce operational costs; the R&amp;amp;D department would like to deploy some infrastructure in the cloud.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The plan should include; but not necessarily be limited to; the following topics:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Hardware and software to use (the company is keen on virtual infrastructure or cloud where possible), and the reasons why.&lt;/li&gt;
  &lt;li&gt;Requirements for subnets, routing, security, connectivity, etc.&lt;/li&gt;
  &lt;li&gt;Abstract configuration for the software (in broad terms - we don’t need every field detailed!).&lt;/li&gt;
  &lt;li&gt;A brief sketch of any processes the company may wish to consider deploying in the future to aid in network and data management.&lt;/li&gt;
  &lt;li&gt;Some scripting examples of compute resource deployment in the cloud.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We’re not looking for a huge report here; this is primarily an exercise in research and reasoning, along with a demonstration of knowledge of infrastructure requirements.&lt;/p&gt;

&lt;h2 id=&quot;assumptions&quot;&gt;Assumptions&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;As employee size is not defined, I will assume 200 current employees scaling to 500 employees. Update 2020/06/22, Recruiter mentioned that employee size was ~300.&lt;/li&gt;
  &lt;li&gt;As office infrastructure is not defined or categorized as corporate, platform, or both, I assume corporate infrastructure will be deployed in offices only, as hosting elements of platform infrastructure in an office environment is not a best practice. Update 2020/06/22, Recruiter confirmed.&lt;/li&gt;
  &lt;li&gt;Cloud infrastructure will also have parts of corporate infrastructure for scalability purposes.&lt;/li&gt;
  &lt;li&gt;Non essential network services (dhcp, dns, etc) should be located in the cloud to allow for accessibility and modularity to offices and remote employees. However, the ability to deploy into office infrastructures should be available&lt;/li&gt;
  &lt;li&gt;Services that operate in the cloud have volatility. Office and cloud infrastructure should be able to handle volatile availability.&lt;/li&gt;
  &lt;li&gt;I am unaware if End User Device infrastructure is a part of this configuration. I have included my past experience with it as a way to complete the infrastructure trifecta (corp, euc, platform). However I will not go into detail here outside of listing the services needed.&lt;/li&gt;
  &lt;li&gt;Laptop Infrastructure (macOS and Windows) images are considered satisfactory from the OEM and no “golden image” is required.&lt;/li&gt;
  &lt;li&gt;Infrastructure Rack is provided by building management&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;deployment&quot;&gt;Deployment&lt;/h1&gt;

&lt;p&gt;These are options to deploy the new infrastructure. These are based on two factors:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;personal experience with each service&lt;/li&gt;
  &lt;li&gt;the flexibility provided by each one&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;options-for-services&quot;&gt;Options for Services&lt;/h2&gt;

&lt;p&gt;For a list of infrastructure options for deployment, and to reduce space in this document, please see &lt;a href=&quot;#list-of-infrastructure-services-to-deploy&quot;&gt;the appendix&lt;/a&gt; for an extended list of Cloud and SaaS based services.&lt;/p&gt;

&lt;h2 id=&quot;hardware&quot;&gt;Hardware&lt;/h2&gt;

&lt;p&gt;Please see the &lt;a href=&quot;#networking-and-software-equipment&quot;&gt;Appendix&lt;/a&gt; for a complete list of hardware to buy per office. I really appreciate the Meraki Stack. However, I have not deployed their switches in a production environment; I have only deployed their Access Points. I would need to research more about the benefits and cons of the MS lineup; however, I would highly look into that platform before deploying the switches. As long as the switches can support teaming/bonding, Spanning Tree Protocol, at a minimum, the network configuration should be suitable.&lt;/p&gt;

&lt;h2 id=&quot;services-infrastructure-deployment&quot;&gt;Services infrastructure deployment&lt;/h2&gt;

&lt;p&gt;The sections below are based on the options above and my recommendations for deployment of the company’s new infrastructure for each office and remote location. Cloud infrastructure will be deployed in GCP. Diagrams will be provided where I find it adds relevance or workflow assistance. Since we won’t be repeatedly building this for a platform infrastructure, we will be using Kubernetes where possible. If we were deploying for the product or platform, we could use the App Engine platform within GCP. This is not a comprehensive list of all configurations, but, it is extensive enough for a homework lab assignment.&lt;/p&gt;

&lt;h1 id=&quot;network-logistics&quot;&gt;Network Logistics&lt;/h1&gt;

&lt;h2 id=&quot;subnetting&quot;&gt;Subnetting&lt;/h2&gt;

&lt;h3 id=&quot;corp&quot;&gt;Corp&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Office&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Level&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Use&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;IP Prefix&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Floor ID&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;VLAN ID&lt;/th&gt;
      &lt;th&gt;Client Address&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;CIDR Mask&lt;/th&gt;
      &lt;th&gt;IP Network&lt;/th&gt;
      &lt;th&gt;Office Domain&lt;/th&gt;
      &lt;th&gt; &lt;/th&gt;
      &lt;th&gt;Notes&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;DMZ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.5.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;General&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;100&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.100.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Will use closest three letter IATA code for domain&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Engineering&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;110&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.110.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Operations&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;99&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.99.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;VoIP/Conferencing&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;50&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.50.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Printers&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;60&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.60.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Servers&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;70&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.70.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;DHCP, Windows, etc (Services being run from esxi servers)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;mgmt&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;80&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.80.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Access Points, ESXi servers&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;HQ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;GUEST&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;201&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;192&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.201.192.X/24&lt;/td&gt;
      &lt;td&gt;osl1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Guest ONLY VLAN&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;BO1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;General&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;202&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;100&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.202.100.X/24&lt;/td&gt;
      &lt;td&gt;hrw1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;BO1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Engineering&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;202&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;110&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.202.110.X/24&lt;/td&gt;
      &lt;td&gt;hrw1.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;BO2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1st&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Engineering&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;203&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;110&lt;/td&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;/24&lt;/td&gt;
      &lt;td&gt;10.203.110.X/24&lt;/td&gt;
      &lt;td&gt;osl2.o.company.com&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;This is a simple configuration and can be more complex if needed. This also leaves plenty of room to grow as the department grows. It also allows you to specify VLAN IDs to be based on department groups. This does create a problem where you may run into more than 50 combined office locations or floors. If this is the case, removing the N+1 function of the floors in FloorID and changing to Building ID could resolve any capacity issues. If this is still a problem, you could expand on the VLAN ID as a VLAN+Floor ID. Though this could ultimately cause confusion and something I don’t recommend.&lt;/p&gt;

&lt;h3 id=&quot;cloud&quot;&gt;Cloud&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Use Case&lt;/th&gt;
      &lt;th&gt;IP Start&lt;/th&gt;
      &lt;th&gt;IP End&lt;/th&gt;
      &lt;th&gt;CIDR&lt;/th&gt;
      &lt;th&gt;Notes&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Platform&lt;/td&gt;
      &lt;td&gt;10.0.0.0&lt;/td&gt;
      &lt;td&gt;10.99.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt;This is a total of 6553400 IPs for the platform, from here engineers can then divide the network up as needed for their own services. This would be split out individually, but for the sake of time, I have lumped the whole range together here, and denoted that it has a 16 for each subnet.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Staging-Platform&lt;/td&gt;
      &lt;td&gt;10.100.0.0&lt;/td&gt;
      &lt;td&gt;10.100.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt;Within this range, there should be a sufficient amount of IP Addresses for a Staging Network as well.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Staging-Platform&lt;/td&gt;
      &lt;td&gt;10.101.0.0&lt;/td&gt;
      &lt;td&gt;10.101.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Staging-Platform&lt;/td&gt;
      &lt;td&gt;10.102.0.0&lt;/td&gt;
      &lt;td&gt;10.102.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Staging-Platform&lt;/td&gt;
      &lt;td&gt;10.103.0.0&lt;/td&gt;
      &lt;td&gt;10.103.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Reserved&lt;/td&gt;
      &lt;td&gt;10.104.0.0&lt;/td&gt;
      &lt;td&gt;10.127.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt;Reserved for future uses for the engineering and product&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.128.0.0&lt;/td&gt;
      &lt;td&gt;10.128.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.129.0.0&lt;/td&gt;
      &lt;td&gt;10.129.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.130.0.0&lt;/td&gt;
      &lt;td&gt;10.130.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.131.0.0&lt;/td&gt;
      &lt;td&gt;10.131.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.132.0.0&lt;/td&gt;
      &lt;td&gt;10.132.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.133.0.0&lt;/td&gt;
      &lt;td&gt;10.133.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.134.0.0&lt;/td&gt;
      &lt;td&gt;10.134.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.135.0.0&lt;/td&gt;
      &lt;td&gt;10.135.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.136.0.0&lt;/td&gt;
      &lt;td&gt;10.136.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Infrastructure&lt;/td&gt;
      &lt;td&gt;10.137.0.0&lt;/td&gt;
      &lt;td&gt;10.137.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Staging-Infrastructure&lt;/td&gt;
      &lt;td&gt;10.138.0.0&lt;/td&gt;
      &lt;td&gt;10.138.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Staging-Infrastructure&lt;/td&gt;
      &lt;td&gt;10.139.0.0&lt;/td&gt;
      &lt;td&gt;10.139.255.254&lt;/td&gt;
      &lt;td&gt;16&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;corporate-network&quot;&gt;Corporate Network&lt;/h2&gt;

&lt;h3 id=&quot;initial-deployment&quot;&gt;Initial Deployment&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Office-Physical_Topology_v1.png&quot;&gt;Physical Topology Diagram Link&lt;/a&gt;&lt;/strong&gt;:
&lt;img src=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Office-Physical_Topology_v1.png&quot; alt=&quot;Physical Topology Diagram Link&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Office-Logical_Topology_(Simplified)_v1.png&quot;&gt;Logical Topology Diagram Link&lt;/a&gt;&lt;/strong&gt;
&lt;img src=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Office-Logical_Topology_(Simplified)_v1.png&quot; alt=&quot;Logical Topology Diagram Link&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As core/distribution switches have much higher failure rates compared to access switches (due to the amount of services running on the core switches), we would be routing traffic via layer 2 mechanisms rather than layer 2 and taking advantage of layer 3 services in the firewall to deal with routing. We would utilize vlans broadcast at specific ports to be able to achieve this. This results in a less expensive network overall.&lt;/p&gt;

&lt;p&gt;Ideally, through the use of the IAM tools we will be using later on in the document, we can utilize a full cloud stack for RADIUS for end user wifi authentication. The reasoning behind cloud RADIUS is that if your ISP(s) are down, you will not have much use of the on premise system since you won’t be able to access most of the remote services anyways due to the down(ed) ISP(s). With the RADIUS instances locally, you would be able to authenticate locally to the network and access any services though. While the most secure method is EAP-TLS, it is highly inconvenient. Due to that, my recommendation would be to use EAP-TTLS.&lt;/p&gt;

&lt;p&gt;Keeping the DHCP and DNS configurations (zones, static addresses, etc files if required) into a revision control tool (such as Github) would be a good first step if required. We can later automate and make improvements on the deployment of DHCP and DNS configuration files. While using embedded software in the Firewall would be possible, it’s difficult for people to look at the services if they don’t have access to the Firewalls. However for simplicity sake, using the firewall’s DHCP server should be sufficient if there is not a requirement where the firewall would not be able to perform.&lt;/p&gt;

&lt;p&gt;Based on the number of employees per office, 500 Mbps lines as a minimum would be required, and 1 Gbps lines would be highly recommended. A backup line with a separate ISP would be required in case the first line goes down or switch goes down, but the speed does not need to be the same as the primary line - 100 to 250 Mbps should be fine. Especially with people in the office streaming music, high quality video, and other things.&lt;/p&gt;

&lt;h3 id=&quot;future-improvements&quot;&gt;Future Improvements&lt;/h3&gt;

&lt;p&gt;Deployment of SDN/SD-Wan using VeloCloud, Meraki, or Juniper Sky, to streamline the deployment, management,inter-office communication, and/or the cloud infrastructure data center connection.   Based on the build process, this could be accomplished two ways:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Physical device that sits in front of the firewall&lt;/li&gt;
  &lt;li&gt;Virtualized SD-WAN appliance that exists in the hypervisor&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;If going with step two, the best decision to converge all services where they are most compatible, so choosing ESXi/VSphere now for the Hypervisor with a velocloud virtual device makes sense so that you could have finer control over the networking plane.&lt;/p&gt;

&lt;p&gt;In addition to the above, if we want to keep the dhcp server and dns server configuration (and address leases) in a change management and revision service (IE: Github Cloud), we could eventually hook the repository into a CI/CD system to automate the deployment of DHCP and DNS packages to each corporate office through a package repository system. However longer term, the plan should be to move off managed DHCP/DNS internally to minimize complexity to the infrastructure. In this way, your managed network stack boils down to just Firewall, Switch, IDS/IPS, and Access Points.&lt;/p&gt;

&lt;p&gt;Before automation tools and the like are installed, you would want to implement logging, monitoring, and alerting to be aware of issues that are brought up across the network. The tools mentioned in LAMES are good for that, specifically when it comes to host monitoring, and using APIs and other sources. These can generate several graphs to determine baselines.&lt;/p&gt;

&lt;p&gt;To implement network monitoring, not considering my current employer, a good place to consult are Gartner reports as a source of information. Gartner has also sunsetted their Magic Quadrant NPM reports for &lt;a href=&quot;https://www.gartner.com/en/documents/3981838/market-guide-for-network-performance-monitoring-and-diag&quot;&gt;Market Guides&lt;/a&gt;, and more companies are moving into the &lt;a href=&quot;https://www.gartner.com/en/documents/3956998/market-guide-for-digital-experience-monitoring&quot;&gt;Digital Experience Monitoring&lt;/a&gt; space. However, from an internal network perspective and focusing on open source tools, using a combination of ElasticSearch, Logstash, Kibana, Grafana, and open source forwarders (osquery, telegraf, etc.), you can accumulate decent network monitoring tools. I previously had experience with Nagios, but it had deficiencies compared to the set of tools above. In addition, using Network Performance Monitoring tools is becoming increasingly hard due to increased security around packets - overall a good thing.&lt;/p&gt;

&lt;p&gt;Lastly, short of keeping and manually exporting the configuration set of the switch or firewall, a tool that can automate the backups of the switch and firewall directly into a datastore would be required.&lt;/p&gt;

&lt;h3 id=&quot;firewall&quot;&gt;Firewall&lt;/h3&gt;

&lt;p&gt;I find that firewalls that set a “drop all rule” rather than a “drop specific/known malicious services” can be too restrictive. I would say that continually monitoring the firewall for the first few weeks of a new deployment would be a better part of the deployment process. That said, the initial process should be to get a list of known services to implement and run (for instance, Active Directory on premise, Video Conferencing, SIP, etc) and then be sure to specify port rules closely. If the rules are too vague, reach out to the vendor to collect that information. In addition, make sure to follow guidelines based on &lt;a href=&quot;https://tsapps.nist.gov/publication/get_pdf.cfm?pub_id=901083&quot;&gt;NIST&lt;/a&gt; and alternatives.&lt;/p&gt;

&lt;p&gt;Since we are using Palo Alto firewalls and they have the ability to firewall services (IE: Applications) as well as specific ports, we can be very dynamic when it comes to firewall allowance. A (very rudimentary) example can be found below, as well:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Ingress (inbound)&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;VPN Protocols&lt;/li&gt;
  &lt;li&gt;Block all traffic&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;Egress (outside)&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;HTTP&lt;/li&gt;
  &lt;li&gt;HTTPS&lt;/li&gt;
  &lt;li&gt;DNS&lt;/li&gt;
  &lt;li&gt;IMAP&lt;/li&gt;
  &lt;li&gt;POP&lt;/li&gt;
  &lt;li&gt;SMTP&lt;/li&gt;
  &lt;li&gt;ssh&lt;/li&gt;
  &lt;li&gt;SIP&lt;/li&gt;
  &lt;li&gt;Zoom / WebEx / PEXIP&lt;/li&gt;
  &lt;li&gt;Other required services&lt;/li&gt;
  &lt;li&gt;Block all&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;Inside (intra-vlan)&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;ping&lt;/li&gt;
  &lt;li&gt;Telnet / netcat&lt;/li&gt;
  &lt;li&gt;Multicast&lt;/li&gt;
  &lt;li&gt;ssh&lt;/li&gt;
  &lt;li&gt;Block other traffic&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;qos&quot;&gt;QoS&lt;/h3&gt;
&lt;p&gt;Splitting out the single lane of QoS into multiple lanes, and transmitting Real Time Packets (Video, Audio, Multimedia streaming, etc) and non real time packets (http, messaging services, imap/pop, smtp, etc) is beneficial. There are multiple ways to configure QoS in Palo Alto devices. It would be helpful. As the Pexip platform supports &lt;a href=&quot;https://docs.pexip.com/admin/infinity_features.htm&quot;&gt;DSCP marking&lt;/a&gt;, in addition so does &lt;a href=&quot;https://support.zoom.us/hc/en-us/articles/207368756-QoS-DSCP-Marking&quot;&gt;Zoom&lt;/a&gt;, and &lt;a href=&quot;https://help.webex.com/en-us/WBX83779/What-are-the-System-Requirements-for-Cisco-Webex-Video-Platform&quot;&gt;WebEx&lt;/a&gt; &lt;a href=&quot;https://help.webex.com/en-us/WBX83779/What-are-the-System-Requirements-for-Cisco-Webex-Video-Platform&quot;&gt;does as well&lt;/a&gt; we can also &lt;a href=&quot;https://docs.paloaltonetworks.com/pan-os/9-0/pan-os-admin/quality-of-service/enforce-qos-based-on-dscp-classification.html&quot;&gt;configure Palo Alto&lt;/a&gt; to recognize the markings as well.&lt;/p&gt;

&lt;h3 id=&quot;guest-network&quot;&gt;Guest Network&lt;/h3&gt;

&lt;p&gt;The guest network would be firewalled off from the rest of the network, running under 192.168.1.0/24 subnet. Traffic would only be confined to this network, and would not be able to traverse outside the 192.168.1.0/24 subnet.&lt;/p&gt;

&lt;h3 id=&quot;cloud-network&quot;&gt;Cloud Network&lt;/h3&gt;

&lt;p&gt;The de facto way to connect branch offices to the cloud, is using IPSec tunnels. The IPSec tunnel can be configured in the same subnet space as 172.168.0.0/18 space described in the next space, after the Operations subnet space. 
Future Improvements&lt;/p&gt;

&lt;p&gt;The other consideration could be a zero-trust/beyondcorp model. The idea behind this is using certificates and other device state facts, that can be incorporated into the use of trusted devices on untrusted networks, without the use of VPN. This would make remote employees’ lives much easier when it comes to management of infrastructure, access to infrastructure, and flexibility on access to services. The idea behind this is making tons of contextually aware identity proxies that allow access to services around the network. This is similar to Google’s Cloud Identity Access systems.&lt;/p&gt;

&lt;p&gt;The same method of Office Networks, incorporating SD-WAN here, could be beneficial to help ease the pain of manually creating IPSec tunnels between the environments.&lt;/p&gt;

&lt;h3 id=&quot;vpn&quot;&gt;VPN&lt;/h3&gt;

&lt;p&gt;The VPN should be hosted in the cloud, and run off a 172.16.0.0/18 Subnet for maximum compatibility to both the corporate and cloud network.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Profile&lt;/th&gt;
      &lt;th&gt;IP&lt;/th&gt;
      &lt;th&gt;Default Route&lt;/th&gt;
      &lt;th&gt;Notes&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;HQ-Route&lt;/td&gt;
      &lt;td&gt;172.16.1.0/24&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt;Default Routes are only used for the purpose of client access, or more secure access to services. Generally, Default Routes should not be necessary for clients connecting to the VPN. However if Customer requires specific IP addresses for access to services, this would be the access used.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;HQ&lt;/td&gt;
      &lt;td&gt;172.16.2.0/24&lt;/td&gt;
      &lt;td&gt;No&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;BranchOffice&lt;/td&gt;
      &lt;td&gt;172.16.3.0/24&lt;/td&gt;
      &lt;td&gt;No&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;General-Route&lt;/td&gt;
      &lt;td&gt;172.16.4.0-172.16.7.254/22&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;General&lt;/td&gt;
      &lt;td&gt;172.16.8.0-172.16.11.254/22&lt;/td&gt;
      &lt;td&gt;No&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Engineering-Route&lt;/td&gt;
      &lt;td&gt;172.16.12.0-172.16.15.254/22&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt;Has access to Platform network in Cloud&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Engineering&lt;/td&gt;
      &lt;td&gt;172.16.16.0-172.16.19.254/22&lt;/td&gt;
      &lt;td&gt;No&lt;/td&gt;
      &lt;td&gt;Has access to Platform network in Cloud&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Operations-Route&lt;/td&gt;
      &lt;td&gt;172.16.20.0-172.16.23.254/22&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt;Has access to MGMT VLAN, Server VLAN, Cloud MGMT VLAN, and other special or restricted VLANs&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Operations&lt;/td&gt;
      &lt;td&gt;172.16.24.0-172.16.27.254/22&lt;/td&gt;
      &lt;td&gt;No&lt;/td&gt;
      &lt;td&gt;Has access to MGMT VLAN, Server VLAN, Cloud MGMT VLAN, and other special or restricted VLANs&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;From an entry point or access perspective, the VPN should be able to access required services inbound as necessary. For instance, the engineering profiles should route to cloud infrastructure (platform, and other infrastructure that has been deployed) but not connect to the management sections of the network (201 vlan). The operations infrastructure should have access to the required amount of VLANs to perform their base job (MGMT, and other related services).&lt;/p&gt;

&lt;p&gt;We could also limit this to a much lower mask initially, but keep the space reserved for the upper mask. As it is unlikely to have more than 1000 clients connected at any one point in time. However, once the company becomes larger, this would be a good starting point.&lt;/p&gt;

&lt;h1 id=&quot;cloud-infrastructure&quot;&gt;Cloud Infrastructure&lt;/h1&gt;

&lt;h2 id=&quot;asset-management-cloud-and-ipam-cloud&quot;&gt;Asset Management (Cloud) and IPAM (Cloud)&lt;/h2&gt;

&lt;h3 id=&quot;asset-management&quot;&gt;Asset Management&lt;/h3&gt;

&lt;p&gt;The plan here is to hook up to the reseller’s database (if possible) and pull details from orders to feed into SnipeIT. An example of this can be done with CDW with their B2B unit. They drop csv files of purchases into a storage bucket for you to pull from. Alternatively, this could exist when working directly with Dell, Lenovo/IBM, or others. Since the service can also be used with end user computing hardware as well, create scripts to interact with reseller’s websites to automatically load data.&lt;/p&gt;

&lt;p&gt;It also allows for the use of tags to easily separate the EUC vs infrastructure based hardware, and has a license integration. When setting up a client to automatically add/create assets, it can also be completely automated - by then checking out a device automatically to the end user based on the API data from the MDM. This would then become the Source of Truth for all assets. There are also several tools that exist that allow you to create inventory and asset information from other services (JAMF, PowerShell, AD, etc).&lt;/p&gt;

&lt;p&gt;Since this requires a database backend, and will host a web frontend over docker/kubernetes, we need to setup a CloudSQL DB for Postgres, and use HELM or deploy SnipeIT directly into Kubernetes. Optionally, we can then do one of two things. As SnipeIT supports a &lt;a href=&quot;https://github.com/snipe/snipe-it/pull/5142&quot;&gt;limited capability&lt;/a&gt; of SAML/oAuth2, and &lt;a href=&quot;https://github.com/snipe/snipe-it/pull/8036&quot;&gt;progress&lt;/a&gt; is actively being made to improve it, we would want to hook it up to both LDAP (in this case preferably Okta’s LDAP interface, but, if required, an AD instance inside GCP) and then configure SAML Authentication to the front end to utilize the backend email address configuration.&lt;/p&gt;

&lt;h3 id=&quot;ipam&quot;&gt;IPAM&lt;/h3&gt;

&lt;p&gt;Very much in the same aspect of the Asset Management tool, Netbox also supports tags, the ability to set configurations based on the API, &lt;a href=&quot;https://github.com/netbox-community/netbox/issues/2328&quot;&gt;SAML authentication&lt;/a&gt;. Alternatively if the need to break away or keep a separate Data Center Inventory Management tool exists from the above Asset Management tool, netbox is also used as a DCIM tool.&lt;/p&gt;

&lt;p&gt;Much in the same way with tags support, we would use them to differentiate between sets of configuration, and is quite a versatile tool when it comes to IP Address Management. It’s quite comprehensive.&lt;/p&gt;

&lt;p&gt;While the use of dynamic updates to the API would be a customized tool, &lt;a href=&quot;https://github.com/netbox-community/go-netbox&quot;&gt;some tools&lt;/a&gt; already exist that allow you to upload client data into Netbox. However extensive testing would need to be used to validate their viability into the infrastructure.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Asset_Management_IPAM_Deployment.png&quot;&gt;Diagram&lt;/a&gt;
&lt;img src=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Asset_Management_IPAM_Deployment.png&quot; alt=&quot;Diagram&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;deployment-steps&quot;&gt;Deployment Steps&lt;/h3&gt;
&lt;p&gt;This can be initially deployed into a server model method, but if we go the serverless method (offloading database servers into GCP, and running the instances through kubernetes) we deal with less overhead of management of servers. The configuration is stated exactly as is described, and can be brought up and scaled up without much effort.&lt;/p&gt;

&lt;h4 id=&quot;asset-management-1&quot;&gt;Asset Management&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/example-assetmanagement-docker-compose.yaml&quot;&gt;Docker Compose file&lt;/a&gt; &lt;a href=&quot;#example-docker-compose-for-snipeit-hosted-in-gcp&quot;&gt;- Appendix&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;cicd-system&quot;&gt;CI/CD System&lt;/h2&gt;

&lt;p&gt;Traditionally, I have used Jenkins and self hosting for a CI/CD system - and this has worked well. You do have to worry about the infrastructure that is a part of the CI/CD system. If Github Cloud meets the business requirements, I would suggest using it over Jenkins. Since Github Cloud Actions uses MacStadium for macOS runners, it makes running services through it much easier and you don’t have to worry about virtualization of macOS hardware. On the Windows and Linux side they utilize AzureAD. This way we can simplify and provide less complexity into the infrastructure. The only issue becomes cost to benefit ratios. For comparison, if we find that Github Enterprise meets the requirements of the business better due to security, going the Jenkins route or CircleCI route would be better. On the Jenkins side, there are multiple guides for GCP deployments if that is the route to go. However while managing Github Enterprise was quite easy from past experience, if deployed incorrectly (which I inherited). It can create enormous latency due to a past team deploying the Github Enterprise system to the west coast of the US while having members in Central and Western Europe.&lt;/p&gt;

&lt;h2 id=&quot;identity-management-infrastructure&quot;&gt;Identity Management Infrastructure&lt;/h2&gt;

&lt;p&gt;If we are deploying infrastructure into GCP, the best route to use is Google’s Cloud Identity. However we need to populate that data into GCP somehow, and that is where our SoT Identity-AAS (IDaaS) provider comes in. I have personal experience with Okta, and think it has more dynamic uses compared to solely using G Suite as an Identity Management tool for all services. I have used that as the backbone to the rest of the infrastructure. From Okta, you can push users into Active Directory. So far, I have found that it works well. The key thing here is that because you can push groups from Okta to any service in a more flexible way than using Active Directory, and you bypass the limitations of AzureAD (for instance, you can’t push AzureAD users into Active Directory on brand new deployments) you end up with a more flexible and modular system. In addition, you can stand up any number of Active Directory environments with the same data from Okta, making it easy to create “staging” or development AD servers for testing when needed with the exact same data that would be considered production.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-AD_in_GCP_v1.png&quot;&gt;Diagram&lt;/a&gt;
&lt;img src=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-AD_in_GCP_v1.png&quot; alt=&quot;Diagram&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Google Cloud Shell Commands&lt;br /&gt;
&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/IAM_AD-Infrastructure_GCP_Shell_Commands.txt&quot;&gt;Script/Commands&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We are deploying a limited range of machines into this space, so we would want to split the subnet from a 10.X.X.0/24 to a 14 host per subnet /28 CIDR mask. If it is done this way, we can also save a subnet and utilize it for multiple regions and zones which would be ideal. If we don’t want to do that, we could just use 10.X.X.0/24 and 10.X.Y.0/24 as alternative subnets for the AD configuration. However we would waste a ton of IP space.&lt;/p&gt;

&lt;p&gt;The reason for deploying a limited range of machines into this space is because we do not need dozens of Windows Domain Controllers. As client devices would be running against other services that would mimic the traditional behavior of binding, we only need to use the Domain Controllers to provide a backup to the LDAP interface being served by Okta. While Google’s LDAP does provide certificate based, there are options to work around the &lt;a href=&quot;https://support.google.com/cloudidentity/answer/9048541&quot;&gt;certificate deployments&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We want to provision this into two different regions (or at least in two separate regions that are closest to each office and the overall services we are providing), to provide maximum coverage over all. We would then incorporate the use of &lt;a href=&quot;https://cloud.google.com/vpc/docs/vpc-peering&quot;&gt;VPC Peering&lt;/a&gt; to allow those two to communicate between each other. However, to keep things simple for this document, we will deploy into the same region.&lt;/p&gt;

&lt;p&gt;Even after performing all of the commands used above, to use the identity aware proxy, we would need to deploy it first. After doing research, it does not appear as if the command line tool is quite ready to deploy Identity Access Proxy services, as it is still in &lt;a href=&quot;https://cloud.google.com/sdk/gcloud/reference/beta/iap/web/set-iam-policy&quot;&gt;beta&lt;/a&gt;. So I would use the GUI to deploy it for convenience.&lt;/p&gt;

&lt;h2 id=&quot;task-management&quot;&gt;Task Management&lt;/h2&gt;

&lt;h3 id=&quot;jira-cloud-vs-jira-server&quot;&gt;Jira Cloud vs Jira Server&lt;/h3&gt;

&lt;p&gt;The two major difference between deploying these two are:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Price Ratio per User&lt;/li&gt;
  &lt;li&gt;Managed by Atlassian vs Managed by Companies Teams&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;For companies less than 300 people, it makes sense to deploy Jira Cloud, and add on the corresponding services that are required - especially due to the cost involved in employee salary and maintenance fees. However, once the company hits 500 people or more, it makes more financial sense to pay for Server (and ideally more sense for Data Center due to SAML authentication) and self-host it in the cloud so that it is available to all employees where needed.&lt;/p&gt;

&lt;p&gt;Ideally, we want to put the infrastructure behind a load balancer and host multiple front ends so that there isn’t too much load on a single node, I would start out with two and then create more as needed. You would use GCP’s &lt;a href=&quot;https://cloud.google.com/compute/docs/autoscaler&quot;&gt;autoscaler&lt;/a&gt; functions for this to work, so that as load increases the hosts increase as well. We would be deploying the Cloud Load Balancer with an exposed port 443 and terminate the connection internally on port 8080 (the default port for Jira).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Jira_Confluence_Deployment.png&quot;&gt;Diagram&lt;/a&gt;
&lt;img src=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Jira_Confluence_Deployment.png&quot; alt=&quot;Diagram&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;future-plans&quot;&gt;Future Plans&lt;/h1&gt;
&lt;p&gt;Deploy this using Docker and/or Kubernetes. I don’t believe that this is an officially supported method by Atlassian as I can’t find any documentation on their site about this. But, Atlassian has been creating docker images for both &lt;a href=&quot;https://hub.docker.com/r/atlassian/jira-software&quot;&gt;Jira&lt;/a&gt; and &lt;a href=&quot;https://hub.docker.com/r/atlassian/confluence-server&quot;&gt;Confluence&lt;/a&gt; which are listed in Docker Hub. While deploying, we would utilize CloudSQL on GCP for the backend of both services, and Cloud Storage as a way to host uploads, images, and other data. Similar to the compute version, we would still be using Cloud Storage and CloudSQL as the backends, so the deployment or upgrade path to roll out kubernetes should be simple. Again, this would follow the serverless based infrastructure.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Kubernetes_Jira_Confluence_Deployment.png&quot;&gt;Diagram&lt;/a&gt;
&lt;img src=&quot;/assets/blog/2020/09/eg-infra-engg/Company_XYZ-Kubernetes_Jira_Confluence_Deployment.png&quot; alt=&quot;Diagram&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;summarization&quot;&gt;Summarization&lt;/h1&gt;
&lt;p&gt;Besides deploying all of the above services, I would start by getting a good foundational service for each requirement of the business. Then, I would grow it and expand upon it. With the above, we have the basics to start doing a lot of “grow your own” processes. Starting on the networking side, the Palo Alto Network Firewalls have built in URL filtering when a license is applied, they have VPN software access for deployments, and can perform several other features as needed by the security team. We can then start to export log data into Kibana/ElasticSearch for analysis&lt;/p&gt;

&lt;p&gt;The reason why I have only shown infrastructure being deployed into the cloud, is due to it minimizing any potential security risks to each office. While it might be convenient to deploy infrastructure into the office for initial use, it creates risks when performing assessments and an inconvenience to end-users trying to access those services. In the cases of infrastructure deployed in the office, it should be minimal or what is necessary to achieve the business requirement for the office. From a network standpoint, this should be an IDS/IPS, DHCP, and DNS, networking equipment. From a virtualization standpoint, the infrastructure exists internally to allow local developer and testing infrastructure in each office location as well.&lt;/p&gt;

&lt;p&gt;All in all, SaaS vs Cloud services would be based on a few factors:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Cost per seat ratio&lt;/li&gt;
  &lt;li&gt;Business benefit&lt;/li&gt;
  &lt;li&gt;Administration costs&lt;/li&gt;
  &lt;li&gt;Time Costs
Once those factors have been determined, you can then make adequate decisions on where or how to deploy each service. Benefiting both the business and the end user.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;With the range of software and services outlined in this document, there should be a complete infrastructure stack for a productive corporate infrastructure.&lt;/p&gt;

&lt;h1 id=&quot;appendix&quot;&gt;Appendix:&lt;/h1&gt;

&lt;h2 id=&quot;supporting-files&quot;&gt;Supporting Files&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;/assets/blog/2020/09/eg-infra-engg/Archive.zip&quot;&gt;Collection of all files&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;list-of-infrastructure-services-to-deploy&quot;&gt;List of Infrastructure Services to Deploy&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Asset Management
    &lt;ul&gt;
      &lt;li&gt;SnipeIT&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Authentication, Authorization, Accounting, Identity
    &lt;ul&gt;
      &lt;li&gt;SaaS based HRIS service to integrate with Identity Management tool
        &lt;ul&gt;
          &lt;li&gt;BambooHR&lt;/li&gt;
          &lt;li&gt;Workday&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;SaaS Identity Management &amp;amp; LDAP (Azure or Okta)
        &lt;ul&gt;
          &lt;li&gt;Okta (Recommended)&lt;/li&gt;
          &lt;li&gt;Azure&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Push SaaS data into Cloud hosted LDAP, if required (Active Directory, AWS managed AD, GCP cloud directory)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Continuous Integration/Continuous Delivery (CI/CD)
    &lt;ul&gt;
      &lt;li&gt;Jenkins&lt;/li&gt;
      &lt;li&gt;Github Workflows&lt;/li&gt;
      &lt;li&gt;ArgoCD&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Containers &amp;amp; Orchestration
    &lt;ul&gt;
      &lt;li&gt;Docker - Containerization&lt;/li&gt;
      &lt;li&gt;Kubernetes - Orchestration&lt;/li&gt;
      &lt;li&gt;Twistlock - Security/Vulnerability Reporting&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Git / Revision Control
    &lt;ul&gt;
      &lt;li&gt;Github Cloud (Preferred)&lt;/li&gt;
      &lt;li&gt;Github Enterprise&lt;/li&gt;
      &lt;li&gt;Gitlab Cloud&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Hypervisor
    &lt;ul&gt;
      &lt;li&gt;ESXi/VSphere&lt;/li&gt;
      &lt;li&gt;Xen&lt;/li&gt;
      &lt;li&gt;proxmox&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;LAMES (Logging, Alerting, Monitoring Excellence &amp;amp; Security)
    &lt;ul&gt;
      &lt;li&gt;Infrastructure Monitoring&lt;/li&gt;
      &lt;li&gt;Grafana&lt;/li&gt;
      &lt;li&gt;Prometheus&lt;/li&gt;
      &lt;li&gt;Elasticsearch, Logstash, Kibana&lt;/li&gt;
      &lt;li&gt;AlertManager&lt;/li&gt;
      &lt;li&gt;Osquery&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Network Performance Monitoring
    &lt;ul&gt;
      &lt;li&gt;SaaS/Cloud Network Monitoring
        &lt;ul&gt;
          &lt;li&gt;ThousandEyes&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Network Management
    &lt;ul&gt;
      &lt;li&gt;SaaS or Cloud based management portal (IE: Software Defined Networking)
        &lt;ul&gt;
          &lt;li&gt;Meraki&lt;/li&gt;
          &lt;li&gt;Unifi&lt;/li&gt;
          &lt;li&gt;Juniper Sky&lt;/li&gt;
          &lt;li&gt;Palo Alto&lt;/li&gt;
          &lt;li&gt;Velocloud&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;SaaS/Cloud hosted RADIUS based authentication/802.1x
        &lt;ul&gt;
          &lt;li&gt;Implement EAP-TTLS - https://tools.ietf.org/html/rfc5281#section-11.2.5&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Security
        &lt;ul&gt;
          &lt;li&gt;IDS
            &lt;ul&gt;
              &lt;li&gt;Vectra&lt;/li&gt;
              &lt;li&gt;Cisco Firepower&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;IPAM/DCIM
    &lt;ul&gt;
      &lt;li&gt;Nextbox in Cloud Environment&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Productivity software
    &lt;ul&gt;
      &lt;li&gt;Email &amp;amp; Document Editing
        &lt;ul&gt;
          &lt;li&gt;G Suite (primary)&lt;/li&gt;
          &lt;li&gt;O365 (secondary, where required for finance)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Instant Communication
        &lt;ul&gt;
          &lt;li&gt;Slack (Recommended)&lt;/li&gt;
          &lt;li&gt;Microsoft Teams&lt;/li&gt;
          &lt;li&gt;RocketChat&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Telecommunications/conferencing
        &lt;ul&gt;
          &lt;li&gt;Phone System
SaaS based where possible/Cloud self-hosted where not
            &lt;ul&gt;
              &lt;li&gt;SaaS options:
                &lt;ul&gt;
                  &lt;li&gt;Zoom Phone&lt;/li&gt;
                  &lt;li&gt;RingCentral&lt;/li&gt;
                  &lt;li&gt;Twilio&lt;/li&gt;
                  &lt;li&gt;CloudTalk&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;Cloud self-hosted options:
                &lt;ul&gt;
                  &lt;li&gt;Asterisk&lt;/li&gt;
                  &lt;li&gt;OpenSIP&lt;/li&gt;
                  &lt;li&gt;FreePBX&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;Video conferencing
            &lt;ul&gt;
              &lt;li&gt;Zoom&lt;/li&gt;
              &lt;li&gt;WebEx&lt;/li&gt;
              &lt;li&gt;Pexip*&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Task Management
    &lt;ul&gt;
      &lt;li&gt;Jira (Cloud - SaaS)&lt;/li&gt;
      &lt;li&gt;Jira Server (Cloud - Self Hosted)&lt;/li&gt;
      &lt;li&gt;Asana&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;EUC Management
    &lt;ul&gt;
      &lt;li&gt;Full Disk Encryption
        &lt;ul&gt;
          &lt;li&gt;Windows - Bitlocker (Using AES- XTS 256) &amp;amp; Crypt-Server for escrow&lt;/li&gt;
          &lt;li&gt;macOS - Crypt2 &amp;amp; Crypt-Server for escrow&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;macOS Management
        &lt;ul&gt;
          &lt;li&gt;DEP and MDM tool that is compatible with “installapplication” MDM specification/command
            &lt;ul&gt;
              &lt;li&gt;Fleetsmith&lt;/li&gt;
              &lt;li&gt;Mosyle&lt;/li&gt;
              &lt;li&gt;Simplemdm&lt;/li&gt;
              &lt;li&gt;Micromdm&lt;/li&gt;
              &lt;li&gt;JAMF&lt;/li&gt;
              &lt;li&gt;Workspace One&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;Installapplications - bootstrapping, configuration stored on cloud storage&lt;/li&gt;
          &lt;li&gt;DEPNotify - Visual display to the end user for bootstrapping process&lt;/li&gt;
          &lt;li&gt;Munki - bootstrapping, software management, patch management&lt;/li&gt;
          &lt;li&gt;Nudge - patch management/minimum OS version enforcement&lt;/li&gt;
          &lt;li&gt;Privileges - User escalation to administrator on a per department basis&lt;/li&gt;
          &lt;li&gt;GCP Cloud Storage Backend&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Time Series Reporting
        &lt;ul&gt;
          &lt;li&gt;Sal - Compatible with both macOS and Windows, as well as Linux and Chromebooks&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Windows Management
        &lt;ul&gt;
          &lt;li&gt;MDM
            &lt;ul&gt;
              &lt;li&gt;Workspace One&lt;/li&gt;
              &lt;li&gt;Intune&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;Autopilot or OOBE experience - Automates client experience&lt;/li&gt;
          &lt;li&gt;Configuration Management
            &lt;ul&gt;
              &lt;li&gt;Chef/&lt;/li&gt;
              &lt;li&gt;Ansible -&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;Package Management
            &lt;ul&gt;
              &lt;li&gt;chocolatey&lt;/li&gt;
              &lt;li&gt;winget&lt;/li&gt;
              &lt;li&gt;nuget&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;example-docker-compose-for-snipeit-hosted-in-gcp&quot;&gt;Example docker-compose for SnipeIT hosted in GCP&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;  Docker-compose.yml
  ---
  apiVersion: apps/v1
  kind: StatefulSet
  metadata:
    namespace: snipe
    name: snipe
    labels:
      app: snipe
  spec:
    serviceName: snipe
    volumeClaimTemplates:
    - metadata:
        name: snipe-disk
      spec:
        accessModes: [&quot;ReadWriteOnce&quot;]
        resources:
          requests:
            storage: 100Gi
    replicas: 1
    selector:
      matchLabels:
        app: snipe
    template:
      metadata:
        labels:
          app: snipe
      spec:
        containers:
        - name: snipe-it
          image: imagename
          env:
          - name: APP_KEY
            valueFrom:
              secretKeyRef:
                name: snipe-app-key
                key: APP_KEY
          - name: MAIL_ENV_PASSWORD
            valueFrom:
              secretKeyRef:
                name: snipe-mail-key
                key: MAIL_ENV_PASSWORD
          - name: MAIL_ENV_USERNAME
            value: example@example.com
          - name: APP_DEBUG
            value: &quot;false&quot;
          - name: MAIL_PORT_587_TCP_ADDR
            value: smtp.gmail.com
          - name: MAIL_PORT_587_TCP_PORT
            value: &quot;587&quot;
          - name: MAIL_ENV_FROM_ADDR
            value: example@example.com
          - name: MAIL_ENV_FROM_NAME
            value: Example
          - name: MAIL_ENV_ENCRYPTION
            value: tls
          - name: APP_URL
            value: snipe.example.com:443
          - name: MYSQL_PORT_3306_TCP_PORT
            value: &quot;3306&quot;
          - name: MYSQL_PORT_3306_TCP_ADDR
            valueFrom:
              secretKeyRef:
                name: snipe-database
                key: host
          - name: MYSQL_DATABASE
            valueFrom:
              secretKeyRef:
                name: snipe-database
                key: database
          - name: MYSQL_USER
            valueFrom:
              secretKeyRef:
                name: snipe-database
                key: username
          - name: MYSQL_PASSWORD
            valueFrom:
              secretKeyRef:
                name: snipe-database
                key: password
          ports:
          - containerPort: 80
          resources:
            requests:
              cpu: 150m
              memory: 512Mi
            limits:
              cpu: 150m
              memory: 512Mi
          volumeMounts:
          - mountPath: /var/lib/snipeit
            name: snipe-disk
          - mountPath: /var/www/html/storage/app/backups
            name: backup-disk
        - name: snipe-it-backup-sidecar
          image: imagename2
          env:
          - name: GCP_CREDENTIALS_LOCATION
            value: /tmp/gcpCredentials/creds.json
          resources:
            requests:
              cpu: 50m
              memory: 128Mi
            limits:
              cpu: 50m
              memory: 128Mi
          volumeMounts:
          - mountPath: /var/lib/snipeit
            name: snipe-disk
          - mountPath: /shared
            name: backup-disk
          - name: gcp-credentials
            mountPath: &quot;/tmp/gcpCredentials/&quot;
            readOnly: true
        volumes:
        - name: gcp-credentials
          secret:
            secretName: snipe-backup-sidecar
        - name: backup-disk
          emptyDir: {}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;gcloud-compute-scripts-for-an-active-directory-deployment&quot;&gt;GCloud Compute Scripts for an Active Directory Deployment&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;  export region=us-east1
  export zone_1=${region}-b
  export zone_2=${region}-c
  export vpc_name=winaddcnet
  export project_id=company-xyz-ldap

  gcloud config set compute/region ${region}
  gcloud config set project ${project_id}

  gcloud compute networks create ${vpc_name}  \
      --description &quot;VPC network to deploy Active Directory&quot; \
      --subnet-mode custom

  gcloud compute networks subnets create private-ad-zone-1 \
    --network ${vpc_name} \
    --range 10.250.250.0/28

  gcloud compute networks subnets create private-ad-zone-2 \
      --network ${vpc_name} \
      --range 10.250.250.16/28

  gcloud compute firewall-rules create allow-internal-ports-private-ad \
      --network ${vpc_name} \
      --allow tcp:88,135,389,445,464,636,3268,3269,49152-65535,udp:88,123,389,464,icmp \
      --source-ranges  10.0.0.0/8,172.16.0.0/12,192.168.0.0/16 \
      --target-tags=ad

  gcloud compute firewall-rules create allow-internal-ports-private-dns \
      --network ${vpc_name} \
      --allow tcp:53,udp:53,icmp \
      --source-ranges  10.0.0.0/8,172.16.0.0/12,192.168.0.0/16 \
      --target-tags=ad

  gcloud compute firewall-rules create allow-rdp \
      --network ${vpc_name} \
      --allow tcp:3389 \
      --source-ranges 35.235.240.0/20 \
      --target-tags=rdp

  #source ranges should be adjusted for each service that needs to reach out to the ingress ldap port.
  gcloud compute firewall-rules create allow-ingress-ldaps \
      --network ${vpc_name} \
      --allow tcp:636 \
      --source-ranges 1.2.3.4/32 \
      --target-tags=ldaps-ingress


  gcloud compute instances create ad-dc1 --machine-type n1-standard-2 \
      --boot-disk-type pd-ssd \
      --boot-disk-size 50GB \
      --image-family windows-2019 --image-project windows-cloud \
      --network ${vpc_name} \
      --zone ${zone_1} \
      --subnet private-ad-zone-1 \
      --private-network-ip=10.250.250.1

  gcloud compute reset-windows-password ad-dc1 --zone ${zone_1} --quiet

  gcloud compute instances create ad-dc2 --machine-type n1-standard-2 \
      --boot-disk-size 50GB \
      --boot-disk-type pd-ssd \
      --image-family windows-2019 --image-project windows-cloud \
      --can-ip-forward \
      --network ${vpc_name} \
      --zone ${zone_2} \
      --subnet private-ad-zone-2 \
      --private-network-ip=10.250.250.17

  gcloud compute reset-windows-password ad-dc2 --zone ${zone_2} --quiet


  #Configuring the Windows Domain Controller is separate from the GCP Configuration, so won't configure it in this guide.
  #Below will allow you to rdp from your local machine into the GCP proxy/tunnel.
  gcloud beta compute start-iap-tunnel ad-dc1 3389 \
      --local-host-port=localhost:53389 \
      --zone=${zone_1} \
      --project=${project-id}

  gcloud beta compute start-iap-tunnel ad-dc2 3389 \
      --local-host-port=localhost:63389 \
      --zone=${zone_2} \
      --project=${project-id}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;networking-and-software-equipment&quot;&gt;Networking and Software Equipment&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Make&lt;/th&gt;
      &lt;th&gt;Item/SKU&lt;/th&gt;
      &lt;th&gt;SKU&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;QTY&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Cost&lt;/th&gt;
      &lt;th&gt;Required?&lt;/th&gt;
      &lt;th&gt; &lt;/th&gt;
      &lt;th&gt;Note&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;SUM&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Total Sum&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$63,746&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Sectional Sum&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Firewall&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Firewall&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$19,814&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt;Firewall PA-850&lt;/td&gt;
      &lt;td&gt;PA-850&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$6,000&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$12,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt;Palo PANDb URL Filtering for PA-850&lt;/td&gt;
      &lt;td&gt;PAN-PA-850-URL4-HA2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,500&lt;/td&gt;
      &lt;td&gt;No, recommended&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$3,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt;Palo Premium Support Program - extended service agreement 2 - 1 year&lt;/td&gt;
      &lt;td&gt;PAN-SVC-PREM-850&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$907&lt;/td&gt;
      &lt;td&gt;No, recommended&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,814&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt;Palo Alto GlobalProtect Gateway for PA-850 - subscription license&lt;/td&gt;
      &lt;td&gt;PAN-PA-850-GP-HA2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,500&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$3,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Switches&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Switches&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$22,960&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Juniper Networks&lt;/td&gt;
      &lt;td&gt;EX3400-48P&lt;/td&gt;
      &lt;td&gt;EX3400-48P&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$4,000&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$8,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Juniper Networks&lt;/td&gt;
      &lt;td&gt;EX-SFP-10GE-DAC-1M /&lt;/td&gt;
      &lt;td&gt;740-030076&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$20&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$80&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Juniper Networks&lt;/td&gt;
      &lt;td&gt;Juniper Care Next-Day - extended service agreement - 3 years - shipment&lt;/td&gt;
      &lt;td&gt;SVC-ND-EX3300-48P-3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,290&lt;/td&gt;
      &lt;td&gt;No, recommended&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$2,580&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Juniper Networks&lt;/td&gt;
      &lt;td&gt;Juniper Care Core - technical support - 1 year&lt;/td&gt;
      &lt;td&gt;SVC-COR-EX34-48&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$150&lt;/td&gt;
      &lt;td&gt;No, recommended&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$300&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Meraki&lt;/td&gt;
      &lt;td&gt;MS-390&lt;/td&gt;
      &lt;td&gt;MS390-48UX2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$6,000&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$12,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Meraki&lt;/td&gt;
      &lt;td&gt;4 x 10G Uplink Module&lt;/td&gt;
      &lt;td&gt;MA-MOD-4X10G&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$750&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Access Points&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Access Points&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$8,130&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Amount of WAPs will be dependent on Office Layout, Client QTY, and several other factors. Purchasing 6 as a minimum, but obviously the number will be a lot more.&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Meraki&lt;/td&gt;
      &lt;td&gt;Cisco Meraki MR55&lt;/td&gt;
      &lt;td&gt;MR55-HW&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;6.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,250&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$7,500&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Meraki&lt;/td&gt;
      &lt;td&gt;Cisco Meraki Enterprise Cloud Controller - subscription license (1 year)&lt;/td&gt;
      &lt;td&gt;LIC-ENT-1YR&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;6.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$105&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$630&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Security&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Security&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Vecta&lt;/td&gt;
      &lt;td&gt;Brain/Controller&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt;Yes, for Cloud Deployment&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Vectra&lt;/td&gt;
      &lt;td&gt;Sensor&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt;Yes, for offices&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Cables&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Cables&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$2,307&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite Cat6 Gigabit Snagless Molded Patch Cable (RJ45 M/M) Blue, 7’&lt;/td&gt;
      &lt;td&gt;N201-007-BL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;30.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$6&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$180&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite 1000ft Cat6 Gigabit Bulk Cable Solid CMP Plenum PVC Gray TAA&lt;/td&gt;
      &lt;td&gt;N224-01K-GY&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$362&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,448&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite Cat6 Gigabit Snagless Molded Patch Cable (RJ45 M/M) Blue, 10’&lt;/td&gt;
      &lt;td&gt;N201-010-BL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;20.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$7&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$140&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite Cat6 Gigabit Snagless Molded Patch Cable (RJ45 M/M) Blue, 15’&lt;/td&gt;
      &lt;td&gt;N201-015-BL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;20.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$9&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$180&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Tripp Lite Cat6 Gigabit Snagless Molded Patch Cable (RJ45 M/M) Blue, 5’&lt;/td&gt;
      &lt;td&gt;N201-005-BL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;60.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$6&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$359&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Server&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Server&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$10,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Dell&lt;/td&gt;
      &lt;td&gt;R440&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$5,000&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Approximate value, as these will be custom spec’d, and does not have a specific SKU model.&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$10,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt;Firewall PA-850&lt;/td&gt;
      &lt;td&gt;PA-850&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$6,000&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$12,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt;Palo PANDb URL Filtering for PA-850&lt;/td&gt;
      &lt;td&gt;PAN-PA-850-URL4-HA2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,500&lt;/td&gt;
      &lt;td&gt;No, recommended&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$3,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt;Palo Premium Support Program - extended service agreement 2 - 1 year&lt;/td&gt;
      &lt;td&gt;PAN-SVC-PREM-850&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$907&lt;/td&gt;
      &lt;td&gt;No, recommended&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,814&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt;Palo Alto GlobalProtect Gateway for PA-850 - subscription license&lt;/td&gt;
      &lt;td&gt;PAN-PA-850-GP-HA2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,500&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$3,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Palo Alto Networks&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Switches&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Switches&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$22,960&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Juniper Networks&lt;/td&gt;
      &lt;td&gt;EX3400-48P&lt;/td&gt;
      &lt;td&gt;EX3400-48P&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$4,000&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$8,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Juniper Networks&lt;/td&gt;
      &lt;td&gt;EX-SFP-10GE-DAC-1M /&lt;/td&gt;
      &lt;td&gt;740-030076&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$20&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$80&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Juniper Networks&lt;/td&gt;
      &lt;td&gt;Juniper Care Next-Day - extended service agreement - 3 years - shipment&lt;/td&gt;
      &lt;td&gt;SVC-ND-EX3300-48P-3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,290&lt;/td&gt;
      &lt;td&gt;No, recommended&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$2,580&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Juniper Networks&lt;/td&gt;
      &lt;td&gt;Juniper Care Core - technical support - 1 year&lt;/td&gt;
      &lt;td&gt;SVC-COR-EX34-48&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$150&lt;/td&gt;
      &lt;td&gt;No, recommended&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$300&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Meraki&lt;/td&gt;
      &lt;td&gt;MS-390&lt;/td&gt;
      &lt;td&gt;MS390-48UX2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$6,000&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$12,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Meraki&lt;/td&gt;
      &lt;td&gt;4 x 10G Uplink Module&lt;/td&gt;
      &lt;td&gt;MA-MOD-4X10G&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$750&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Access Points&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Access Points&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$8,130&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Amount of WAPs will be dependent on Office Layout, Client QTY, and several other factors. Purchasing 6 as a minimum, but obviously the number will be a lot more.&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Meraki&lt;/td&gt;
      &lt;td&gt;Cisco Meraki MR55&lt;/td&gt;
      &lt;td&gt;MR55-HW&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;6.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,250&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$7,500&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Meraki&lt;/td&gt;
      &lt;td&gt;Cisco Meraki Enterprise Cloud Controller - subscription license (1 year)&lt;/td&gt;
      &lt;td&gt;LIC-ENT-1YR&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;6.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$105&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$630&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Security&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Security&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Vecta&lt;/td&gt;
      &lt;td&gt;Brain/Controller&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt;Yes, for Cloud Deployment&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Vectra&lt;/td&gt;
      &lt;td&gt;Sensor&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt;Yes, for offices&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Cables&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Cables&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$2,307&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite Cat6 Gigabit Snagless Molded Patch Cable (RJ45 M/M) Blue, 7’&lt;/td&gt;
      &lt;td&gt;N201-007-BL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;30.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$6&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$180&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite 1000ft Cat6 Gigabit Bulk Cable Solid CMP Plenum PVC Gray TAA&lt;/td&gt;
      &lt;td&gt;N224-01K-GY&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$362&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$1,448&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite Cat6 Gigabit Snagless Molded Patch Cable (RJ45 M/M) Blue, 10’&lt;/td&gt;
      &lt;td&gt;N201-010-BL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;20.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$7&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$140&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite Cat6 Gigabit Snagless Molded Patch Cable (RJ45 M/M) Blue, 15’&lt;/td&gt;
      &lt;td&gt;N201-015-BL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;20.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$9&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$180&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Tripp Lite&lt;/td&gt;
      &lt;td&gt;Tripp Lite Cat6 Gigabit Snagless Molded Patch Cable (RJ45 M/M) Blue, 5’&lt;/td&gt;
      &lt;td&gt;N201-005-BL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;60.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$6&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$359&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Server&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Server&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$10,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Dell&lt;/td&gt;
      &lt;td&gt;R440&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2.00&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$5,000&lt;/td&gt;
      &lt;td&gt;Yes&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Approximate value, as these will be custom spec’d, and does not have a specific SKU model.&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;$10,000&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Example Work" /><category term="Office Deployment" /><category term="Infrastructure Engineer" /><category term="Interview Example" /><category term="Homework Assignment" /><summary type="html">This is an infrastructure engineer assignment outline, that was created for an interview challenge.</summary></entry><entry><title type="html">Transitioning To Okta From Active Directory - New Directory Service Infrastructure</title><link href="https://andrewdoering.org/blog/2020/08/08/transitioning-to-okta-from-active-directory-new-directory-service-infrastructure/" rel="alternate" type="text/html" title="Transitioning To Okta From Active Directory - New Directory Service Infrastructure" /><published>2020-08-08T18:16:49+00:00</published><updated>2020-08-08T18:16:49+00:00</updated><id>https://andrewdoering.org/blog/2020/08/08/transitioning-to-okta-from-active-directory-new-directory-service-infrastructure</id><content type="html" xml:base="https://andrewdoering.org/blog/2020/08/08/transitioning-to-okta-from-active-directory-new-directory-service-infrastructure/">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#existing-infrastructure&quot;&gt;Existing Infrastructure&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#investigating-next-steps&quot;&gt;Investigating next steps&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#planning-our-workflows-and-processes&quot;&gt;Planning our Workflows and Processes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-1---setting-up-bamboohr-and-okta-integration&quot;&gt;Phase 1 - Setting up BambooHR and Okta Integration&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#requirements&quot;&gt;Requirements:&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#sandbox-testing&quot;&gt;Sandbox Testing&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#production-implementation&quot;&gt;Production Implementation&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-2---import-all-active-directory-attributes&quot;&gt;Phase 2 - Import all Active Directory Attributes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-3---migrate-membership-and-application-assignments-from-active-directory-groups-and-data-to-okta-groups-and-data&quot;&gt;Phase 3 - Migrate membership and application assignments from Active Directory groups and data to Okta groups and data&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-4---switch-the-profile-master-from-active-directory-to-bamboohr&quot;&gt;Phase 4 - Switch the Profile Master from Active Directory to BambooHR&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-5---turn-off-profile-master-from-active-directory&quot;&gt;Phase 5 - Turn off Profile Master from Active Directory&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-6---remove-delegated-authentication&quot;&gt;Phase 6 - Remove delegated authentication&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#end-users&quot;&gt;End Users&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#administrator-dashboard&quot;&gt;Administrator Dashboard&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-7---push-membership-attributes-values-and-groups-from-okta-into-active-directory&quot;&gt;Phase 7 - Push membership, attributes, values, and groups from Okta into Active Directory&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-8---decode-base64-encoded-values-from-okta&quot;&gt;Phase 8 - Decode Base64 encoded values from Okta&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#phase-9---migrate-merakiwi-fi-authentication-from-ad-to-eap-ttls-with-okta&quot;&gt;Phase 9 - Migrate Meraki/Wi-Fi authentication from AD to EAP-TTLS with Okta&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#summary&quot;&gt;Summary&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#questions&quot;&gt;Questions?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;At $currentcompany, we have traditionally been using Active Directory to master our Okta groups and services. However, managing Active Directory (correctly) is a pain, and doesn’t scale well when you need to set them up in different offices. What I am going to go over here, is what our project plan was, what it improved, what tools we used and our diagram architecture, and where it still needs improvement.&lt;/p&gt;

&lt;p&gt;This is being written ~3 to 5 months after changes have been performed, so there may be some spotty information or less than specific information due to the time that has occurred between performing the changes and writing this guide.&lt;/p&gt;

&lt;h2 id=&quot;existing-infrastructure&quot;&gt;Existing Infrastructure&lt;/h2&gt;

&lt;p&gt;Previously at $currentcompany, we had 6 Active Directory Domain Controllers, two in a single office in the AMER, two in an office in EMEA, and two in a physical Data Center environment. Initially, the EMEA office did not exist, as we expanded into this area in the beginning of 2019. I inherited the instances in AMER and the Physical Data Center in 2016. There was always some issues going through the two locations, usually dealing with replication or DNS environments. Even after providing &lt;a href=&quot;https://support.microsoft.com/en-us/help/179442/how-to-configure-a-firewall-for-domains-and-trusts&quot;&gt;this&lt;/a&gt; document to our networking team to open up ports and services in the firewall, if I ever ran diagnostics on the AD servers we would still see errors.&lt;/p&gt;

&lt;p&gt;When we deployed the EMEA office location, we experienced more problems, this time, mainly due to the major delay in synchronization and geographical distance and the lack of reliability on the line in the EMEA office. Again, no matter the amount of research and testing, we did - we always experienced issues when running diagnostics across our cluster of Domain Controllers. Nothing we did really resolved the AD issues.&lt;/p&gt;

&lt;p&gt;The issues we experienced were:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;24 hour difference between password synchronizations when AD was mastering Okta, and users had to change their password in Okta&lt;/li&gt;
  &lt;li&gt;Since users did not have VPN access, users could not change their local laptop password to be in sync with the AD instance&lt;/li&gt;
  &lt;li&gt;Attributes were not updating properly with in-house tools randomly, and no one was updating the in-house tools requiring IT team versus the owners of the tool to try and update them&lt;/li&gt;
  &lt;li&gt;$8,000 servers being purchased and being under utilized for a single instance of each: AD server, Bind9, and isc-dhcp-server&lt;/li&gt;
  &lt;li&gt;Onboarding (Employee Creation) was being done manually versus automated, inducing a lot of errors for new IT employees setting up users&lt;/li&gt;
  &lt;li&gt;General headaches (Microsoft Licensing, Annoyances, Lack of built in robust change monitoring)&lt;/li&gt;
  &lt;li&gt;Lack or modernization of Active Directory On-Premise&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Personally, a big part of this (in my opinion) was due to the lack of communication between our servers and what was classified as our “Primary Domain Controller”, which was not directly reachable by others in the network due to “security restrictions” around our Data Center environment.&lt;/p&gt;

&lt;p&gt;I had also been trying to make these changes for several years, but, due to a lack of “ownership” and not having specific permissions on several different systems, it made it much more difficult to get approval until more recently.&lt;/p&gt;

&lt;h2 id=&quot;investigating-next-steps&quot;&gt;Investigating next steps&lt;/h2&gt;

&lt;p&gt;While a possibility we did look at, was deploying an Active Directory Server into Google Cloud Platform, or Amazon Web Services, ultimately, we wanted to move away from Active Directory entirely within the organization and move to a more cloud centric/first environment.&lt;/p&gt;

&lt;p&gt;As we already were using Okta as our SSO/Identity Provider for SAML access, this seemed like the most appropriate choice. Okta provided:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/Directory/LDAP-interface-main.htm&quot;&gt;Cloud LDAP Interface&lt;/a&gt; with robust security measures&lt;/li&gt;
  &lt;li&gt;The ability to use &lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/Directory/ad-agent-cofigure-group-push-AD-OUs.htm&quot;&gt;Enhanced Group Push&lt;/a&gt;, to go from Okta to Active Directory (where/when necessary, Early Access)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://saml-doc.okta.com/Provisioning_Docs/BambooHR_Provisioning.html&quot;&gt;HRIS provisioning system for user accounts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;APIs for programatic changes and modifications&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://registry.terraform.io/providers/oktadeveloper/okta/latest/docs&quot;&gt;Terraform Provider&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Seamless integration of &lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/integrations/cisco-meraki-radius-intg.htm&quot;&gt;Meraki RADIUS with Okta&lt;/a&gt; (Early Access)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When looking at others, the options were:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://jumpcloud.com/&quot;&gt;JumpCloud&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;Compatibility with &lt;a href=&quot;https://support.jumpcloud.com/support/s/article/configuring-a-cisco-meraki-wap-to-jumpclouds-radius-as-a-service1-2019-08-21-10-36-47&quot;&gt;Radius&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/hashicorp/terraform/issues/16049&quot;&gt;Non-official support&lt;/a&gt; of &lt;a href=&quot;https://github.com/CognotektGmbH/terraform-provider-jumpcloud&quot;&gt;terraform&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;Provides SAML authentication&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-whatis&quot;&gt;Azure AD&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.foxpass.com/&quot;&gt;FoxPass&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For options, JumpCloud honestly stood out as the most robust product we could potentially use (that did not involve Microsoft related products), but, having to pay for two services JumpCloud and Okta (we were not ready to migrate all of our SAML applications out of Okta). It would have been a harder sell to our Finance team and more work in the long run.  We didn’t want to continue on with Microsoft Products unless required for Windows machines or Office 365 Licensing.&lt;/p&gt;

&lt;h2 id=&quot;planning-our-workflows-and-processes&quot;&gt;Planning our Workflows and Processes&lt;/h2&gt;

&lt;p&gt;We wanted several requirements from this new system namely:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Minimal to Zero Touch Onboarding Process (ATS &amp;gt; HRIS &amp;gt; IdP/IAM)&lt;/li&gt;
  &lt;li&gt;Automation internally for group memberships&lt;/li&gt;
  &lt;li&gt;Go from “role” based memberships to department/team based memberships&lt;/li&gt;
  &lt;li&gt;Migrate from “mastered AD groups” in Okta, to “native Okta groups”&lt;/li&gt;
  &lt;li&gt;Help us set being the process around Device Trust&lt;/li&gt;
  &lt;li&gt;Migrate from Active Directory Radius to Cloud Based Radius&lt;/li&gt;
  &lt;li&gt;Allow Infrastructure team, and other services that previously used AD to integrate and use Okta to authenticate&lt;/li&gt;
  &lt;li&gt;Prevent unauthorized changes to group memberships from team members, while still allowing them to manage processes/products that they own&lt;/li&gt;
  &lt;li&gt;Implement logging and change alerting based on actions performed in Okta&lt;/li&gt;
  &lt;li&gt;Cloud-first centric workflows/processes, and cloud-first mentality&lt;/li&gt;
  &lt;li&gt;Future planning for terraform’ed Okta&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As you can see, this is quite an extensive list, even without everything being completely planned out and the goals changing multiple times, and a list of final requirements was never fully defined due to a lack of time commitment/communication from other teams when asking for requirements . More stuff popped up during this transition and there were delays caused by co-workers - but this was the majority of what we were trying to fix and improve.&lt;/p&gt;

&lt;p&gt;While we wanted to automate the Application Tracking System (ATS) &amp;lt;&amp;gt; Human Resources Information Systems (HRIS) system, there was some concern from HR about doing this. While I don’t personally understand their concerns (they never actually listed them),  and as IT doesn’t have access to the ATS generally - we left the integration piece for now to come back to it at a later time. You can find the instructions here on how to integrate &lt;a href=&quot;https://support.greenhouse.io/hc/en-us/articles/201177624-BambooHR&quot;&gt;Greenhouse&lt;/a&gt; and &lt;a href=&quot;https://help.bamboohr.com/hc/en-us/articles/216831767-Greenhouse&quot;&gt;BambooHR&lt;/a&gt; (the systems we use/used at $currentcompany).&lt;/p&gt;

&lt;h2 id=&quot;phase-1---setting-up-bamboohr-and-okta-integration&quot;&gt;Phase 1 - Setting up BambooHR and Okta Integration&lt;/h2&gt;

&lt;p&gt;I want to start out with saying that the &lt;a href=&quot;https://saml-doc.okta.com/Provisioning_Docs/BambooHR_Provisioning.html&quot;&gt;documentation&lt;/a&gt; that Okta has is excellent.&lt;/p&gt;

&lt;p&gt;We had already configured and setup Okta as an IdP with BambooHR for SSO/SAML before we were doing these changes, however we were not using BambooHR as a profile master/provisioning feature. We wanted to be very careful with this process, since changing our profile master in production would be very risky, as well as overwriting any attributes/values that belonged to the employee&lt;/p&gt;

&lt;h3 id=&quot;requirements&quot;&gt;Requirements:&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;BambooHR Service Account with the appropriate permission level to see attributes that you want imported&lt;/li&gt;
  &lt;li&gt;Okta Service Account with the appropriate permission level to connect the OIDC integration&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Our Service Account in Okta looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/Screen-Shot-2020-08-07-at-8.57.06-PM-1024x656.png&quot; alt=&quot;&quot; /&gt;You will notice that we have a User Type called “Service Account”, that basically just minimizes any potential attributes so that the user cannot be used with various services. Whatever you want to call the service account will work.&lt;/p&gt;

&lt;p&gt;Our Service Account in BambooHR looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/Screen-Shot-2020-08-07-at-9.05.40-PM-1024x588.png&quot; alt=&quot;&quot; /&gt;My recommendation here, is to use the exact same email/uid as the Okta Service Account. Mainly to simplify things.&lt;/p&gt;

&lt;p&gt;We discussed in depth with our HR team on what information we wanted to import into Okta so we could potentially utilize that information into our services/systems. At a bare minimum, we wanted the following from the HRIS system in Okta:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Attribute Name&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Attribute Key&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Username&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;userName&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Work Email&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;workEmail&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Best Email&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;bestEmail&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;First Name&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;firstName&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Last Name&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;lastName&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Address&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;address1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;City&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;city&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Country&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;country&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Department&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;department&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Division&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;division&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Employee Number&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;employeeNumber&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Display Name&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;displayName&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Job Title&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;jobTitle&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Location&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;location&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Middle Name&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;middleName&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Mobile Phone&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;mobilePhone&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Nickname&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;nickname&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;State&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;state&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Supervisor&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;supervisor&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Supervisor ID&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;supervisorId&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Work Phone&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;workPhone&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Work Phone Plus Extension&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;workPhonePlusExtension&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Zip Code&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;zipcode&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Address Line 2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;address2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;BambooHR ID&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;bamboohrId&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Laptop&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Laptop&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Manager&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Manager1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Superhero&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Superhero&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Birth Date&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;dateOfBirth&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Employment Status: Date&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;employeeStatusDate&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Employment Status – FTE&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;employmentHistoryStatus&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Hire Date&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;hireDate&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Home Email&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;homeEmail&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Home Phone&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;homePhone&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;LinkedIn URL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;linkedIn&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Job Informatin: Date&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;p4047&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Termination Type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;p4343&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Termination Reason&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;p4344&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Preferred Name&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;preferredName&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Termination Date&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;terminationDate&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Twitter Feed&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;twitterFeed&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Work Extension&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;workPhoneExtension&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Gender&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;gender&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Security Training – Completed&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;p4326&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Security Training – Expires&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;p4326_u002E1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Security Training – Due Date&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;p4326_u002E2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Reporting To&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;p91&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;With the above fields from BambooHR, we can do the following:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;If we used BambooHR’s Security Training modules/tasks, we could restrict all access to applications until the security training was completed. Alternatively, if this was a configurable field, we could utilize the API from our current security training vendor, and have it auto populate/mark the field as completed to then allow the employee to access their applications.&lt;/li&gt;
  &lt;li&gt;We can have the employees select their preferred name. There is however an issue with this. By default, BambooHR provides a single attribute field called “Preferred name” - but this does not specify First, Last, or both. We have several employees with bi- and tri-nomial  names (Example: two first names, two last names) or several people that have non-conjugated names (Example: Smith, John Lee / John Lee Smith or Lee Smith, John / John Lee Smith). When you have these issues with these names, it is impossible to come up with a common naming scheme. This also creates general problems with application provisioning, as some applications that we used were using First + Last Name fields, or using the Display Name field to populate this information. To make things more challenging, our HR team needs/wanted to have their full legal name in the HRIS system with no exceptions.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Resolution to naming issues:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;What we came up with with our HR team was the ability to incorporate a “Preferred First Name” and “Preferred Last Name”, that way HR can keep their full legal name in the “First Name” and “Last Name” fields, while employees can self-service their own names in the Preferred name fields. Our HR team also didn’t like this because the risk of employees being malicious was too high. Ultimately, I believe that you should treat the employees like adults and monitor name changes, I don’t think this would cause any issues in the longer term, if it does - you take individual action with that person.  You can read our post mortem when we completed this phase below.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;We are aware of the employee’s start date, and termination date for automation workflows, as well as promotion dates, department/teams, etc. This allows us to automate the entire onboarding process from beginning to end, including their team memberships when transitioning between departments or teams. As well as on/off board them where necessary.&lt;/li&gt;
  &lt;li&gt;Automate some of our survey data, applications to a much greater extent, automation tools we code ourselves, and also use Okta Workflows more efficiently.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Before implementing this, InfoSec had an issue with us pulling specific attributes, and allowing Application Administrators, User Administrators, Group Administrators seeing those attributes. Thankfully, Okta has an &lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/users-groups-profiles/usgp-hide-sensitive-attributes.htm&quot;&gt;Early Access feature called Sensitive Attributes&lt;/a&gt;. What this done is effectively not allow administrators below the Super Admin level, to be able to see the attribute value. I would HIGHLY recommend turning this on, it’s super useful and so far (our team) has not found any downside to this. It also removes any risks from the end user of Okta seeing sensitive data as well.&lt;/p&gt;

&lt;h3 id=&quot;sandbox-testing&quot;&gt;Sandbox Testing&lt;/h3&gt;

&lt;p&gt;From here, we setup the integration to occur in our Okta Sandbox (OktaS) &amp;amp; BambooHR Sandbox (BHRS) environment initially, we imported all users from the BHRS into OktaS, this went fine without any issues. We then started to add users from into AD initially to implement them into Okta, and then added them to BHRS to have pre-existing information into OktaS. We did not see any major issues during the initial sandbox testing phase. However the scope of what were testing was limited compared to our production environments.&lt;/p&gt;

&lt;h3 id=&quot;production-implementation&quot;&gt;Production Implementation&lt;/h3&gt;

&lt;p&gt;We discussed with both our InfoSec team as well as our HR team on appropriate time frames and ranges to have accounts onboarded before hand, as well as when they should be offboarded. Our Okta Configuration looks like the following:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/Screen-Shot-2020-08-08-at-12.43.28-AM-1024x552.png&quot; alt=&quot;&quot; /&gt;You can see that we are using Departments, and importing those Departments as Groups into Okta. While we had some debate, we initially elected for 3 days prior to the new employees start date to create their account. However, this meant employees starting on a Monday (or Tuesday) would have their account created too late (as we had not switched off of AD yet).  We elected for 5 days instead.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/Screen-Shot-2020-08-08-at-12.45.52-AM-1024x454.png&quot; alt=&quot;&quot; /&gt;We wanted to make sure that any updates that occurred to employees would occur multiple times throughout the day, our HR team was concerned about making these changes too frequently, however for a company the size of ~500 people, I don’t see much of an issue moving this down from 6 hours to 1 - 3 hours. Our username format is meant to always be email address across the entire company.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/Screen-Shot-2020-08-08-at-12.46.04-AM-1024x504.png&quot; alt=&quot;&quot; /&gt;
We discussed and wanted to enable all features here - mainly to make sure that minimal fuss and touch would be applied to any accounts going forward.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/Screen-Shot-2020-08-08-at-12.46.14-AM-1024x671.png&quot; alt=&quot;&quot; /&gt;Due to employees potentially leaving and coming back into the company, we wanted to reactivate suspended Okta Users and reactivate deactivated Okta users.  The safeguards here are honestly very dependent on your needs. We did not modify the original settings here and 20% is the general safeguard for Okta applications. &lt;br /&gt;
However, if you are using BambooHR as the sole profile master, and you are deactivating accounts if something occurs at the application level (the employee gets removed from the App, BambooHR gets deactivated, etc) 20% of your employees will be deactivated causing you a massive headache when this occurs. My recommendation would be to set the percentage of your employee base to 20 people or less.&lt;/p&gt;

&lt;p&gt;Now you should be ready to run an import from BambooHR into Okta, you will likely have to confirm some users after the import runs. Since BambooHR was appended to the Profile Master hierarchy, you will notice that all users still have AD listed in the “Mastered by:” field.&lt;/p&gt;

&lt;p&gt;What I would suggest at this point, is creating Okta groups based on the Department Groups that we specified would be created in the Provisioning Section. The requirements for these groups will obviously differ for every company, internally we use XXXX, XYYY, XYZY numerical formatting for our groups. Meaning that those that are their team groups are not included in high level department groups. So if a teams numeric number is 1610, 1620, 1630 the only way to manage all these employees at once would be to create a 16XX group. This way you are inclusive to all teams. Then set up Group Rules to mirror the memberships from the BambooHR mastered Groups into Okta mastered groups, and to converge all team groups up into the high level department group. Since we can’t use non-Okta mastered groups for certain features of Okta, this helps us work around that.&lt;/p&gt;

&lt;p&gt;After this is complete, and you have finished any validation, you should be ready to move on to Phase 2.&lt;/p&gt;

&lt;h2 id=&quot;phase-2---import-all-active-directory-attributes&quot;&gt;Phase 2 - Import all Active Directory Attributes&lt;/h2&gt;

&lt;p&gt;When I state import all attributes, I mean ALL. Make sure you import all the data you need. We were using several custom attributes within our Active Directory schema - we needed these to be a part of Okta’s default Profile Editor / User Profile schema.&lt;/p&gt;

&lt;p&gt;To do this, make sure that you create attributes in the User Profile Type first, before you try and import the attributes from Active Directory. As an example:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/Screen-Shot-2020-08-07-at-10.56.16-PM-1024x945.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;(Unfortunately, we have already disabled Active Directory Profile Mastering - so I can’t provide photos here)&lt;/p&gt;

&lt;p&gt;At this point, you should be able to map the attribute from Active Directory into Okta, as I said, I would recommend migrating in ALL attributes that you might even think are not necessary.&lt;/p&gt;

&lt;h2 id=&quot;phase-3---migrate-membership-and-application-assignments-from-active-directory-groups-and-data-to-okta-groups-and-data&quot;&gt;Phase 3 - Migrate membership and application assignments from Active Directory groups and data to Okta groups and data&lt;/h2&gt;

&lt;p&gt;This would have been a fairly arduous and manual task - however, I made this a lot easier (even though the code looks like, well honestly, shit). Use &lt;a href=&quot;https://github.com/delize/ad_to_okta/blob/master/ad-to-okta-migration.py&quot;&gt;this python script from Github&lt;/a&gt;. Unfortunately, my mindset was just getting and testing the API when working with it, not writing production level code. It is currently being reworked to be more clear. While you will need to remove the comment out from the last 8 lines - what this does is:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Create Okta groups from existing Active Directory groups in Okta&lt;/li&gt;
  &lt;li&gt;Create Okta Group Rules based on existing Active Directory Group Names to link with Okta Group Names&lt;/li&gt;
  &lt;li&gt;Activate all Group Rules to copy group membership from AD to Okta&lt;/li&gt;
  &lt;li&gt;(Optionally) Deactivate all Group Rules so that group membership no longer is updated on changes to groups&lt;/li&gt;
  &lt;li&gt;Append and assign newly created Okta groups, to applications where AD groups are assigned&lt;/li&gt;
  &lt;li&gt;(Optionally) Remove the user from the Active Directory Application&lt;/li&gt;
  &lt;li&gt;(Optionally) Send a Password reset email to the employee’s Work and Home emails&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We thought these were the most important tasks that should be performed during our migration (maybe not all migrations, but at least ours). Looking back at this now, I noticed we did not think about the “Enhanced Push Groups” functions for applications, and something we should have written into our script - and I am happy to accept PRs to the code above (once it is improved). This might have been due to me not being able to find the API call to create, modify, or delete the push groups function.&lt;/p&gt;

&lt;p&gt;While I cannot show you in detail what the groups will look like (there will be too much redacting). The group names will be the exact same name of the AD group, and a Group Description of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AD2OKTA-API - &lt;/code&gt; followed by the Domain path. Group members should be mirrored from the original group.&lt;/p&gt;

&lt;p&gt;We wanted to allow for a period of time for memberships to update from AD. However, we didn’t want this enabled permanently - as we had a general problem of employees updating group memberships without letting people know or getting approval (this was due a Director+ employee requesting Domain Admin to his direct reports hierarchy). We gave a weeks time before re running the script to disable all Group Rules.&lt;/p&gt;

&lt;p&gt;Application assignments will be appended with the new groups at the bottom, after the existing group assignments. They will have the exact same configuration as the previously assigned groups for the application if it was assigned with an Active Directory group. So for example in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Atlassian Cloud&lt;/code&gt; application in Okta (which encompasses Jira and Confluence) when looking at the API for “List Assigned Groups”:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
        &quot;id&quot;: &quot;0F0F0F0F0F0F0F0F0F0F&quot;,
        &quot;lastUpdated&quot;: &quot;2019-10-02T23:45:35.000Z&quot;,
        &quot;priority&quot;: 1,
        &quot;profile&quot;: {
            &quot;preferredLanguage&quot;: &quot;English&quot;,
            &quot;timezone&quot;: null,
            &quot;organization&quot;: &quot;currentcompany&quot;,
            &quot;department&quot;: &quot;IT&quot;
        },
        &quot;_links&quot;: {
            &quot;app&quot;: {
                &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/apps/01010101010101010101&quot;
            },
            &quot;self&quot;: {
                &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/apps/01010101010101010101/groups/0F0F0F0F0F0F0F0F0F0F&quot;
            },
            &quot;group&quot;: {
                &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/groups/0F0F0F0F0F0F0F0F0F0F&quot;
            }
        }
    },
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The updated entry will appear like:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
        &quot;id&quot;: &quot;0A0A0A0A0A0A0A0A0A0A&quot;,
        &quot;lastUpdated&quot;: &quot;2020-04-02T23:45:35.000Z&quot;,
        &quot;priority&quot;: 36,
        &quot;profile&quot;: {
            &quot;preferredLanguage&quot;: &quot;English&quot;,
            &quot;timezone&quot;: null,
            &quot;organization&quot;: &quot;currentcompany&quot;,
            &quot;department&quot;: &quot;IT&quot;
        },
        &quot;_links&quot;: {
            &quot;app&quot;: {
                &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/apps/01010101010101010101&quot;
            },
            &quot;self&quot;: {
                &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/apps/01010101010101010101/groups/0A0A0A0A0A0A0A0A0A0A&quot;
            },
            &quot;group&quot;: {
                &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/groups/0A0A0A0A0A0A0A0A0A0A&quot;
            }
        }
    },
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see that the priority has changed but the profile or configured options stay the same, and the new group id has been applied.&lt;/p&gt;

&lt;p&gt;Or as another example, for Office 365, if this is the AD group that is assigned (as shown from the API and edited)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
       &quot;id&quot;: &quot;FFFFFFFFFFFFFFFFFFFF&quot;,
       &quot;lastUpdated&quot;: &quot;2020-04-13T21:38:26.000Z&quot;,
       &quot;priority&quot;: 1,
       &quot;profile&quot;: {
           &quot;licenses&quot;: [
               &quot;Azure Active Directory Premium P1 - Azure Active Directory Premium P1&quot;,
               &quot;Azure Active Directory Premium P1 - Azure Multi-Factory Authentication&quot;,
               &quot;Office 365 Business - O365 Business&quot;
           ],
           &quot;roles&quot;: null
       },
       &quot;_links&quot;: {
           &quot;app&quot;: {
               &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/apps/0b0b0b0b0b0b0b0b0b0b&quot;
           },
           &quot;self&quot;: {
               &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/apps/0b0b0b0b0b0b0b0b0b0b/groups/FFFFFFFFFFFFFFFFFFFF&quot;
           },
           &quot;group&quot;: {
               &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/groups/FFFFFFFFFFFFFFFFFFFF&quot;
           }
       }
   },
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will be the new group assignment:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
       &quot;id&quot;: &quot;00000000000000000000&quot;,
       &quot;lastUpdated&quot;: &quot;2020-04-13T21:38:26.000Z&quot;,
       &quot;priority&quot;: 4,
       &quot;profile&quot;: {
           &quot;licenses&quot;: [
               &quot;Azure Active Directory Premium P1 - Azure Active Directory Premium P1&quot;,
               &quot;Azure Active Directory Premium P1 - Azure Multi-Factory Authentication&quot;,
               &quot;Office 365 Business - O365 Business&quot;
           ],
           &quot;roles&quot;: null
       },
       &quot;_links&quot;: {
           &quot;app&quot;: {
               &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/apps/0b0b0b0b0b0b0b0b0b0b&quot;
           },
           &quot;self&quot;: {
               &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/apps/0b0b0b0b0b0b0b0b0b0b/groups/00000000000000000000&quot;
           },
           &quot;group&quot;: {
               &quot;href&quot;: &quot;https://currentcompany.okta.com/api/v1/groups/00000000000000000000&quot;
           }
       }
   },
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice the updated priority and the new group / id references. The “profiles” dict stays the same, copying the exact same information over.&lt;/p&gt;

&lt;p&gt;While we provide the option to remove the user from Active Directory entirely, I ultimately decided against doing it this way - as we have not completely deactivated Active Directory from our environment (as our deadline to deprecated AD is November of this year). However with everything done above, we can move on to the following phases.&lt;/p&gt;

&lt;p&gt;The same goes for the password reset emails. Since we were eventually going to turn off delegated authentication, it didn’t make much sense from an experience perspective - there was no reason to have them reset their password twice. We did not run this portion of the utility in production, but did test in our OktaS.&lt;/p&gt;

&lt;h2 id=&quot;phase-4---switch-the-profile-master-from-active-directory-to-bamboohr&quot;&gt;Phase 4 - Switch the Profile Master from Active Directory to BambooHR&lt;/h2&gt;

&lt;p&gt;We initiated this phase by informing our employees that were making changes that would streamline our onboarding process by changing the “Source of Truth” of where our data is coming from, but this wouldn’t affect the majority of user’s information or cause any problems.&lt;/p&gt;

&lt;p&gt;We navigated to &lt;a href=&quot;https://yourcompany-admin.okta.com/admin/profile-masters&quot;&gt;this page&lt;/a&gt;, and moved BambooHR from position 2 to position 1. We then went to the BambooHR Application we had in our Okta instance and run a full import.&lt;/p&gt;

&lt;p&gt;We did not modify the Profile Master section for at least a few weeks before continuing on to phase 5 of removing Active Directory as a Profile Master.&lt;/p&gt;

&lt;p&gt;As noted in the issues section, Names that have extended sections, or more than a single first and single last name presented issues. This was the ONLY issue that presented itself and you can read our full documentation and post-mortem on the changes that we sent to HR below:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;name-mapping-in-bamboohr-and-okta&quot;&gt;Name Mapping in BambooHR and Okta&lt;/h3&gt;
  &lt;p&gt;BambooHR Defaults and Custom Name Fields
By default, BambooHR comes with the following fields to capture a person’s name:&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;First Name&lt;/li&gt;
    &lt;li&gt;Middle Name&lt;/li&gt;
    &lt;li&gt;Last Name&lt;/li&gt;
    &lt;li&gt;Preferred Name&lt;/li&gt;
  &lt;/ul&gt;

  &lt;p&gt;In most cases, the above is sufficient. The “Preferred Name” can be set to anything (for instance, more than just a single word), however, as of May 5th, 2020, it is typically used to capture the preferred first name, such as a shortened name (i.e. Alexander → Alex).&lt;/p&gt;

  &lt;p&gt;There are employees with extended, combined, dual or shortened names who usually would like to request a reasonable “simplified” or “shortened” version of their full legal names. For example, consider a hypothetical person with the following full name: “Alexandre Juarez Juan-Castillo Alfonso”, where the legal first name is officially specified as “Alexandre Juarez” and legal last name is set as “Juan-Castillo Alfonso”. Suppose now that commonly, this person goes by “Alex Castillo”, with “Alex” being the preferred first name and “Castillo” being the preferred last name. It is impossible in this case to push the preferred name outside of the HR system with only the default fields available in BambooHR. At the same time, the legal requirement of keeping the full legal name on file in the HR system must be met.&lt;/p&gt;

  &lt;p&gt;In order to accommodate both sides, two additional custom fields can be setup in BambooHR:&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;Preferred First Name&lt;/li&gt;
    &lt;li&gt;Preferred Last Name&lt;/li&gt;
  &lt;/ul&gt;

  &lt;p&gt;These will distinguish between what is legally required to be captured by the HR system (using the default fields of BambooHR) and the requested version to accommodate the requester’s commonly used short name (using the additional custom fields setup in BambooHR). To be fully clear and explicit, the above employee would be entered as follows inn BambooHR:&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;First Name: Alexandre Juarez&lt;/li&gt;
    &lt;li&gt;Middle Name:&lt;/li&gt;
    &lt;li&gt;Last Name: Juan-Castillo Alfonso&lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;Preferred Name:&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;Preferred First Name: Alex&lt;/li&gt;
    &lt;li&gt;Preferred Last Name: Castillo&lt;/li&gt;
  &lt;/ul&gt;

  &lt;p&gt;Notice that the original “Preferred Name” field is redundant. As it is a BambooHR default field, it cannot be changed/removed, however, it can be hidden and not used generally. The new custom “Preferred First/Last Name” fields, however, can be either hidden or visible to the general employee. It is suggested that they are set to be visible and editable, subject to verification and approval of the people operations team.&lt;/p&gt;

  &lt;h3 id=&quot;name-sync-with-okta-and-services-provisioned-by-okta&quot;&gt;Name Sync with Okta and Services Provisioned by Okta&lt;/h3&gt;
  &lt;p&gt;Okta will pull the names from BambooHR in the logical manner described below. Note that the name in Okta and the majority of services and apps in Okta will be reflected depending which of these fields will be set in BambooHR.&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;If “Preferred First” and “Preferred Last” name fields are both specified, they will be treated as official first and last names on Okta and all its services. For the above example, the employee will see Alex Castillo as their name outside of BambooHR.&lt;/li&gt;
    &lt;li&gt;If “Preferred First” name field is empty and “Preferred Last” name field is specified, Okta will pull BambooHR’s “First Name” field as the first name and “Preferred Last” name field as the last name. In the above example, the employee will see Alexandre Juarez Castillo as their name outside of BambooHR.&lt;/li&gt;
    &lt;li&gt;If “Preferred First” name field is specified and “Preferred Last” name field is empty, Okta will pull “Preferred First” name field as the first name and BambooHR’s “Last Name” field as the last name. In the above example, the employee will see Alex Juan-Castillo Alfonso as their name outside of BambooHR.&lt;/li&gt;
    &lt;li&gt;If “Preferred First” and “Preferred Last” name fields are both unspecified, Okta will pull BambooHR’s “First Name” and “Last Name” fields as first and last names, respectively. For the above example, the employee will see Alexandre Juarez Juan-Castillo Alfonso as their name everywhere.&lt;/li&gt;
  &lt;/ul&gt;

  &lt;h3 id=&quot;the-case-of-the-displayname-attribute&quot;&gt;The Case of the “displayName” Attribute&lt;/h3&gt;
  &lt;p&gt;Both BambooHR and Okta have a user attribute called displayName. The two do not necessarily have to be the same. In case of Okta, certain apps and services are provisioned with this attribute for the names as opposed to the separate first and last names. The IT team will create logic on the Okta side so that Okta’s displayName attribute matches exactly in the manner described in the above section. In case of BambooHR, the exact functionality of this attribute is described in detail on BambooHR admin help documentation called Display Name. IT recommends that this value is set to {First Name} {Last Name} pair on BambooHR to align with legal name requirements of the HR system.&lt;/p&gt;

&lt;/blockquote&gt;

&lt;h2 id=&quot;phase-5---turn-off-profile-master-from-active-directory&quot;&gt;Phase 5 - Turn off Profile Master from Active Directory&lt;/h2&gt;

&lt;p&gt;First off, inform your product owners that any changes made in Active Directory will no longer update Okta with 2 to 4 weeks notice. Even today, and after three announcements and 4 months after our change - we still have employees making changes in Active Directory. You can’t solve everything, but, still make the announcement. If you have done imports correctly (by importing everything) in Phase 2, you should be good to go and have nothing to worry about here. That is, assuming that you don’t have any applications that import data into AD that is needed to push into Okta.&lt;/p&gt;

&lt;p&gt;You will also need to disable scheduled imports in Active Directory Provisioning Tab To Okta.&lt;/p&gt;

&lt;p&gt;Since here at $currentcompany, we mainly have cloud only services and have a cloud first mindset - we don’t have to worry about this.&lt;/p&gt;

&lt;h2 id=&quot;phase-6---remove-delegated-authentication&quot;&gt;Phase 6 - Remove delegated authentication&lt;/h2&gt;

&lt;p&gt;This was the most concerning portion of our transition. This is a disruptive change. While it was suggested that it could be possible to Update Users with a password hash, the Okta API only allows for creation and not update of ONLY the password value (at least not without also pushing the rest of the profile in the same PUT request), at least as far as I could research with the public API. In the long term, I also want to make sure that employees are starting with a “clean state” here.&lt;/p&gt;

&lt;p&gt;Before doing this, I would recommend announcing a few things to end users and making a few changes and performing a few tasks on the Admin side.&lt;/p&gt;

&lt;h3 id=&quot;end-users&quot;&gt;End Users&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Have them update or verify their Security Question - if they can’t remember their security question you should assist them using this API&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;administrator-dashboard&quot;&gt;Administrator Dashboard&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Update the Self Service time frame and the length of emails to be 24 to 48 hours (or the time frame that you see fit) - we did not do this and set the Self Service time frame to an hour - would not recommend.&lt;/li&gt;
  &lt;li&gt;Create a new password policy around your companies policies and any new Okta groups that have been created&lt;/li&gt;
  &lt;li&gt;Create an API Token to use Postman as a backup in case all Admin users get locked out of the Administrator Dashboard&lt;/li&gt;
  &lt;li&gt;Have the following Postman Collections prepared to use
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://developer.okta.com/docs/reference/api/users/#find-users&quot;&gt;Find User&lt;/a&gt; - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{{url}}/api/v1/users?q={{SEARCHSTRING}}&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://developer.okta.com/docs/reference/api/users/#unlock-user&quot;&gt;Unlock User&lt;/a&gt; - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{{url}}/api/v1/users/{{userId}}/lifecycle/unlock&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://developer.okta.com/docs/reference/api/users/#reset-password&quot;&gt;Reset Password &lt;/a&gt;- &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{{url}}/api/v1/users/{{userId}}/lifecycle/reset_password?sendEmail=true&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://developer.okta.com/docs/reference/api/users/#set-recovery-question-answer&quot;&gt;Set Recovery Question&lt;/a&gt; - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{{url}}/api/v1/users/{{userId}}&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;!-- end of the list --&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;        {
          &quot;credentials&quot;: {
            &quot;recovery_question&quot;: {
              &quot;question&quot;: &quot;What is a Kid's Cartoon and listens to directions?&quot;,
              &quot;answer&quot;: &quot;Dora the Explorer&quot;
            }
          }
        }
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that this needs to be in the body of the PUT request. Annoyingly, if you use the word “The” in your question, you can’t use the word or any variation of “The” in your answer.&lt;/p&gt;

&lt;p&gt;We gave employees a months notice, with an announcement every week on both Slack and Email. When we made the change, we setup a two day SLA response expectation based on timezone and support availability.&lt;/p&gt;

&lt;p&gt;We were making the changes on a Tuesday at 12 PM Pacific Time. This obviously has some issues, as the time period in Europe would be 9PM GMT at the earliest. We also only have Support Teams in London, Austin, and San Francisco. Meaning that our timezone availability is limited in the APAC region.&lt;/p&gt;

&lt;p&gt;We allowed for a 5 hour time frame for immediate response and live chat via a Slack Channel beginning at 11:30 AM where people could come in with issues (the most common of these being Security Question, Account State Issues, Password Reset Emails being expired/Resending Password Reset). This 5 hour window also allowed us to get the employees we have located in the earliest APAC region (Japan and Australia).  We don’t have many employees in other areas of APAC so it was less of an issue. The majority of our employees even in EMEA performed the password resets when they were sent an email.&lt;/p&gt;

&lt;p&gt;Then when our support employee started work in the EMEA region, his first 5 hours were dealing with issues pertaining to the Authentication changes as well.&lt;/p&gt;

&lt;p&gt;Overall, I am happy with how this was executed - and there was minimal issues from end users because of the long-term advanced notice. While we didn’t have many complaints, the complaints that did come in were mainly from our most vocal user base because they couldn’t remember their security question or that their account was in a locked out state because their account did not have a password.&lt;/p&gt;

&lt;h2 id=&quot;phase-7---push-membership-attributes-values-and-groups-from-okta-into-active-directory&quot;&gt;Phase 7 - Push membership, attributes, values, and groups from Okta into Active Directory&lt;/h2&gt;

&lt;p&gt;Things to be aware of before making this change:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Any service/software that uses Common Name values (as these could have possibly changed based on the Phase 4)&lt;/li&gt;
  &lt;li&gt;Any memberships or users that were manipulated in Active Directory after the Scheduled Imports and Profile Mastering was disabled&lt;/li&gt;
  &lt;li&gt;If Active Directory is listed as a profile master, you will not be able to perform any of the steps below&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With this, you will want to utilize &lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/Directory/ad-agent-cofigure-group-push-AD-OUs.htm&quot;&gt;Enhanced Group Push&lt;/a&gt; with Active Directory to link the Okta groups that were created from the transitioning phase, to the existing Active Directory Groups where expected. Primarily, this will only be for groups that the company wants to blanket management.&lt;/p&gt;

&lt;p&gt;The steps below to provision users from Okta into Active Directory are copied directly from &lt;a href=&quot;https://support.okta.com/help/s/article/How-to-sync-users-from-Okta-to-Active-Directory?language=en_US&quot;&gt;Okta’s site&lt;/a&gt;. Note that these must be done for each Active Directory Domain you want to provision users into.&lt;/p&gt;

&lt;p&gt;The following details how you can use Okta to create users in AD:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;In the Okta Admin Console, navigate to &lt;strong&gt;Admin &amp;gt; Directory &amp;gt; Groups&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Create a new group in Okta (You also can use an existing Okta Group).&lt;/li&gt;
  &lt;li&gt;Add Okta users that you want to be pushed to AD to the group created above.&lt;/li&gt;
  &lt;li&gt;Open the group in Okta and click on &lt;strong&gt;Manage Directories&lt;/strong&gt; button.&lt;/li&gt;
  &lt;li&gt;Select the target Active Directory instance and then click &lt;strong&gt;Next&lt;/strong&gt;.
    * NOTE: Your AD integration must have this OU selected in the **“Import and Provisioning” **section in order for Okta to create the AD users, as seen below:&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;https://support.okta.com/help/servlet/rtaImage?eid=ka01Y0000010yec&amp;amp;feoid=00N0Z00000GpsjR&amp;amp;refid=0EM1Y000000xYEh&quot; alt=&quot;User-added image&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Select the target OU where the users should be created in&lt;/li&gt;
  &lt;li&gt;Click on &lt;strong&gt;Confirm Changes&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;All users in the group will be pushed and synced to your Active Directory. If you add new users to the group, Okta will also push them automatically.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Notes:&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The &lt;strong&gt;Create Users&lt;/strong&gt; option must be enabled under the Active Directory settings in Okta, in order to push and create new users from Okta in Active Directory:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://support.okta.com/help/servlet/rtaImage?eid=ka01Y0000010yec&amp;amp;feoid=00N0Z00000GpsjR&amp;amp;refid=0EM1Y000000Ethy&quot; alt=&quot;User-added image&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The service account used by the Okta AD agent needs to either be a domain admin, or have permissions to make changes (creating users, update etc.) to your Active Directory. Otherwise, you will receive errors while trying to sync users from Okta to AD.&lt;/li&gt;
  &lt;li&gt;For detailed info regarding Active Directory integration with Okta, please refer to &lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/Directory/ad-agent-install.htm&quot;&gt;Install and configure the Okta Active Directory (AD) agent&lt;/a&gt; documentation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;While the steps above, I would recommend using your department based groups from the Phase 1 rollout, that way you know that the entire department/team will be have access to the AD Environment if needed. If a smaller subset is required you can revert to the team or department groups from the Phase 1 integration. We also decided to push attributes and other information so that employees had a single place to update and manage these details. You can see an example of our configuration below:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/image-836x1024.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;For mappings from Okta to AD, these are highly dependent on your needs and what you would like to push. While I am not able to share our mappings, for both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;distinguishedName&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;objectGUID&lt;/code&gt; these are listed as unmapped and not configured.&lt;/p&gt;

&lt;p&gt;From here, I would recommend going through the managed Directories/Groups being used multiple times, just to validate that you have not left any details out.&lt;/p&gt;

&lt;p&gt;From this point, you should be able to start Phase 8 if it is required, otherwise Phase 9.&lt;/p&gt;

&lt;h2 id=&quot;phase-8---decode-base64-encoded-values-from-okta&quot;&gt;Phase 8 - Decode Base64 encoded values from Okta&lt;/h2&gt;

&lt;p&gt;In case you find any &lt;a href=&quot;https://support.okta.com/help/s/question/0D50Z00008OJKeX/custom-ad-attribute-pushing-into-okta-as-a-the-base64-encoding-of-the-value?language=en_US&quot;&gt;attributes encoded in Base64&lt;/a&gt; values from your AD import (even though they shouldn’t be) in Phase 2, you can use &lt;a href=&quot;https://github.com/delize/Okta_decode_b64&quot;&gt;this python tool&lt;/a&gt; to decode to specify the attribute you want decoded along with your. Note that as of now (I plan to update this in the future to include a dry run flag or doit flag), you will need to change the python code to specify the option to actually run the functions against the host. The script was written for a specific purpose, and may not fit all needs - but it helped decode our attributes that had been in a bork’ed state for employees again.&lt;/p&gt;

&lt;p&gt;I am curious as to why not only restarting agents or performing full imports didn’t correct this. You would think that over the span of time that we did this, Okta’s AD Agent would have recognized and corrected the Base 64 attribute issue, but apparently this is still a problem in 2020. Unfortunately, I don’t know enough about how Okta internally works to make a further diagnosis on why it was still base64 encoded. It could have been that attributes initially recognized from an older time frame cause this, but then upgrading the agent and performing a full import - should have resolved that, so yeah, a little clueless as to the why, but the end result is that they are no longer encoded.&lt;/p&gt;

&lt;h2 id=&quot;phase-9---migrate-merakiwi-fi-authentication-from-ad-to-eap-ttls-with-okta&quot;&gt;Phase 9 - Migrate Meraki/Wi-Fi authentication from AD to EAP-TTLS with Okta&lt;/h2&gt;

&lt;p&gt;With Corona Virus causing all of our employees to Shelter In Place/Work From Home, this has been a lesser degree of involvement but given us a lot more time to work on it properly (and unfortunately, not yet finished). If we had to do this with employees in the office at the time, this would have been moved up in the list and would have been a prerequisite before proceeding with Phase 2, and executed the change within a few days of performing Phase 6.&lt;/p&gt;

&lt;p&gt;For this, again with a cloud first mentality - we wanted to deploy the Radius Agent using Docker. Unfortunately, Okta doesn’t have an official docker image of their Radius Agent, and I was unable to find any personal docker images. We have not built it ourselves yet (due to our recent announcement and closure of $acquiringcompany acquisition of $currentcompany).  In the mean time, we deployed a GCP VM with minimal requirements to host the RADIUS Agent. You will need to setup a firewall rule within GCP to enable outside access into the RADIUS Agent. My recommendation would be to use a more open approach to the Radius Agent initially before locking down the allowed IP ranges that communicate with the inbound port. You can then apply the radius tag to the servers that will host the Radius Agent. An example of this can be seen below:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2020/08/image-1-638x1024.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From this point, you should be able to follow Okta’s&lt;a href=&quot;https://help.okta.com/en/prod/Content/Topics/integrations/cisco-meraki-radius-intg.htm#Part1&quot;&gt; instructions on the Meraki Interoperability Feature&lt;/a&gt;, this is a fairly straight forward guide that does not need a lot of description on. The hardest part from our testing was not over engineering this and just keeping it simple. We use Meraki MR5X series devices, and did not experience any initial issues on a single AP. Since we are not in the office yet, this might have some issues when we scale it up - but we have not been able to test this adequately yet.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;We now have a lot more flexibility in our services and there are some more room for improvements.&lt;/p&gt;

&lt;p&gt;For instance, we can utilize &lt;a href=&quot;https://github.com/pmcdowell-okta/okta2anything&quot;&gt;Okta2Anything&lt;/a&gt; to create a proxy to allow our DB systems and other services, if Okta LDAP Interface can’t be used or you need more/managed reliability to the instance.&lt;/p&gt;

&lt;p&gt;If  you still need Active Directory, you can create “on the fly”/ad-hoc Active Directory domains with Terraform, to spin up random instances of Active Directory. Note, that the Active Directory Domain HAS to have a unique name for you to spin up users in an “on the fly” manner. If the Domain Name is the same, Okta will treat it as a single domain, even if the AD Domain Controllers are not in a cluster or joined together. The idea behind this is that you can scope specific users for certain requirements, limiting the scope of the user base and entry points. This utilizes the Enhanced Group Push service from Okta.&lt;/p&gt;

&lt;p&gt;Automate Administrators with Okta Groups, unfortunately, this is restricted where groups that have group rules applied to them - can’t be automatically used to grant administrator access. The main idea was to grant our InfoSec team Read Only access across the board when they were first hired.&lt;/p&gt;

&lt;p&gt;Things we could have done better:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Validate Common Name/Display Name changes before pushing them from Okta into AD&lt;/li&gt;
  &lt;li&gt;Be aware of the name controversy from BambooHR to Okta that caused some annoyance to a small subset of individuals (less than 15)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We have greatly removed our reliance on Active Directory at this point, and we no longer have to worry about or maintain it. As the only tools that our office infrastructure needs for integration is Okta. While we won’t tear down Active Directory immediately (mainly due to SIP/WFH environments), this puts us in a better position to deprecate it.&lt;/p&gt;

&lt;p&gt;This also means, that any infrastructure that requires Active Directory, we can push users into and our DevOps / SRE teams can now manage the AD instance in the way they see fit, with a base group membership that can be managed when/where needed. This prevents owners not being aware of changes being made to the system without change management in place.&lt;/p&gt;

&lt;p&gt;Our DevOps/SRE team has some concerns due to Okta not having Service Level Agreements without &lt;a href=&quot;https://www.okta.com/blog/2020/07/99-point-99-percent-uptime-for-all/&quot;&gt;paying $100,000 USD for 99.99% uptime&lt;/a&gt; (this was the initial response we received). While a valid concern, when looking at &lt;a href=&quot;https://status.okta.com/&quot;&gt;multiple&lt;/a&gt; &lt;a href=&quot;https://status.okta.com/#history&quot;&gt;statistics&lt;/a&gt; from Okta on their availability, I would not be overly worried. We have also begun testing Okta’s endpoints with our own Product to validate the SLA times for our own needs.&lt;/p&gt;

&lt;p&gt;Admittedly, the one thing that really annoys me, is that Okta does not provide a company hosted/non-self managed Okta RADIUS Interface. This seems like it would be a no-brainer to provide to your customers. It honestly boggles my mind.&lt;/p&gt;

&lt;h2 id=&quot;questions&quot;&gt;Questions?&lt;/h2&gt;

&lt;p&gt;If you have any questions, feel free to leave a comment below (just note, I don’t always pay attention to those) or come by the  &lt;a href=&quot;https://macadmins.slack.com/archives/C0LFP9CP6&quot;&gt;#okta Slack Channel&lt;/a&gt; on &lt;a href=&quot;https://www.macadmins.org/&quot;&gt;MacAdmin&lt;/a&gt;. There is a super helpful group of people located there that can assist you with this or any other Okta related issues.&lt;/p&gt;

&lt;p&gt;EDIT: I was asked to remove all references to &lt;a href=&quot;http://thousandeyes.com/&quot;&gt;$currentcompany&lt;/a&gt; and &lt;a href=&quot;https://www.cisco.com/&quot;&gt;$acquiringcompany&lt;/a&gt; due to “reason”. Hopefully this suffices, as there was no endorsements in this to begin with, but complied.&lt;/p&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Identity Access Management" /><category term="Active Directory" /><category term="BambooHR" /><category term="HRIS" /><category term="Infrastructure" /><category term="Meraki" /><category term="Ofice" /><category term="Okta" /><summary type="html">Transitioning from legacy Active Directory to a cloud centric HRIS, Okta, and Push System. This blog post will go over all workflow process of transitioning, this does not go into low level details on how to transition due to the environment that this took place in.</summary></entry><entry><title type="html">Workspace One &amp;amp; Okta - User(s) and Group(s) working with DEP Enrollment</title><link href="https://andrewdoering.org/blog/2019/12/23/workspace-one-okta-users-and-groups-working-with-dep-enrollment/" rel="alternate" type="text/html" title="Workspace One &amp;amp; Okta - User(s) and Group(s) working with DEP Enrollment" /><published>2019-12-23T07:03:05+00:00</published><updated>2019-12-23T07:03:05+00:00</updated><id>https://andrewdoering.org/blog/2019/12/23/workspace-one-okta-users-and-groups-working-with-dep-enrollment</id><content type="html" xml:base="https://andrewdoering.org/blog/2019/12/23/workspace-one-okta-users-and-groups-working-with-dep-enrollment/">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#how-this-document-is-structured&quot;&gt;How this document is structured&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#why-is-okta-ldap-and-ws-one-uem-intergation-important&quot;&gt;Why is Okta LDAP and WS One UEM Intergation important?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#software-requirements&quot;&gt;Software Requirements&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#okta---adding-user-attributes&quot;&gt;Okta - Adding User Attributes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#workspace-one---directory-services--server-configuration&quot;&gt;Workspace One - Directory Services &amp;gt; Server Configuration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#workspace-one---directory-services--user-mapping&quot;&gt;Workspace One - Directory Services &amp;gt; User Mapping&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#workspace-one---directory-services--group-mappings&quot;&gt;Workspace One - Directory Services &amp;gt; Group Mappings&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#okta---limitations-to-be-aware-of&quot;&gt;Okta - Limitations to be aware of&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#workspace-one---test-your-setup&quot;&gt;Workspace One - Test your setup&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#workspace-one---add-group&quot;&gt;Workspace One - Add Group&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#workspace-one---dep-profile&quot;&gt;Workspace One - DEP Profile&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#okta---saml-application&quot;&gt;Okta - SAML Application&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#our-room-for-improvement&quot;&gt;Our room for improvement&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#comments-questions&quot;&gt;Comments, Questions?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;If you have not yet read &lt;a href=&quot;https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta/&quot;&gt;the previous writeup about Airwatch and SAML,&lt;/a&gt;, I would highly recommend reading this before finishing the setup, this page will pick up on where we left off on the Room for Improvements section. Namely, getting user imports, and Okta groups to have successful lookups as well as member imports.&lt;/p&gt;

&lt;p&gt;I also have to apologize, as this blog post was written on plane wifi, and as we all know… plane wifi is awful. I coincidentally, had to VNC to a differenct machine to even get into my blog, as the connection would time out.  So I had to write most of this from memory and without photos as a step by step guide on how to do this configuration.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; that everything listed here is not for the Workspace One Identity Manager, but solely for LDAP Settings&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note 2:&lt;/strong&gt; As of writing this, this has only been tested in a Feature Staging environment, as I did not want to make a change over the weekend, nor did I want to make such a drastic change into our directory services over the holiday break without the time to properly test. So this has been tested in our feature stage but not in production. However within the feature stage, I was able to DEP enroll devices. Automatically add the users into groups, and import group objects and user objects without issue, and allow SAML.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note 3:&lt;/strong&gt; “After writing this, I looked up Airwatch’s documentation – it is vastly improved. It looks like the documentation can finally be used as a mechanism to implement features and integrations.” This quote is taken from my first blog post. Airwatch’s documentation still needs improvement. Their directions for this were completely wrong, and I spent over a month (or what seemed like it) going back and forth with support. In the end, it was more of dumb luck getting this to work, as I eventually got on a call with Okta &amp;amp; Airwatch Support, and neither of them unfortunately knew what specific attributes needed to be used either.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note 4&lt;/strong&gt;: This is working as of January 1st 2019, I can’t guarantee that it will continue to work after this date. (Though I don’t see why it wouldn’t).&lt;/p&gt;

&lt;h3 id=&quot;how-this-document-is-structured&quot;&gt;How this document is structured&lt;/h3&gt;

&lt;p&gt;I will go over the prerequisites first, each title should will be either the task being performed, or in Airwatch’s case, the settings page which is being viewed (and also the task being performed). The document will black out specific or private information to the company that I am not allowed to share - if you noticed from the original blog post, not a lot was edited out for you.&lt;/p&gt;

&lt;p&gt;I use Airwatch and Workspace One synonymously. Sorry about that.&lt;/p&gt;

&lt;p&gt;As Monty Python skits would say “Get on with it”… let us do so.&lt;/p&gt;

&lt;h2 id=&quot;why-is-okta-ldap-and-ws-one-uem-intergation-important&quot;&gt;Why is Okta LDAP and WS One UEM Intergation important?&lt;/h2&gt;

&lt;p&gt;Having a lack of groups causes us some issues when assigning smart groups, applications, policies, etc. Because of this, we were pretty much limited to an all or nothing approach or specific lookups when trying to determine things like all devices over macOS 10.15, or a specific subset of macOS devices.&lt;/p&gt;

&lt;p&gt;I also know that several people have been struggling to get this working properly, and Airwatch/VMware has been less than helpful for the most part to those users as their tickets are still open. The same exists on the Okta side, as it was discussed there during our Okta meetings with them.&lt;/p&gt;

&lt;p&gt;Slow but sturdy steps in our race to achieve greatness with Workspace One!&lt;/p&gt;

&lt;h2 id=&quot;software-requirements&quot;&gt;Software Requirements&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Airwatch Cloud Connector (optional)&lt;/li&gt;
  &lt;li&gt;Okta Ldap Interface&lt;/li&gt;
  &lt;li&gt;Okta&lt;/li&gt;
  &lt;li&gt;Airwatch / Workspace One&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;okta---adding-user-attributes&quot;&gt;Okta - Adding User Attributes&lt;/h2&gt;

&lt;p&gt;Please note, that I copied this verbatim from the previous blog post.&lt;/p&gt;

&lt;p&gt;Because we want to integrate this with Azure later on, and Active Directory, we need to map some of our existing attributes from Active Directory and push them into Okta.&lt;/p&gt;

&lt;p&gt;First, go here:  &lt;a href=&quot;https://YOURDOMAIN-admin.okta.com/admin/universaldirectory&quot;&gt;https://YOURDOMAIN-admin.okta.com/admin/universaldirectory&lt;/a&gt; and select the Profile button located below&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Click the add attribute button&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Use the the following settings for the Attributes&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now, lets go to Active Directory’s mapping, select your domain to setup the mapping push. You want to push from the Active Directory Domain to Okta.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;workspace-one---directory-services--server-configuration&quot;&gt;Workspace One - Directory Services &amp;gt; Server Configuration&lt;/h2&gt;

&lt;p&gt;Please refer to &lt;a href=&quot;https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta/#3-workspace-one---directory-services-integration&quot;&gt;this link&lt;/a&gt; if you would like to go into more depth about how to setup this section.&lt;/p&gt;

&lt;p&gt;Our Directory Services type setup is the same as last time, I will post it again here for your convince.&lt;br /&gt;
To reiterate, you need to have a user that is either ReadOnly or SuperAdmin. The preferred method would be ReadOnly, as if your account credentials are scraped somehow from Airwatch, there will be minimal access potentially given up. Sure they will have read only access to everything but they won’t be able to do anything except read the config (still bad, but less of a risk). While you can’t control the risk of your password being dumped from Airwatch (that risk is on Airwatch) you can definitely device the risk of control given out (your access level of your BIND User). I will not go&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/2019-11-28_12-39-35.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;workspace-one---directory-services--user-mapping&quot;&gt;Workspace One - Directory Services &amp;gt; User Mapping&lt;/h2&gt;

&lt;p&gt;Now here is where we get to the fun part. This is where both Okta’s and VMware’s documentation are incredibly wrong.&lt;/p&gt;

&lt;p&gt;For the User Mapping you will want to fill out the following attributes, with their corresponding mappings, setting everything else to the Airwatch Default.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Object Identifer: uniqueIdentifier
User Name: uid
Member Of: memberOf #leave default
Full Name: cn
Display Name: cn
First Name: givenName #leave default
Middle Name: middleName #leave default
Last Name: sn #leave default
Email Address: uid
Email Username: sAMAccountName
Mobile Phone: mobile #leave default
Phone Number: telephoneNumber #leave default
Distinguished Name: dn
User Principal Name: uid
Status: UserAccountControl #leave default
Lockeout Time: lockoutTime #leave default
Object Category: objectCategory #leave default
Last Modified: whenChanged #leave default
Binding Attribute: (blank) #leave default, or remove mapping
Employee ID: employeeID
Cost Center: (blank) #leave default, or remove mapping
Manager Distinguished Name: managerName #leave default
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#&lt;/code&gt; and to the right are listed as comments, the mappping should be the value immediately after the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:&lt;/code&gt;. This should get you a working configuration, assuming you followed the Okta Mapping from the previous blog post, otherwise replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sAMAccountName&lt;/code&gt; with some other attribute from Okta that you have created. I will get into why we are using this specific attribute later on.&lt;/p&gt;

&lt;p&gt;Now, save the following settings and then scroll up to the top of the page. Now the important piece here is that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User Search Filter&lt;/code&gt; will change automatically to something that we don’t want. It is a little counterintuitive but, when it does this automatic change, it also removes the ability for your group lookup to work properly. I found that deleting the first entry of this and setting it to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;($(uid={EnrollmentUser}))&lt;/code&gt; works much better than what is stated here. Your page should end up looking like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You will need to save the mapping again, and then switch to the groups tab.&lt;/p&gt;

&lt;h2 id=&quot;workspace-one---directory-services--group-mappings&quot;&gt;Workspace One - Directory Services &amp;gt; Group Mappings&lt;/h2&gt;

&lt;p&gt;I was so very close in the original blog post for our group mappings, I only messed up one attribute value. Please see the correct settings below:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;```
ObjectIdenfiter: uniqueIdentifier
Name: cn
Member: uniqueMember
Common Name: cn #leave default
Member Of: memberOf #leave default
Group Object Class: objectClass
Organizational Unit: ou #leave default
Organizational Unit Object Class: objectClass
```
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You may need to set the value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Maximum Allowable Changes&lt;/code&gt; to something higher than 10, maybe something like 100 or 500. Depends on some of the initial imports you will be doing.  Save the group settings, you should be done with this page.&lt;/p&gt;

&lt;h2 id=&quot;okta---limitations-to-be-aware-of&quot;&gt;Okta - Limitations to be aware of&lt;/h2&gt;

&lt;p&gt;Again, as we are using the LDAP Interface, this interface will ONLY respond with Okta mastered groups. Active Directory Groups that have been pushed to Okta will NOT respond to the LDAP interface lookup. Unfortunately, I don’t believe Okta has any plans on changing this in the future.&lt;/p&gt;

&lt;h2 id=&quot;workspace-one---test-your-setup&quot;&gt;Workspace One - Test your setup&lt;/h2&gt;

&lt;p&gt;Once you have saved the entire configuration (both members and groups) click the test connection. You should be prompted with Workspace One’s new LDAP/Directory Services testing tool. I wish they had this when we originally set stuff up, as it makes troubleshooting the mappings a lot easier.&lt;/p&gt;

&lt;p&gt;If you test a member, you should see something similar to the following:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you test a group, you should see something similar to the following:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/groups.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From here, if everything looks similar to the photo above, you should be good to go.&lt;/p&gt;

&lt;h2 id=&quot;workspace-one---add-group&quot;&gt;Workspace One - Add Group&lt;/h2&gt;

&lt;p&gt;Again, remembering that the limitation here is that Okta can only deliver groups created within Okta and not from external sources, create a group (or use an existing group) with a select few test users you want use. There is  also a limitation that if the user does not exist, they will not be created upon the sync of the group.&lt;/p&gt;

&lt;p&gt;I will create a group in Okta called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iam_airwatch_test_group&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we see that there are two users within the group here. If I then switch back to airwatch and search for the group we get the following:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So from here, lets say I add the group, my atesting account already exists in the user directory, so we have a single user in the group as of now, and then I go add our second testing user to Airwatch’s directory service, the user is automatically added into the group and the group syncs up and reports two users in Airwatch as group members:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-12-1024x68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There you have it, group membership working properly!&lt;/p&gt;

&lt;h2 id=&quot;workspace-one---dep-profile&quot;&gt;Workspace One - DEP Profile&lt;/h2&gt;

&lt;p&gt;Now, I personally don’t want our user’s usernames being user@thousandeyes.com, and I noticed that Workspace One is quite buggy with version 1910 and the DEP Enrollment profile for macOS 10.14+ devices (specifically, the autofill settings when not using custom enrollment). If you make any changes to the above settings, like we just did, I have HAD to change the settings on this page as a result for them to take effect on all new DEP Devices.  For the most part, all I would do is just toggle the settings back and forth for the Autofill options, or your hidden administrator for them to repopulate, however if that does not work, I will show you how we have it configured.&lt;/p&gt;

&lt;p&gt;How we have this configured at ThousandEyes:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So because we want the user’s account name to be the email prefix, we are relying on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sAMAccountName&lt;/code&gt; that we are passing from Okta to Workspace One’s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{EmailUserName}&lt;/code&gt; attribute. You could also pass this as a custom attribute if you would like, but, I did not have much success in initially getting custom attributes to appear. This would be the more long term approach though, as if we are using Okta, that WOULD be a custom attribute.&lt;/p&gt;

&lt;p&gt;From there, the employee would authenticate against DEP with their full email address, and then their username would automatically provision with the prefix of their email, pre populate their password, and populate their full name.&lt;/p&gt;

&lt;h2 id=&quot;okta---saml-application&quot;&gt;Okta - SAML Application&lt;/h2&gt;

&lt;p&gt;Please see the previous documentation I wrote &lt;a href=&quot;https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta/#8-okta---saml-app-for-airwatch&quot;&gt;here&lt;/a&gt;. This page should still work great based on our existing setup.&lt;/p&gt;

&lt;h2 id=&quot;our-room-for-improvement&quot;&gt;Our room for improvement&lt;/h2&gt;

&lt;p&gt;We are still working on getting Azure AD set up, so this guide is mainly geared towards a macOS only environment. Though, with the user settings the way they are I am hopeful that this will work.&lt;/p&gt;

&lt;p&gt;If it does not, we just have to set up our Organizational Groups to split Windows and macOS devices in o two different buckets, and have a different set of settings between them.  I am looking forward to the challenge when we get there.&lt;/p&gt;

&lt;p&gt;Without having tested group changes thoroughly before writing this, I am worried that the group memberships won’t update based on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Last Modified&lt;/code&gt; attribute not having a value, however, that will remain to be seen as we keep moving forward with this project.&lt;/p&gt;

&lt;p&gt;To also compare this blog post to what VMware originally wrote (at the time of writing this, I have attached the &lt;a href=&quot;https://kb.vmware.com/s/article/2961230?lang=en_US&quot;&gt;current KB article&lt;/a&gt; in PDF format below:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/blog/2019/12/Configuring-Okta-LDAP-for-use-with-VMware-Workspace-ONE-UEM-2961230.pdf&quot;&gt;Configuring-Okta-LDAP-for-use-with-VMware-Workspace-ONE-UEM-2961230&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;comments-questions&quot;&gt;Comments, Questions?&lt;/h2&gt;

&lt;p&gt;I will likely be a lot more responsive on the MacAdmins slack, you can find me in the #airwatch channel with the username @heimdall. It’s a great resource for people and I highly recommend that you join if you are looking for help with anything Mac related.&lt;/p&gt;

&lt;p&gt;Otherwise, feel free to comment below.&lt;/p&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Identity Access Management" /><category term="Mobile Device Management" /><category term="Airwatch" /><category term="DEP" /><category term="Groups" /><category term="macOS" /><category term="Okta" /><category term="Users" /><category term="workspace" /><category term="workspace one" /><summary type="html">This guide covers how to setup member and group importing, the correct way, in Airwatch/Workspace One using Okta as an LDAP backend.</summary></entry><entry><title type="html">macOS - Using nudge to deploy major (and minor) OS updates</title><link href="https://andrewdoering.org/blog/2019/12/11/macos-using-nudge-to-deploy-major-and-minor-os-updates/" rel="alternate" type="text/html" title="macOS - Using nudge to deploy major (and minor) OS updates" /><published>2019-12-11T04:24:00+00:00</published><updated>2019-12-11T04:24:00+00:00</updated><id>https://andrewdoering.org/blog/2019/12/11/macos-using-nudge-to-deploy-major-and-minor-os-updates</id><content type="html" xml:base="https://andrewdoering.org/blog/2019/12/11/macos-using-nudge-to-deploy-major-and-minor-os-updates/">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#prerequisites&quot;&gt;Prerequisites&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#lets-get-started&quot;&gt;Let’s get started!&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#fork-the-github-code-to-your-own-repo&quot;&gt;Fork the Github Code to your own repo&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#examining-the-template-file-and-the-resources-folder&quot;&gt;Examining the template file and the resources folder&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#jamf-specific-configuration&quot;&gt;JAMF specific configuration&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#munki-specific-configuration&quot;&gt;Munki specific configuration&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#thousandeyes-example-template&quot;&gt;ThousandEyes Example Template&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#nudge-launchagent&quot;&gt;nudge LaunchAgent&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#using-gcp&quot;&gt;Using GCP&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#stg--prod&quot;&gt;STG &amp;amp; PROD&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ways-to-improve-this&quot;&gt;Ways to improve this&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#major-thanks-to-erik&quot;&gt;Major thanks to Erik&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Having users update that do not have administrator permissions in macOS is a pain. Thankfully there is a cool (not new, but not well known) tool out called nudge (by Erik Gomez). You find the tool &lt;a href=&quot;https://github.com/erikng/nudge&quot;&gt;here on Github&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I will be going over how we are implementing this at ThousandEyes.&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;GCP Bucket (because it is free!)&lt;/li&gt;
  &lt;li&gt;JSON template&lt;/li&gt;
  &lt;li&gt;Software Deployment Tool (JAMF or Munki, we use Munki)&lt;/li&gt;
  &lt;li&gt;Catalina Installer (we need to grab the icons from somewhere)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;lets-get-started&quot;&gt;Let’s get started!&lt;/h2&gt;

&lt;h3 id=&quot;fork-the-github-code-to-your-own-repo&quot;&gt;Fork the Github Code to your own repo&lt;/h3&gt;

&lt;p&gt;In case something happens to the source, always be sure to fork the repo to your own. You can always pull updates and push into your fork.&lt;/p&gt;

&lt;h3 id=&quot;examining-the-template-file-and-the-resources-folder&quot;&gt;Examining the template file and the resources folder&lt;/h3&gt;

&lt;p&gt;Erik was very considerate enough to already provide the template file in the fork, however, there is some modifications to make here.&lt;/p&gt;

&lt;p&gt;If we take a look at the fork we will notice a few specific things. Mainly that there is a nice “resources” folder located &lt;a href=&quot;https://github.com/erikng/nudge/tree/3901ca478b32a323924f7b443826c4ead61c3a60/payload/Library/Application%20Support/nudge/Resources&quot;&gt;here&lt;/a&gt;. This means that we can indepently modify both the company logo, as well as the update_ss.png content after deployment without recompiling the entire application. In addition to this, if you look below:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    {
        &quot;preferences&quot;: {
            &quot;button_title_text&quot;: &quot;Ready to start the update?&quot;,
            &quot;button_sub_titletext&quot;: &quot;Click on the button below.&quot;,
            &quot;cut_off_date&quot;: &quot;2018-12-31-00:00&quot;,
            &quot;cut_off_date_warning&quot;: 3,
            &quot;days_between_notifications&quot;: 0,
            &quot;logo_path&quot;: &quot;/path/to/company_logo.png&quot;,
            &quot;main_subtitle_text&quot;: &quot;A friendly reminder from your local IT team&quot;,
            &quot;main_title_text&quot;: &quot;macOS Update&quot;,
            &quot;minimum_os_version&quot;: &quot;10.14.0&quot;,
            &quot;more_info_url&quot;: &quot;https://google.com&quot;,
            &quot;no_timer&quot;: false,
            &quot;paragraph1_text&quot;: &quot;A fully up-to-date device is required to ensure that IT can your accurately protect your computer.&quot;,
            &quot;paragraph2_text&quot;: &quot;If you do not update your computer, you may lose access to some items necessary for your day-to-day tasks.&quot;,
            &quot;paragraph3_text&quot;: &quot;To begin the update, simply click on the button below and follow the provided steps.&quot;,
            &quot;paragraph_title_text&quot;: &quot;A security update is required on your machine.&quot;,
            &quot;path_to_app&quot;: &quot;/Applications/Install macOS Mojave.app&quot;,
            &quot;screenshot_path&quot;: &quot;/path/to/update_ss.png&quot;,
            &quot;timer_day_1&quot;: 600,
            &quot;timer_day_3&quot;: 7200,
            &quot;timer_elapsed&quot;: 10,
            &quot;timer_final&quot;: 60,
            &quot;timer_initial&quot;: 14400,
            &quot;random_delay&quot;: false,
            &quot;update_minor&quot;: false,
            &quot;update_minor_days&quot;: 14
        },
        &quot;software_updates&quot;: [{
            &quot;name&quot;: &quot;091-22861&quot;,
            &quot;force_install_date&quot;: &quot;2018-12-31-00:00&quot;
        }]
    }
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We are also able to specify custom paths for the company logo and the screenshot path. So we don’t necessarily need to constantly replace/overwrite the files listed in here and recompile the application every time a major OS is released.&lt;/p&gt;

&lt;p&gt;We can simply modify the config json file, time after time, with changes to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;screenshot_path&lt;/code&gt; - the image that shows in the middle of the nudge UI&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;logo_path&lt;/code&gt; - the company logo (hopefully this doesn’t change too often)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;more_info_url&lt;/code&gt; - the documentation page that you should provide employees about the OS update&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cut_off_date&lt;/code&gt; - the deadline you want employees to upgrade by&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;minimum_os_version&lt;/code&gt; - the minimum MAJOR OS Version that you would like to apply&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, within this template we need to make a few more changes.&lt;/p&gt;

&lt;p&gt;Everything from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;software_updates&quot;: [{&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;}]&lt;/code&gt; needs to be removed. Also be sure to remove the comma(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;,&lt;/code&gt;) next to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;}&lt;/code&gt;.  This is due to the code changing, and this becoming deprecated in a previous version of the software. We also need to remove the comma since we no longer have a second array in the configuration file.&lt;/p&gt;

&lt;p&gt;Now, in addition to the above, we need to add several things depending on your configuration (I assume you are using a management software to roll out the OS upgrade). Platform independent changes are going to be adding a minimum sub os version (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;minimum_os_sub_build_version&lt;/code&gt;) and a value (in our case we used &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;19B88&lt;/code&gt; - based on the sub build version from &lt;a href=&quot;https://developer.apple.com/news/releases/?id=10292019c&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;

&lt;h4 id=&quot;jamf-specific-configuration&quot;&gt;JAMF specific configuration&lt;/h4&gt;

&lt;p&gt;I just want to be clear, we don’t use JAMF at ThousandEyes, so this configuration may be wrong - I am basing the information here on the readme.md file, as well as general knowledge of what I can find in the JAMF’s documentation.&lt;/p&gt;

&lt;p&gt;If you would like users to launch the UI page in the Jamf Self Service tool, for them to perform the upgrade at a conveient time:&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;local_url_to_upgrade&quot;: &quot; jamfselfservice://content?entity=policy&amp;amp;id=&amp;lt;id&amp;gt;&amp;amp;action=view &lt;/code&gt;&lt;/p&gt;

&lt;p&gt;If you would like users to automatically initiate the upgrade as soon as they hit the button:&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;local_url_to_upgrade&quot;: &quot; jamfselfservice://content?entity=policy&amp;amp;id=&amp;lt;id&amp;gt;&amp;amp;action=execute &quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Now with both of the methods above, you would need to replace the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;id&amp;gt;&lt;/code&gt; with the actual ID of the policy. Since we don’t run JAMF at ThousandEyes, not sure if this is a numeric value or a string.&lt;/p&gt;

&lt;h4 id=&quot;munki-specific-configuration&quot;&gt;Munki specific configuration&lt;/h4&gt;

&lt;p&gt;We do however, use Munki at ThousandEyes. So I can give you a more specific/detailed explanation here. Unfortunately, what we are doing here is very straight forward. As ThousandEyes&lt;/p&gt;

&lt;h4 id=&quot;thousandeyes-example-template&quot;&gt;ThousandEyes Example Template&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;      {
        &quot;preferences&quot;: {
            &quot;button_title_text&quot;: &quot;Ready to start the update?&quot;,
            &quot;button_sub_titletext&quot;: &quot;Click on the button below.&quot;,
            &quot;cut_off_date&quot;: &quot;2020-1-15-00:00&quot;,
            &quot;cut_off_date_warning&quot;: 20,
            &quot;days_between_notifications&quot;: 0,
            &quot;logo_path&quot;: &quot;/Library/Application Support/nudge/Resources/company_logo.png&quot;,
            &quot;main_subtitle_text&quot;: &quot;A friendly reminder from your local IT team&quot;,
            &quot;main_title_text&quot;: &quot;macOS Update&quot;,
            &quot;minimum_os_version&quot;: &quot;10.15.1&quot;,
            &quot;minimum_os_sub_build_version&quot;: &quot;19B88&quot;,
            &quot;more_info_url&quot;: &quot;https://knowledgebase.documentation.com&quot;,
            &quot;no_timer&quot;: false,
            &quot;paragraph1_text&quot;: &quot;A fully up-to-date device is required to ensure that IT can your accurately protect your computer.&quot;,
            &quot;paragraph2_text&quot;: &quot;If you do not update your computer, you may lose access to some items necessary for your day-to-day tasks.&quot;,
            &quot;paragraph3_text&quot;: &quot;To begin the update, simply click on the button below and follow the provided steps.&quot;,
            &quot;paragraph_title_text&quot;: &quot;A security update is required on your machine.&quot;,
            &quot;path_to_app&quot;: &quot;/Applications/Install macOS Catalina.app&quot;,
            &quot;screenshot_path&quot;: &quot;/Library/Application Support/nudge/Resources/update_stg.png&quot;,
            &quot;timer_day_1&quot;: 600,
            &quot;timer_day_3&quot;: 3600,
            &quot;timer_elapsed&quot;: 10,
            &quot;timer_final&quot;: 300,
            &quot;timer_initial&quot;: 14400,
            &quot;random_delay&quot;: false,
            &quot;update_minor&quot;: true,
            &quot;update_minor_days&quot;: 14,
            &quot;local_url_for_upgrade&quot;: &quot;munki://detail-Install_macOS_Catalina&quot;
        }
      }
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I left the defaults for some of the content, as to be honest, I don’t know if I could come up with any better wording. However, I did change the timer numbers - I want to maximize the amount of popups but without the too much annoyance. If we leave too much a gap, users will just ignore it.&lt;/p&gt;

&lt;p&gt;Omitting our own knowledgebase article url, include yours. Ours is quite slim, as this tool has made it far easier to upgrade.&lt;/p&gt;

&lt;p&gt;While &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;path_to_upgrade&lt;/code&gt; should/would be ignored since we are using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;local_url_for_upgrade&lt;/code&gt;, we left it in as a backup in case.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;local_url_for_upgrade&lt;/code&gt; is pointing directly to our Catalina installation. If you don’t modify the contents when using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;munkiimport&lt;/code&gt; this should make perfect sense as to why we used “Install_macOS_Catalina” (it’s the default on importing). Within munki, we setup our pre-requisites to require our AntiVirus software prior to installation of Catalina. The reason for this is that in the past Kernel Panics have been a problem. Because of this, we prefer to setup the latest version of the AV as a pre-req.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;minimum_os_sub_build_version&lt;/code&gt; if this is not included you end up running into this &lt;a href=&quot;https://github.com/erikng/nudge/issues/24&quot;&gt;bug&lt;/a&gt;. This key is required (as of now).&lt;/p&gt;

&lt;p&gt;Now let’s move on to the LaunchAgent configuration.&lt;/p&gt;

&lt;h3 id=&quot;nudge-launchagent&quot;&gt;nudge LaunchAgent&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/erikng/nudge/blob/3901ca478b32a323924f7b443826c4ead61c3a60/payload/Library/LaunchAgents/com.erikng.nudge.plist&quot;&gt;https://github.com/erikng/nudge/blob/3901ca478b32a323924f7b443826c4ead61c3a60/payload/Library/LaunchAgents/com.erikng.nudge.plist&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
    &amp;lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&amp;gt;
    &amp;lt;plist version=&quot;1.0&quot;&amp;gt;
    &amp;lt;dict&amp;gt;
      &amp;lt;key&amp;gt;Label&amp;lt;/key&amp;gt;
      &amp;lt;string&amp;gt;com.erikng.nudge&amp;lt;/string&amp;gt;
      &amp;lt;key&amp;gt;LimitLoadToSessionType&amp;lt;/key&amp;gt;
      &amp;lt;array&amp;gt;
        &amp;lt;string&amp;gt;Aqua&amp;lt;/string&amp;gt;
      &amp;lt;/array&amp;gt;
      &amp;lt;key&amp;gt;ProgramArguments&amp;lt;/key&amp;gt;
      &amp;lt;array&amp;gt;
        &amp;lt;string&amp;gt;/Library/Application Support/nudge/Resources/nudge&amp;lt;/string&amp;gt;
        &amp;lt;string&amp;gt;--jsonurl=https://fake.domain.com/path/to/config.json&amp;lt;/string&amp;gt;
      &amp;lt;/array&amp;gt;
      &amp;lt;key&amp;gt;RunAtLoad&amp;lt;/key&amp;gt;
      &amp;lt;true/&amp;gt;
      &amp;lt;key&amp;gt;StandardOutPath&amp;lt;/key&amp;gt;
      &amp;lt;string&amp;gt;/Library/Application Support/nudge/Logs/nudge.log&amp;lt;/string&amp;gt;
      &amp;lt;key&amp;gt;StandardErrorPath&amp;lt;/key&amp;gt;
      &amp;lt;string&amp;gt;/Library/Application Support/nudge/Logs/nudge.log&amp;lt;/string&amp;gt;
      &amp;lt;key&amp;gt;StartCalendarInterval&amp;lt;/key&amp;gt;
      &amp;lt;array&amp;gt;
        &amp;lt;dict&amp;gt;
          &amp;lt;key&amp;gt;Minute&amp;lt;/key&amp;gt;
          &amp;lt;integer&amp;gt;0&amp;lt;/integer&amp;gt;
        &amp;lt;/dict&amp;gt;
        &amp;lt;dict&amp;gt;
          &amp;lt;key&amp;gt;Minute&amp;lt;/key&amp;gt;
          &amp;lt;integer&amp;gt;30&amp;lt;/integer&amp;gt;
        &amp;lt;/dict&amp;gt;
      &amp;lt;/array&amp;gt;
    &amp;lt;/dict&amp;gt;
    &amp;lt;/plist&amp;gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In addition to this, there are some personal recommendations I would make for this based on feedback we had from our employees (they were pissed on our initial roll out of &lt;a href=&quot;https://github.com/erikng/umad&quot;&gt;UMAD&lt;/a&gt;). While I agree that on the 0 and 30 (every half hour) is a good plan, unfortunately, our company is small enough that I will get complaints and an ear full. Because of this,&lt;/p&gt;

&lt;p&gt;Now, if you remember that config.json file from earlier, and you notice that default option here is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--jsonurl=&lt;/code&gt; you might see where this is headed. Making an updatable and flexible preferences file to load into nudge (while also allowing for flexible image locations as well).&lt;/p&gt;

&lt;h3 id=&quot;using-gcp&quot;&gt;Using GCP&lt;/h3&gt;

&lt;p&gt;Google Cloud Platform has a &lt;a href=&quot;https://cloud.google.com/free/&quot;&gt;free tier&lt;/a&gt; for 5GB storage buckets. This &lt;em&gt;may&lt;/em&gt; not work well for you if you have over 10000 employees all hitting the service at the same time over a month or more of time. As the limitations of GCP Free tier are outlined below (as of 2019/12/02)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;5 GB-months of regional storage (US regions only)&lt;/li&gt;
  &lt;li&gt;5,000 Class A Operations per month&lt;/li&gt;
  &lt;li&gt;50,000 Class B Operations per month&lt;/li&gt;
  &lt;li&gt;1 GB network egress from North America to all region destinations (excluding China and Australia) per month&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The definition of the “classes” can be found &lt;a href=&quot;https://cloud.google.com/storage/pricing#operations-pricing&quot;&gt;here&lt;/a&gt;. However for our needs, this works fine. The service is cheap enough, the operating costs are minimal, and it just works for our service.&lt;/p&gt;

&lt;p&gt;S3 would also be an alternative here as well, we just did not use it at ThousandEyes internally for IT.&lt;/p&gt;

&lt;p&gt;We will be granting access based on permissions here: https://cloud.google.com/storage/docs/access-control/lists#scopes&lt;br /&gt;
Since there is nothing private or personal here, and google defaults to HTTPS sites with no authentication it works great for our usecase.&lt;/p&gt;

&lt;p&gt;To do this, create a storage bucket, call it something relevant to you, we called ours &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nudge-os-release-notification&lt;/code&gt; and then place your config.json file in the bucket. Once you create this bucket, while you could and should have this authenticated, the easiest way for you to begin testing is to set the member &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;allUsers&lt;/code&gt; to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Storage Object Viewer&lt;/code&gt; role, this creates a public bucket, where anyone could download the contents of the files within the bucket. Not great for production, but perfectly fine for one-off testing.&lt;/p&gt;

&lt;h3 id=&quot;stg--prod&quot;&gt;STG &amp;amp; PROD&lt;/h3&gt;

&lt;p&gt;What happens if we want to test deployment of a minor OS Update. We have a stg and production version of this application, where we apply the production version to all machines, and then apply stg to specific ones. This is not revolutionary in anyway.&lt;/p&gt;

&lt;h2 id=&quot;ways-to-improve-this&quot;&gt;Ways to improve this&lt;/h2&gt;

&lt;p&gt;While we have only implemented an initial version of this software:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Instead of placing the file (either the logo, or the download icon) on the machine, why not allow them to be displayed on demand (similar to the json file, grab them from the internet and then keep them in a cache location). Then remove after use (or upgrade). This allows us to be flexible enough with the files, while still not having to redistribute the original nudge package (or single file packages) for every OS Upgrade revision.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;major-thanks-to-erik&quot;&gt;Major thanks to Erik&lt;/h2&gt;

&lt;p&gt;I want to give a major thanks to Erik, ThousandEyes IT has been using several of the tools he has developed over the past few years and it has made our job much easier, allowing us to develop and work on other things that pop up within the company.&lt;/p&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="macOS" /><category term="Catalina" /><category term="macOS" /><category term="nudge" /><category term="OS Updates" /><summary type="html">This goes over how to deploy nudge to manage macOS Updates in combination with tools and documentation software like Munki or Confluence.</summary></entry><entry><title type="html">Airwatch/Workspace ONE - Using SAML and LDAP with Okta</title><link href="https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta/" rel="alternate" type="text/html" title="Airwatch/Workspace ONE - Using SAML and LDAP with Okta" /><published>2019-05-01T21:15:00+00:00</published><updated>2019-05-01T21:15:00+00:00</updated><id>https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta</id><content type="html" xml:base="https://andrewdoering.org/blog/2019/05/01/airwatch-workspace-one-using-saml-and-ldap-with-okta/">&lt;p&gt;&lt;strong&gt;UPDATE 12/22/2019&lt;/strong&gt; - Please see&lt;a href=&quot;https://andrewdoering.org/blog/2019/12/22/workspace-one-okta-users-and-groups-working-with-dep-enrollment/&quot;&gt; this post&lt;/a&gt; for a more up to date and more functionaly guide. It is good to read this first, before doing the other one however to get a better understanding of our initial decisions.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#precursor&quot;&gt;Precursor&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#software-requirements&quot;&gt;Software Requirements&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#initial-expectations&quot;&gt;Initial Expectations&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#workspace-one---directory-services-integration&quot;&gt;Workspace One - Directory Services Integration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#okta-profile-mapping&quot;&gt;Okta Profile Mapping&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#airwatch---user-and-groups-directory-integration&quot;&gt;Airwatch - User and Groups Directory Integration&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#users&quot;&gt;Users&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#groups&quot;&gt;Groups&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#okta---saml-app-for-airwatch&quot;&gt;OKTA - SAML App for Airwatch&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#saml-integration&quot;&gt;SAML Integration&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#sdp-bookmark-application&quot;&gt;sDP Bookmark Application&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#airwatch---saml-settings&quot;&gt;Airwatch - SAML Settings&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#room-for-improvements&quot;&gt;Room for Improvements&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In this writeup, I will go over the configuration settings that I used, and worked with Airwatch/Workspace ONE Professional Services and Support  to get Airwatch up and working within ThousandEyes. Initially, before writing this guide (which I have admittedly been putting off for a while - since May when we did our deployment of the service), the documents that were available on VMware’s website, were mostly incorrect. This might have been fixed, however I have not gone back to validate any of their documentation. Once we spend the time to do this, I will update either this page, or create a new posting.&lt;/p&gt;

&lt;h2 id=&quot;precursor&quot;&gt;Precursor&lt;/h2&gt;

&lt;h3 id=&quot;software-requirements&quot;&gt;Software Requirements&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Airwatch Cloud Connector (optional)&lt;/li&gt;
  &lt;li&gt;Okta Ldap Interface&lt;/li&gt;
  &lt;li&gt;Okta (duh)&lt;/li&gt;
  &lt;li&gt;Airwatch / Workspace One (duh)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;initial-expectations&quot;&gt;Initial Expectations&lt;/h3&gt;

&lt;p&gt;ThousandEyes has not yet made the transition to a full cloud based Directory System, we are still using Active Directory On-Premise. However, all systems that have been deployed going from 2019 - forward, need to or should be setup in a compatible way so that when we make the full cloud transition, it is seamless. As such, we assume here that you have or are using:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Active Directory On Premise (as Profile Master in Okta)&lt;/li&gt;
  &lt;li&gt;Okta (as secondary)&lt;/li&gt;
  &lt;li&gt;Intent to put BambooHR as Profile Master later on&lt;/li&gt;
  &lt;li&gt;Intent to move Active Directory On Premise to Azure AD&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We actually tried using VMware’s Identity Manager to perform SAML, but at the time, the directions did not allow configuration after following the guides provided by Okta or VMware. Because they said this was the easier way, and unfortunately when asking them - they wouldn’t bother helping us with the correct way. In addition, originally their documentation that was listed here, was incredibly wrong. It seems like in the time that I have taken to put off writing this guide, they have updated their documentation to show the correct way to connect Okta as an LDAP service.&lt;/p&gt;

&lt;p&gt;Documentation &lt;a href=&quot;https://kb.vmware.com/s/article/2961230?lang=en_US&quot;&gt;listed here&lt;/a&gt;, gives you a proper configuration guide. However, at the time of originally writing this guide, the documetation was incorrect and did not work.&lt;/p&gt;

&lt;p&gt;With that said, I would also highly recommmend to ignore &lt;a href=&quot;https://www.okta.com/sites/default/files/Okta-3rd-Party-UEM-Interop_Workspace-ONE.pdf&quot;&gt;this guide&lt;/a&gt;, it is outdated for newer versions of Workspace One.&lt;/p&gt;

&lt;p&gt;So with this in mind, let me explain how ThousandEyes did this:&lt;/p&gt;

&lt;h2 id=&quot;workspace-one---directory-services-integration&quot;&gt;Workspace One - Directory Services Integration&lt;/h2&gt;

&lt;p&gt;Setting this portion up is quite easy with the way that the support team and consultant recommended. Unfortunately, the easy way is not the best way, and you should be able to get assistance from support easily on how to do this. However, this is how ThousandEyes has performed this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image.png&quot; alt=&quot;LDAP Connection Settings&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To edit any of the settings for a currently working directory, just replace the strings that are in capital letters below with yours.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&amp;lt;code&amp;gt;Directory Type: Other LDAP
Server: YOURDOMAINHERE.ldap.okta.com
Encryption Type: SSL
Verify SSL Certificate: Check the box
Bind Authentication Type: Basic
Bind User Name: uid=YOURSUPERUSERHERE,dc=YOURDOMAINHERE,dc=okta,dc=com
Bind Password: YOURSECRETHERE
Domain: YOURDOMAINHERE.okta.com&amp;lt;/code&amp;gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This should allow you to verify or test the connection below. Once the LDAP Settings are working, move on to the User tab.&lt;/p&gt;

&lt;h2 id=&quot;okta-profile-mapping&quot;&gt;Okta Profile Mapping&lt;/h2&gt;

&lt;p&gt;Because we want to integrate this with Azure later on, and Active Directory, we need to map some of our existing attributes from Active Directory and push them into Okta.&lt;/p&gt;

&lt;p&gt;First, go here:  &lt;a href=&quot;https://YOURDOMAIN-admin.okta.com/admin/universaldirectory&quot;&gt;https://YOURDOMAIN-admin.okta.com/admin/universaldirectory&lt;/a&gt; and select the Profile button located below&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-4.png&quot; alt=&quot;Profile Editor&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Click the add attribute button&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-5.png&quot; alt=&quot;Add Attribute&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Use the the following settings for the Attributes&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now, lets go to Active Directory’s mapping, select your domain to setup the mapping push. You want to push from the Active Directory Domain to Okta.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;airwatch---user-and-groups-directory-integration&quot;&gt;Airwatch - User and Groups Directory Integration&lt;/h2&gt;

&lt;h3 id=&quot;users&quot;&gt;Users&lt;/h3&gt;

&lt;p&gt;Setting up the users panel&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;While VMware’s documentation states to use mail=, I found that for the ease of the employee, using their shorthand account name is far easier for the experience - specifically for macOS. With Windows, this change may cause problems.&lt;/p&gt;

&lt;p&gt;Drop the advanced menu down and select the following features&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We came to the conclusion of using the following settings for the advanced section of the user system&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The reasons for these attributes being used are based directly on the attributes that are listed in Profile attributes in Okta, as well, as the ldapsearch tool based on the information below:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;      ldapsearch -H ldaps://thousandeyes.ldap.okta.com -b &quot;dc=thousandeyes,dc=okta,dc=com&quot; -D &quot;uid=adoering@thousandeyes.com,dc=thousandeyes,dc=okta,dc=com&quot; -W -x &quot;(sn=Doer)&quot;
      # extended LDIF
      #
      # LDAPv3
      # base &amp;lt;dc=thousandeyes,dc=okta,dc=com&amp;gt; with scope subtree
      # filter: (sn=Doer)
      # requesting: ALL
      #
      
      # atesting@thousandeyes.com, users, thousandeyes.okta.com
      dn: uid=atesting@thousandeyes.com,ou=users,dc=thousandeyes,dc=okta,dc=com
      objectClass: top
      objectClass: person
      objectClass: organizationalPerson
      objectClass: inetOrgPerson
      uid: atesting@thousandeyes.com
      uniqueIdentifier: REMOVINGFROMHERE
      organizationalStatus: ACTIVE
      givenName: Andrew
      sn: Doer
      cn: Andrew Doer
      mail: atesting@thousandeyes.com
      mail: atesting+testing@thousandeyes.com
      AD_ObjectGUID: REMOVINGFROMHERE
      sAMAccountName: atesting
      title: IT Tester
      department: Engineering
      
      # search result
      search: 2
      result: 0 Success
      
      # numResponses: 2
      # numEntries: 1
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When we look  at this, we see there are a few differences in Okta’s LDAP directories compared to Active Directory. So those adjustments are made into the above attributes. A few of these attribute changes are not mentioned in VMware’s documentations.&lt;/p&gt;

&lt;h3 id=&quot;groups&quot;&gt;Groups&lt;/h3&gt;

&lt;p&gt;With groups, we came to the conclusion that the following attributes were required for use within Airwatch:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Unfortunately, even with this setup - Airwatch does not support importing users from the groups itself. While this might be an issue only we have, I have not found a way around getting the users imported - even with the proper settings. While we have opened up a support ticket for this (and even had confirmation in the past that this was a bug), 6 months later it is still not fixed. See the Room for Improvements section for a feature request using VMware’s new feature request option.&lt;/p&gt;

&lt;h2 id=&quot;okta---saml-app-for-airwatch&quot;&gt;OKTA - SAML App for Airwatch&lt;/h2&gt;

&lt;h3 id=&quot;saml-integration&quot;&gt;SAML Integration&lt;/h3&gt;

&lt;p&gt;Create a custom SAML Application in Okta.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Attach a photo if you would like, however, this application will mainly be hidden in the application dashboard. Go ahead and click next.&lt;/p&gt;

&lt;p&gt;Below you will see a heavily redacted SAML setup. Sorry, but as these are all private links, I can’t post them. However, I have&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/11/image-12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, you will see a modified version of the links below where you can change the wording that is in all capital letters.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;      Single Sign On URL: https://YOURDSSERVERHERE.awmdm.com/IdentityService/SAML/AssertionService.ashx?binding=HttpPost
      Requestable SSO URLs, Index
      https://YOURDSSERVERHERE.awmdm.com/IdentityService/SAML/AssertionService.ashx, 2
      https://YOURDSSERVERHERE.awmdm.com/MyDevice/SAML/AssertionService.ashx, 5
      https://YOURDSSERVERHERE.awmdm.com/DeviceManagement/SAML/AssertionService.ashx, 8
      https://YOURCNSERVERHERE.awmdm.com/AirWatch/SAML/AssertionService.ashx, 11
      https://YOURDSSERVERHERE.awmdm.com/Catalog/SAML/AssertionService.ashx, 14
      Audience URI: SOMETHINGHERE
      
      
      Attribute Statements
      Name, NameFormat, Value
      uid, Unspecified, user.login
      objectGUID, Unspecified, user.AD_ObjectGUID
      uniqueIdentifier, Unspecified, user.getInternalProperty(&quot;id&quot;)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You might be curious about the last piece here. This is a pretty way to use the Okta Expression Language to get the uniqueidentifier property that we were using previously as a way to send the string without it being an visible attribute to the user.&lt;/p&gt;

&lt;p&gt;Download the metadata file that is generated.&lt;/p&gt;

&lt;h3 id=&quot;sdp-bookmark-application&quot;&gt;sDP Bookmark Application&lt;/h3&gt;

&lt;p&gt;Becuase Airwatch in this way only provides SAML when initiated from the software layer. Because of this, we will be creating a bookmark application to directly go to the URL that allows for SAML login provided by the Group ID within the instance.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    https://YOURCNSERVERHERE.awmdm.com/AirWatch/Login?GID=YOURGROUPIDHERE
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From there, simply add a photo, my recommendation would be to use this photo:&lt;br /&gt;
&lt;img src=&quot;https://images.app.goo.gl/FHoBaE4A912jCRmg9&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;airwatch---saml-settings&quot;&gt;Airwatch - SAML Settings&lt;/h2&gt;

&lt;p&gt;Go to Enterprise Integrations &amp;gt; Directory Services &amp;gt; SAML. Take the Metadata file generated and upload it to the Import Identity Provider Settings area.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/blog/2019/12/image-1-1024x841.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The fields should populate like so.&lt;/p&gt;

&lt;p&gt;From here, you should be ready to go with logging into the Bookmark application you made.&lt;/p&gt;

&lt;h2 id=&quot;room-for-improvements&quot;&gt;Room for Improvements&lt;/h2&gt;

&lt;p&gt;There are various problems with this integration, and even when setting up with proserv, this did not come out the way I would have liked.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Airwatch &amp;amp; Azure integration does not work/is not configured.&lt;br /&gt;
Unfortunately, proserv was not super helpful with this in prepping for Azure integration for the future.  The only requirement that was checked on was for&lt;/li&gt;
  &lt;li&gt;Our deployment was guided mainly towards macOS&lt;br /&gt;
This causes a disparity between what we need and what we want. We requested that we setup both macOS and Windows configurations here.&lt;/li&gt;
  &lt;li&gt;Airwatch’s ProServ consultants can vary wildly in knowledge regarding the application.&lt;br /&gt;
This was the case with ours, we switched consultants three times. We required the use of multiple people to get our Okta setup working, this was multiple weeks.&lt;/li&gt;
  &lt;li&gt;Groups are not usable in this integration&lt;br /&gt;
Even with the required setup, using Airwatch’s documentation, group membership listing does not work, groups do import but no user listings will show. There is a &lt;a href=&quot;https://wsone-uem.ideas.aha.io/ideas/UEMCP-I-291&quot;&gt;Feature Request&lt;/a&gt;, as well as support case open for this.&lt;/li&gt;
  &lt;li&gt;After writing this, I looked up Airwatch’s documentation - it is vastly improved. It looks like the documentation can finally be used as a mechanism to implement features and integrations.&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Andrew Doering</name></author><category term="blog" /><category term="Identity Access Management" /><category term="Mobile Device Management" /><category term="Okta" /><category term="Workspace One" /><category term="Airwatch" /><category term="LDAP" /><category term="LDAP Interface" /><summary type="html">This is a good first read if you want to delve into SAML and WS1 configurations. Please see the updated post for a more up to date and more functional guide.</summary></entry></feed>